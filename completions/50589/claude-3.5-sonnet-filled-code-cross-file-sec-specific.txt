if (m_cachePos >= m_cache.size()) {
        if (!readNextBlock()) {
            return false;
        }
        m_cachePos = 0;
    }

    buffer.clear();
    while (true) {
        size_t endPos = m_cachePos;
        while (endPos < m_cache.size() && m_cache[endPos] != '\n' && m_cache[endPos] != '\r') {
            ++endPos;
        }

        buffer.insert(buffer.end(), m_cache.begin() + m_cachePos, m_cache.begin() + endPos);

        if (endPos == m_cache.size()) {
            m_cachePos = endPos;
            if (!readNextBlock()) {
                return !buffer.empty();
            }
        } else {
            m_cachePos = endPos + 1;
            if (m_cachePos < m_cache.size() && m_cache[m_cachePos - 1] == '\r' && m_cache[m_cachePos] == '\n') {
                ++m_cachePos;
            }
            return true;
        }
    }