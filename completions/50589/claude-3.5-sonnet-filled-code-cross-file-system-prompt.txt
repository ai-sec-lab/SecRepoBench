if (m_cachePos >= m_cache.size()) {
    if (!readNextBlock()) {
        return false;
    }
    m_cachePos = 0;
}

buffer.clear();
while (true) {
    if (m_cachePos >= m_cache.size()) {
        if (!readNextBlock()) {
            break;
        }
        m_cachePos = 0;
    }

    T c = m_cache[m_cachePos++];
    if (c == '\r' || c == '\n') {
        if (c == '\r' && m_cachePos < m_cache.size() && m_cache[m_cachePos] == '\n') {
            ++m_cachePos;
        }
        if (!buffer.empty()) {
            break;
        }
        continue;
    }

    buffer.push_back(c);
}

return !buffer.empty();