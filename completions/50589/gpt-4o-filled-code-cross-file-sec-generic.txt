buffer.clear();

    while (true) {
        // Check if the cache is exhausted
        if (m_cachePos >= m_cache.size()) {
            if (!readNextBlock()) {
                // End of stream reached
                return false;
            }
        }

        // Read characters from the cache until a newline is found
        while (m_cachePos < m_cache.size()) {
            T ch = m_cache[m_cachePos++];
            if (ch == '\n') {
                // Newline found, return the line
                return true;
            }
            if (ch != '\r') {
                // Add character to buffer, ignoring carriage returns
                buffer.push_back(ch);
            }
        }
    }