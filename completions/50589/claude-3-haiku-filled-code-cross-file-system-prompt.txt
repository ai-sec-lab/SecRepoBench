size_t lineStart = m_cachePos;
size_t lineEnd = m_cache.size();

// Find the end of the line
while (lineEnd < m_cache.size() && m_cache[lineEnd] != '\n' && m_cache[lineEnd] != '\r') {
    ++lineEnd;
}

// Copy the line into the buffer
buffer.assign(m_cache.begin() + lineStart, m_cache.begin() + lineEnd);

// Update the cache position
m_cachePos = lineEnd + 1;
if (m_cachePos >= m_cache.size()) {
    if (!readNextBlock()) {
        return false;
    }
    m_cachePos = 0;
}

return true;