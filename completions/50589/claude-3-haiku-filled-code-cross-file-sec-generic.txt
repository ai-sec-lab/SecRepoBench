bool IOStreamBuffer<T>::getNextLine(std::vector<T> &buffer) {
    // Return the last block-value if getNextLine was used before
    if (0 != m_cachePos) {
        buffer = std::vector<T>(m_cache.begin() + m_cachePos, m_cache.end());
        m_cachePos = 0;
    } else {
        if (!readNextBlock()) {
            return false;
        }

        buffer = std::vector<T>(m_cache.begin(), m_cache.end());
    }

    // Find the end of the line in the buffer
    size_t lineEnd = 0;
    while (lineEnd < buffer.size() && buffer[lineEnd] != '\n' && buffer[lineEnd] != '\r') {
        lineEnd++;
    }

    // Resize the buffer to the length of the line
    buffer.resize(lineEnd);

    // Check if the end of the stream has been reached
    if (buffer.empty()) {
        return false;
    }

    // Skip any end-of-line characters
    while (!buffer.empty() && (buffer.back() == '\n' || buffer.back() == '\r')) {
        buffer.pop_back();
    }

    return true;
}