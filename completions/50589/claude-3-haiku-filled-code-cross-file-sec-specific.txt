bool IOStreamBuffer<T>::getNextLine(std::vector<T> &buffer) {
    // Return the last block-value if getNextLine was used before
    if (0 != m_cachePos) {
        buffer = std::vector<T>(m_cache.begin() + m_cachePos, m_cache.end());
        m_cachePos = 0;
    } else {
        if (!readNextBlock()) {
            return false;
        }

        buffer = std::vector<T>(m_cache.begin(), m_cache.end());
    }

    // Find the end of the line in the buffer
    size_t lineEnd = 0;
    while (lineEnd < buffer.size() && buffer[lineEnd] != static_cast<T>('\n')) {
        ++lineEnd;
    }

    // If the end of the line is not found, the line is longer than the buffer
    if (lineEnd == buffer.size()) {
        // Resize the buffer to accommodate the longer line
        buffer.resize(buffer.size() * 2);
        if (!readNextBlock()) {
            return false;
        }
        // Find the end of the line in the extended buffer
        while (lineEnd < buffer.size() && buffer[lineEnd] != static_cast<T>('\n')) {
            ++lineEnd;
        }
    }

    // Trim the buffer to the length of the line
    buffer.resize(lineEnd);
    return true;
}