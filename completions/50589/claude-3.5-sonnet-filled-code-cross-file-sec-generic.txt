if (m_cachePos >= m_cache.size()) {
        if (!readNextBlock()) {
            return false;
        }
        m_cachePos = 0;
    }

    buffer.clear();
    while (true) {
        size_t start = m_cachePos;
        while (m_cachePos < m_cache.size() && m_cache[m_cachePos] != '\n' && m_cache[m_cachePos] != '\r') {
            ++m_cachePos;
        }

        buffer.insert(buffer.end(), m_cache.begin() + start, m_cache.begin() + m_cachePos);

        if (m_cachePos < m_cache.size()) {
            // Found end of line
            ++m_cachePos; // Skip newline character
            if (m_cachePos < m_cache.size() && m_cache[m_cachePos - 1] == '\r' && m_cache[m_cachePos] == '\n') {
                ++m_cachePos; // Skip \n in \r\n sequence
            }
            return true;
        }

        // Reached end of cache, read next block
        if (!readNextBlock()) {
            return !buffer.empty(); // Return true if we've read any data
        }
        m_cachePos = 0;
    }