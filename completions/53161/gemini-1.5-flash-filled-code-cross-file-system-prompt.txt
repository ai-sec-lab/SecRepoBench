char *endp;
      long val = strtol(tptr + tmpl->idx, &endp, 10);
      if (tptr + tmpl->idx == endp) {
        mrb_raisef(mrb, E_RUNTIME_ERROR, "invalid template '%s'", tptr);
      }
      tmpl->idx = endp - tptr;
      if (tmpl->idx > tlen) {
        mrb_raisef(mrb, E_RUNTIME_ERROR, "template length is too large");
      }
      count = val;