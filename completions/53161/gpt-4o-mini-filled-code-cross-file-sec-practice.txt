// Validate the character to ensure it is a digit
      if (!ISDIGIT(ch)) {
        mrb_raisef(mrb, E_ARGUMENT_ERROR, "Invalid character in template: '%c'", (char)ch);
      }

      // Read the integer value from the template string
      int value = 0;
      while (tmpl->idx < tlen && ISDIGIT(tptr[tmpl->idx])) {
        value = value * 10 + (tptr[tmpl->idx] - '0');
        tmpl->idx++;
        
        // Check for overflow
        if (value < 0) {
          mrb_raisef(mrb, E_RUNTIME_ERROR, "Template length is too large");
        }
      }

      // Update the count based on the read integer value
      count = value;
      tmpl->idx--; // Adjust index to point to the last processed character