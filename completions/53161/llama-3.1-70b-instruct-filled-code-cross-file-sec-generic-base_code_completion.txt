// Check if the current character is a digit.
// If so, read an integer value from the template string.
// Update the template index to point after the read integer value.
// If reading fails raise a runtime error indicating the template length is too large.
mrb_int val = 0;
while (ISDIGIT(ch)) {
  val = val * 10 + (ch - '0');
  tmpl->idx++;
  if (tmpl->idx >= tlen) {
    mrb_raisef(mrb, E_RUNTIME_ERROR, "template length is too large");
  }
  ch = tptr[tmpl->idx];
}
if (val > INT_MAX) {
  mrb_raisef(mrb, E_RUNTIME_ERROR, "template length is too large");
}
count = (int)val;