int count = 0;
while (ISDIGIT(tptr[tmpl->idx])) {
  int digit = tptr[tmpl->idx] - '0';
  if (count > (INT_MAX - digit) / 10) {
    mrb_raisef(mrb, E_RUNTIME_ERROR, "template length too large");
  }
  count = count * 10 + digit;
  tmpl->idx++;
}