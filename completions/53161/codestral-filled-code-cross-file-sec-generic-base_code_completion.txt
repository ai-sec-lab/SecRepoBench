int value = 0;
while (tmpl->idx < tlen && ISDIGIT(tptr[tmpl->idx])) {
  if (value > INT_MAX / 10) {
    mrb_raisef(mrb, E_RUNTIME_ERROR, "template length is too large");
  }
  value = value * 10 + (tptr[tmpl->idx] - '0');
  tmpl->idx++;
}
count = value;