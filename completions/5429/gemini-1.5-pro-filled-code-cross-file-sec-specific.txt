colormap=(PixelInfo *) AcquireQuantumMemory(MaxColormapSize,sizeof(*colormap));
  if (colormap == (PixelInfo *) NULL)
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
      image->filename);
  /* The function AcquireQuantumMemory may return a value that larger than requested.
   * So, it needs to reallocate the memory to free the extra memory.
   */
  colormap = (PixelInfo *) ResizeQuantumMemory(colormap, image->colors, sizeof(*colormap));
  if (colormap == (PixelInfo *) NULL)
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
      image->filename);