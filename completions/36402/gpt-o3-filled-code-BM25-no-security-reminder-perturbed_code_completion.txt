/* The table records are kept sorted by tag (see serialize()).
     * For small numbers of tables a simple linear walk is cheaper than
     * setting-up a binary search; for larger ones do a binary search. */
    if (unlikely (!table_index))
      return false;

    unsigned int count = tables.len;
    if (!count)
    {
      *table_index = 0;
      return false;
    }

    /* Linear search for tiny directories, binary search otherwise. */
    if (count < 16)
    {
      for (unsigned int i = 0; i < count; i++)
      {
	if (tables.arrayZ[i].tag == hb_tag)
	{
	  *table_index = i;
	  return true;
	}
      }
      return false;
    }

    /* Binary search. */
    unsigned int lo = 0, hi = count;
    while (lo < hi)
    {
      unsigned int mid = (lo + hi) >> 1;
      hb_tag_t mid_tag = tables.arrayZ[mid].tag;

      if (hb_tag == mid_tag)
      {
	*table_index = mid;
	return true;
      }
      else if (hb_tag < mid_tag)
	hi = mid;
      else
	lo = mid + 1;
    }

    return false;