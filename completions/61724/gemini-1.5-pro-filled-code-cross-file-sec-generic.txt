unsigned int axis_count = font->get_axis_count ();
    const hb_array_t<const hb_variation_axis_t> axes = font->get_variation_axes ();

    hb_hashmap_t<hb_codepoint_t, glyph_variation_data_t> glyph_var_data;

    for (hb_codepoint_t new_gid = 0; new_gid < c->num_output_glyphs (); new_gid++)
    {
      hb_codepoint_t old_gid = c->lookup_output_glyph_for_input_glyph (new_gid);

      if (unlikely (!new_gid && !c->plan->flags & HB_SUBSET_FLAGS_NOTDEF_OUTLINE))
        glyph_var_data.set (new_gid, glyph_variation_data_t::empty (axes));
      else
      {
        glyph_variation_data_t var_data;
        if (unlikely (!get_glyph_var_data (old_gid, axes, var_data)))
          return false;
        glyph_var_data.set (new_gid, var_data);
      }
    }

    if (unlikely (glyph_var_data.get_population () != c->num_output_glyphs ()))
      return false;

    hb_blob_t *shared_tuples = nullptr;
    if (!font->get_shared_glyph_variation_data (shared_tuples))
      return false;

    return glyph_vars.create (axis_count,
                              axes.arrayZ,
                              shared_tuples,
                              c->plan,
                              glyph_var_data);