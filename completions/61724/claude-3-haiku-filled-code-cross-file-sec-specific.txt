hb_hashmap_t<hb_codepoint_t, glyph_variations_t> new_glyph_variations;

for (const auto& pair : new_to_old_glyph_map)
{
    hb_codepoint_t new_gid = pair.first;
    hb_codepoint_t old_gid = pair.second;

    if (new_gid == 0 && !(c->plan->flags & HB_SUBSET_FLAGS_NOTDEF_OUTLINE))
    {
        new_glyph_variations.set (0, glyph_variations_t ());
    }
    else
    {
        glyph_variations_t old_glyph_vars;
        if (get_glyph_variations (old_gid, old_glyph_vars))
        {
            new_glyph_variations.set (new_gid, old_glyph_vars);
        }
    }
}

if (unlikely (new_glyph_variations.get_population () != new_to_old_glyph_map.length ()))
{
    return false;
}

glyph_vars = std::move (new_glyph_variations);