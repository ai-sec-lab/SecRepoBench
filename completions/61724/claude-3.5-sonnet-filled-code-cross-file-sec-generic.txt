hb_hashmap_t<hb_codepoint_t, glyph_variation_data_t> new_glyph_vars;
new_glyph_vars.alloc (c->plan->num_output_glyphs ());

for (auto _ : c->plan->new_to_old_gid_list)
{
  hb_codepoint_t new_gid = _.first;
  hb_codepoint_t old_gid = _.second;

  glyph_variation_data_t var_data;
  if (!get_glyph_var_data (old_gid, &var_data))
    continue;

  new_glyph_vars.set (new_gid, std::move (var_data));
}

if (c->plan->new_to_old_gid_list.length &&
    c->plan->new_to_old_gid_list[0].first == 0 &&
    !(c->plan->flags & HB_SUBSET_FLAGS_NOTDEF_OUTLINE))
{
  glyph_variation_data_t empty_data;
  new_glyph_vars.set (0, std::move (empty_data));
}

if (new_glyph_vars.in_error ())
  return false;

return glyph_vars.create (c->plan, axis_count, shared_tuples, &new_glyph_vars);