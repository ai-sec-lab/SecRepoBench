hb_hashmap_t<hb_codepoint_t, glyph_variation_data_t> new_glyph_vars;
new_glyph_vars.alloc (c->plan->num_output_glyphs ());

for (auto _ : c->plan->new_to_old_gid_list)
{
  hb_codepoint_t new_gid = _.first;
  hb_codepoint_t old_gid = _.second;

  if (!new_gid && !old_gid && !c->plan->flags & HB_SUBSET_FLAGS_NOTDEF_OUTLINE)
  {
    new_glyph_vars.set (0, glyph_variation_data_t ());
    continue;
  }

  glyph_variation_data_t var_data;
  if (!get_glyph_var_data (old_gid, &var_data))
    continue;

  new_glyph_vars.set (new_gid, var_data);
}

if (unlikely (new_glyph_vars.in_error ()))
  return false;

return glyph_vars.create (c->plan->axes.get_axis_count (),
                          c->plan->shared_tuples,
                          c->plan,
                          new_glyph_vars);