hb_hashmap_t<hb_codepoint_t, glyph_variations_t> new_glyph_variations;

for (const auto& pair : c->plan->glyph_mapping)
{
    hb_codepoint_t new_gid = pair.new_gid;
    hb_codepoint_t old_gid = pair.old_gid;

    if (new_gid == 0 && !(c->plan->flags & HB_SUBSET_FLAGS_NOTDEF_OUTLINE))
    {
        new_glyph_variations.set (0, glyph_variations_t ());
    }
    else
    {
        glyph_variations_t var_data;
        if (get_glyph_variations (old_gid, var_data))
        {
            new_glyph_variations.set (new_gid, var_data);
        }
    }
}

if (unlikely (new_glyph_variations.get_population () != c->plan->glyph_mapping.length ()))
{
    return false;
}

glyph_vars = std::move (new_glyph_variations);
create_glyph_variations (c->plan->axis_count,
                         c->plan->shared_tuples,
                         c->plan,
                         new_glyph_variations);