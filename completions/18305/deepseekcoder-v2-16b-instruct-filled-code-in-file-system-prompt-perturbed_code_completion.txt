];
            image->chromaticity.green_primary.y=chromaticity[3];
            image->chromaticity.blue_primary.x=chromaticity[4];
            image->chromaticity.blue_primary.y=chromaticity[5];
          }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) == 1)
      image->resolution.x=x_resolution;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) == 1)
      image->resolution.y=y_resolution;
    // </MASK>
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SAMPLESPERPIXEL,&samples_per_pixel) != 1)
      samples_per_pixel=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PLANARCONFIG,&interlace) != 1)
      interlace=PLANARCONFIG_CONTIG;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_COMPRESSION,&compress_tag) != 1)
      compress_tag=COMPRESSION_NONE;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PHOTOMETRIC,&photometric) != 1)
      photometric=PHOTOMETRIC_RGB;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_BITSPERSAMPLE,&bits_per_sample) != 1)
      bits_per_sample=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_SAMPLEFORMAT,&sample_format) != 1)
      sample_format=SAMPLEFORMAT_UINT;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MINSAMPLEVALUE,&min_sample_value) != 1)
      min_sample_value=0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_MAXSAMPLEVALUE,&max_sample_value) != 1)
      max_sample_value=255;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_EXTRASAMPLES,&extra_samples,&sample_info) == 1)
      {
        for (i=0; i < (ssize_t) extra_samples; i++)
        {
          switch (sample_info[i])
          {
            case EXTRASAMPLE_ASSOCALPHA:
            case EXTRASAMPLE_UNASSALPHA:
            {
              image->alpha_trait=BlendPixelTrait;
              break;
            }
            default:
            {
              break;
            }
          }
        }
      }
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) != 1)
      pages=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1)
      rows_per_strip=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) != 1)
      pages=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1)
      rows_per_strip=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) != 1)
      pages=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1)
      rows_per_strip=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) != 1)
      pages=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1)
      rows_per_strip=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) != 1)
      pages=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1)
      rows_per_strip=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) != 1)
      pages=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1)
      rows_per_strip=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) != 1)
      pages=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1)
      rows_per_strip=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) != 1)
      pages=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1)
      rows_per_strip=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) != 1)
      pages=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1)
      rows_per_strip=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) != 1)
      pages=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1)
      rows_per_strip=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_XRESOLUTION,&x_resolution) != 1)
      x_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_YRESOLUTION,&y_resolution) != 1)
      y_resolution=72.0;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ORIENTATION,&orientation) != 1)
      orientation=ORIENTATION_UNDEFINED;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_PAGENUMBER,&pages) != 1)
      pages=1;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) != 1)
      rows_per_strip=8;
    if (TIFFGetFieldDefaulted(tiff,TIFFTAG_RESOLUTIONUNIT,&units) != 1)
      units=RESUNIT_INCH;
    if (TIFFGetFieldDefaulted