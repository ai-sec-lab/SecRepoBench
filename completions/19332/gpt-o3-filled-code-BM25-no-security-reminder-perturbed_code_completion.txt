while((offset + 4) <= payload_length) {
        /* Attribute header is 4 bytes: type (2) + length (2)                */
        u_int16_t attr_type = ntohs(*((u_int16_t *)&payload[offset]));
        u_int16_t attr_len  = ntohs(*((u_int16_t *)&payload[offset + 2]));
        offset += 4;

        /* Safety check                                                      */
        if((offset + attr_len) > payload_length)
          break;

        /* Pointer to the attribute value                                    */
        const u_int8_t *attr_val = &payload[offset];

        /*
         * Try to understand which application is using STUN by looking
         * at well-known values placed in some attributes (e.g. USERNAME
         * or SOFTWARE).  Only a few heuristics are implemented here; they
         * can be extended at will.
         */
        switch(attr_type) {
        case 0x0006: /* USERNAME (RFC 5389 §15.3) */
          if(attr_len >= 2) {
            if(!memcmp(attr_val, "WA", 2))
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
            else if((attr_len >= 4) && !memcmp(attr_val, "ZOOM", 4))
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_ZOOM;
            else if((attr_len >= 3) && !memcmp(attr_val, "SKP", 3))
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
          }
          break;

        case 0x8022: /* SOFTWARE (RFC 5389 §15.10 – comprehension-optional) */
          if(attr_len >= 5) {
            if(!strncasecmp((const char *)attr_val, "Skype", 5))
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_SKYPE;
            else if(!strncasecmp((const char *)attr_val, "Google", 6))
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_HANGOUT_DUO;
            else if(!strncasecmp((const char *)attr_val, "WhatsApp", 8))
              flow->guessed_host_protocol_id = NDPI_PROTOCOL_WHATSAPP_CALL;
          }
          break;

        default:
          /* For the purposes of guessing the upper-layer protocol, the
           * other attributes are not currently used. */
          break;
        }

        /* Attributes are padded to a multiple of 4 bytes                    */
        attr_len = (attr_len + 3) & ~3;
        offset  += attr_len;
      }