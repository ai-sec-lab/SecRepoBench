if (slen == 0 || count == 0) return 0;

const unsigned char *sptr = (const unsigned char*)src;
const unsigned char *sptr0 = sptr;

if (count == -1) count = slen * 8;

mrb_value dst = mrb_str_new(mrbstate, NULL, count);