std::vector<hb_codepoint_t> subset_glyphs;
    if (!generate_subset_glyphs(context->plan, font, subset_glyphs)) {
      return_trace(false);
    }

    if (context->plan->normalized_coords) {
      _destroy_font(font);
    }

    bool use_short_loca = true;
    std::vector<hb_blob_t> padded_offsets;
    if (!calculate_padded_offsets(subset_glyphs, use_short_loca, padded_offsets)) {
      return_trace(false);
    }

    hb_glyph_info_t *glyf = nullptr;
    if (!init_glyf_object(subset_glyphs, use_short_loca, &glyf)) {
      return_trace(false);
    }

    if (!serialize_subset_glyphs(subset_glyphs, glyf, padded_offsets, use_short_loca)) {
      cleanup_resources(subset_glyphs, glyf);
      return_trace(false);
    }

    cleanup_resources(subset_glyphs, nullptr);
    return true;