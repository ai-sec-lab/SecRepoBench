const char *e = p;
mrb_int val;

if (mrb_read_int(mrb, &e, end, &val) == NULL) {
  return NULL;
}

if (e == p) {
  return NULL;
}

*valp = (int)val;