char *e;
  long num;

  if (p == NULL || end == NULL || valp == NULL || p >= end) {
    return NULL;
  }

  num = strtol(p, &e, 10);

  if (e == p || e > end || num < INT_MIN || num > INT_MAX) {
    return NULL;
  }

  *valp = (int)num;