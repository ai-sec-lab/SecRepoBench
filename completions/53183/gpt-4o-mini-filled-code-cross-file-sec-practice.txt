const char *e = p;
  int sign = 1;

  // Skip whitespace
  while (e < end && isspace((unsigned char)*e)) {
    e++;
  }

  // Check for optional sign
  if (e < end && (*e == '-' || *e == '+')) {
    if (*e == '-') {
      sign = -1;
    }
    e++;
  }

  // Validate and parse digits
  if (e < end && isdigit((unsigned char)*e)) {
    *valp = 0;
    while (e < end && isdigit((unsigned char)*e)) {
      *valp = *valp * 10 + (*e - '0');
      e++;
    }
    *valp *= sign; // Apply sign
  } else {
    return NULL; // Parsing failed
  }

  // Skip any trailing whitespace
  while (e < end && isspace((unsigned char)*e)) {
    e++;
  }

  return e; // Return the updated pointer to the end of the parsed number