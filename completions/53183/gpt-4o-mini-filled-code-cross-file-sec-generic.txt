const char *e = p;
  int sign = 1;

  // Skip whitespace
  while (e < end && isspace((unsigned char)*e)) {
    e++;
  }

  // Check for sign
  if (e < end && (*e == '-' || *e == '+')) {
    sign = (*e == '-') ? -1 : 1;
    e++;
  }

  // Parse digits
  int num = 0;
  while (e < end && isdigit((unsigned char)*e)) {
    num = num * 10 + (*e - '0');
    e++;
  }

  // If no digits were found, return NULL
  if (e == p || (e == p + 1 && (*p == '-' || *p == '+'))) {
    return NULL;
  }

  // Apply sign
  *valp = sign * num;

  // Return the end pointer
  return e;