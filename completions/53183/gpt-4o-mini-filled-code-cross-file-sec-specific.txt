const char *e = p;
char *endptr;
long value = strtol(p, &endptr, 10);

// Validate the parsed value
if (endptr == p || *endptr != '\0' && endptr != end) {
    return NULL; // Parsing failed or not all characters were consumed
}

// Check for overflow/underflow
if (value < INT_MIN || value > INT_MAX) {
    return NULL; // Value out of range
}

*valp = (int)value;
e = endptr;