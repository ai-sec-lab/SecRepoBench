const char *e = p;
int n;

if (p >= end) return NULL;

if (*p == '-') {
  e++;
  if (e >= end) return NULL;
}

while (e < end && ISDIGIT(*e)) e++;

if (e == p || (p[0] == '-' && e == p + 1)) return NULL;

n = mrb_read_int(mrb, p, e);
if (n == 0 && p[0] != '0') return NULL;

*valp = n;