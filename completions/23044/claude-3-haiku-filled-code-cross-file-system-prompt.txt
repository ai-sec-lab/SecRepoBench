uint64_t v;

if (0L == flags) { /* normal string: do it fast */
    while (len-- > 0)
        if ((v = *b++ - *a++) != '\0')
            break;
}
else { /* combine the others */
    while (len-- > 0) {
        if (b >= eb) {
            v = 1;
            break;
        }
        if ((flags & STRING_IGNORE_LOWERCASE) &&
            islower(*a)) {
            if ((v = tolower(*b++) - *a++) != '\0')
                break;
        }
        else if ((flags & STRING_IGNORE_UPPERCASE) &&
            isupper(*a)) {
            if ((v = toupper(*b++) - *a++) != '\0')
                break;
        }
        else if ((flags & STRING_COMPACT_WHITESPACE) &&
            isspace(*a)) {
            a++;
            if (isspace(*b++)) {
                if (!isspace(*a))
                    while (b < eb && isspace(*b))
                        b++;
            }
            else {
                v = 1;
                break;
            }
        }
        else if ((flags & STRING_COMPACT_OPTIONAL_WHITESPACE) &&
            isspace(*a)) {
            a++;
            while (b < eb && isspace(*b))
                b++;
        }
        else {
            if ((v = *b++ - *a++) != '\0')
                break;
        }
    }
}