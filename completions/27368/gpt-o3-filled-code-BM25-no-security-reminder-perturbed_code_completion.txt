int status;
    size_t footer_start;
    uint8_t *pb;
    size_t out_size;
    uint8_t *out_buf;
    z_stream strm;
    uint32_t crc;

    /*
     * Calculate the maximum required size for the output buffer:
     *   - Worst-case compressed size (approximation of zlib's compressBound)
     *   - GZip header (FLB_GZIP_HEADER_OFFSET bytes)
     *   - CRC32 footer (8 bytes)
     */
    out_size = input_size +
               (input_size >> 12) +     /*  + input_size / 4096   */
               (input_size >> 14) +     /*  + input_size / 16384  */
               (input_size >> 25) +     /*  + input_size / 33554432 */
               13;                      /*  + constant overhead   */

    out_size += FLB_GZIP_HEADER_OFFSET + 8;  /* header + footer */

    /* Allocate memory for the outgoing (compressed) buffer */
    out_buf = flb_malloc(out_size);