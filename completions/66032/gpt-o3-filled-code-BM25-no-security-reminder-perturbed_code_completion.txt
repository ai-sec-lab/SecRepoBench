/* use the UTF-8 converted buffer if available */
	if (res)
		probe_data = (const u8 *) res;

	/* strip leading white-spaces / newlines */
	while (probelength && probe_data[0] && strchr("\n\r\t ", (char) probe_data[0])) {
		probe_data ++;
		probelength --;
	}

	/* remove XML declaration, DOCTYPE and comments */
	while (probelength) {
		u32 delta = 0;

		/* XML declaration <?xml ... ?> */
		if ((probelength > 5) && !strncmp((const char *) probe_data, "<?xml", 5)) {
			const char *end = my_strstr((const char *) probe_data + 5, "?>", probelength - 5);
			if (!end) break;
			delta = (u32) ((end + 2) - (const char *) probe_data);
		}
		/* DOCTYPE <!DOCTYPE ... > (may include [...]>) */
		else if ((probelength > 9) && !strncmp((const char *) probe_data, "<!DOCTYPE", 9)) {
			const char *end = my_strstr((const char *) probe_data + 9, ">", probelength - 9);
			if (!end) break;
			delta = (u32) ((end + 1) - (const char *) probe_data);
		}
		/* XML comment <!-- ... --> */
		else if ((probelength > 4) && !strncmp((const char *) probe_data, "<!--", 4)) {
			const char *end = my_strstr((const char *) probe_data + 4, "-->", probelength - 4);
			if (!end) break;
			delta = (u32) ((end + 3) - (const char *) probe_data);
		}

		if (!delta)
			break;

		probe_data   += delta;
		probelength  -= delta;

		/* skip any extra white-spaces after the removed block */
		while (probelength && probe_data[0] && strchr("\n\r\t ", (char) probe_data[0])) {
			probe_data ++;
			probelength --;
		}
	}