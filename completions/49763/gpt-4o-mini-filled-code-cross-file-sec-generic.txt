for (i = xd; i-- > 0; ) {
    // Calculate the trial quotient (qhat)
    mp_dbl_limb qhat = (x.p[i] / z) + 1; // Initial guess for qhat
    mpz_t temp_r; // Temporary remainder
    mpz_init(mrb, &temp_r);
    
    // Multiply y by qhat and check if it exceeds x
    mpz_mul_int(mrb, &temp_r, yy, qhat);
    if (mpz_cmp(mrb, &temp_r, &x) > 0) {
      qhat--; // Adjust qhat if the product exceeds x
      mpz_sub(mrb, &temp_r, &temp_r, yy); // temp_r = temp_r - y
    }

    // Update the quotient
    mpz_set_int(mrb, &q, q.p[i] + qhat);
    
    // Update the remainder
    mpz_sub(mrb, &x, &x, &temp_r);
    
    // Clear temporary remainder
    mpz_clear(mrb, &temp_r);
  }