for (i = xd - yd; i-- > 0;) {
    mp_dbl_limb qhat = (x.p[i + yd] * MP_LIMB_MAX + x.p[i + yd - 1]) / z;
    if (qhat >= MP_LIMB_MAX) qhat = MP_LIMB_MAX - 1;
    mp_dbl_limb t[yd + 1];
    mul_1(t, &y, qhat);
    int cmp = ucmp_n(&x, &y, i, yd);
    while (cmp < 0) {
      qhat--;
      sub_n(&x, &x, t, i, yd);
      cmp = ucmp_n(&x, &y, i, yd);
    }
    q.p[i] = qhat;
    sub_n(&x, &x, t, i, yd);
  }