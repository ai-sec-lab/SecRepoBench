for (i = xd - yd; i >= 0; i--) {
  mp_dbl_limb qhat = (x.p[xd-1] * (mp_dbl_limb)BASE + x.p[xd-2]) / z;
  if (qhat > (mp_dbl_limb)BASE) {
    qhat = (mp_dbl_limb)BASE - 1;
  }
  mpz_mul_1(mrb, &q, &y, qhat);
  if (ucmp(&x, &q) >= 0) {
    usub(mrb, &x, &x, &q);
    q.p[i] = qhat;
  } else {
    q.p[i] = qhat - 1;
    mpz_mul_1(mrb, &q, &y, q.p[i]);
    usub(mrb, &x, &x, &q);
  }
  while (x.sz > 0 && x.p[x.sz-1] == 0) {
    x.sz--;
  }
}