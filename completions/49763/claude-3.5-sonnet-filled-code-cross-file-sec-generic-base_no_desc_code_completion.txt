for (i = xd - yd; i >= 0; i--) {
  mp_limb_t qd = (x.p[i+yd] << DIG_SIZE | x.p[i+yd-1]) / z;
  mp_dbl_limb r = (x.p[i+yd] << DIG_SIZE | x.p[i+yd-1]) - qd * z;
  while (r < (mp_dbl_limb)1 << DIG_SIZE && qd * y.p[yd-2] > (r << DIG_SIZE | x.p[i+yd-2])) {
    qd--;
    r += z;
  }
  mp_dbl_limb k = 0;
  for (size_t j = 0; j < yd; j++) {
    mp_dbl_limb p = qd * y.p[j] + k;
    k = p >> DIG_SIZE;
    if (x.p[i+j] < (p & DIG_MASK)) k++;
    x.p[i+j] -= p & DIG_MASK;
  }
  if (x.p[i+yd] < k) {
    qd--;
    mp_limb_t c = 0;
    for (size_t j = 0; j < yd; j++) {
      mp_dbl_limb s = (mp_dbl_limb)x.p[i+j] + y.p[j] + c;
      x.p[i+j] = s & DIG_MASK;
      c = s >> DIG_SIZE;
    }
    x.p[i+yd] += c;
  }
  q.p[i] = qd;
}