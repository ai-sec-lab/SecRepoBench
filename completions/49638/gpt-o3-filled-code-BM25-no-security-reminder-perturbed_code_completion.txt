/* Make sure the separator was found */
  if (ip_port_separator == NULL)
    return 1;

  /* Compute the length of the IP string (between "IP=" and ",PORT=") */
  ip_len = ndpi_min(sizeof(flow->protos.softether.ip) - 1,
                    (size_t)(ip_port_separator - ((char const *)packet_data->payload +
                                                  NDPI_STATICSTRING_LEN("IP="))));
  if (ip_len == 0)
    return 1;

  /* Copy the IP string into the flow structure and NUL-terminate it */
  strncpy(flow->protos.softether.ip,
          (char const *)packet_data->payload + NDPI_STATICSTRING_LEN("IP="),
          ip_len);
  flow->protos.softether.ip[ip_len] = '\0';