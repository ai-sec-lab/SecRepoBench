/* ------------------------------------------------------------- */
    /* Add mandatory Host and Content-Length headers (if body exists) */
    /* ------------------------------------------------------------- */
    if (host) {
        flb_http_add_header(c,
                            "Host", 4,
                            host, strlen(host));
    }

    if (body && body_len > 0) {
        char len_buf[64];
        int  l = snprintf(len_buf, sizeof(len_buf) - 1, "%zu", body_len);
        if (l < 0) {
            flb_errno();
            flb_http_client_destroy(c);
            return NULL;
        }
        len_buf[l] = '\0';
        flb_http_add_header(c,
                            "Content-Length", 14,
                            len_buf, l);
    }

    /* ------------------------------------------------------------- */
    /* If a proxy address was provided, parse and store its settings  */
    /* ------------------------------------------------------------- */
    if (proxy_address) {
        char *proxy_host;
        char *port_ptr;
        int   proxy_port = 80;      /* default HTTP port */

        /* duplicate so we can manipulate the string safely */
        proxy_host = flb_strdup(proxy_address);
        if (!proxy_host) {
            flb_errno();
            flb_http_client_destroy(c);
            return NULL;
        }

        /* strip optional scheme */
        if (strncmp(proxy_host, "http://", 7) == 0) {
            memmove(proxy_host, proxy_host + 7, strlen(proxy_host + 7) + 1);
        }

        /* split host:port (if port supplied) */
        port_ptr = strrchr(proxy_host, ':');
        if (port_ptr) {
            *port_ptr = '\0';
            proxy_port = atoi(port_ptr + 1);
        }

        c->proxy.host = proxy_host;
        c->proxy.port = proxy_port;
    }

    /* ------------------------------------------------------------- */
    /* Allocate buffer for the HTTP response data                    */
    /* ------------------------------------------------------------- */
    c->resp.data = flb_malloc(FLB_HTTP_DATA_SIZE_MAX);