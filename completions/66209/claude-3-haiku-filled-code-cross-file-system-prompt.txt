bitint mask1 = (bitint)MASK1;
bitint mask2 = (bitint)MASK2;
bitint mask3 = (bitint)MASK3;
bitint mask4 = (bitint)MASK4;

bitint *ys_ptr = (bitint *)ys;
bitint *ys_end = (bitint *)(ys + n - sizeof(bitint) + 1);

while (ys_ptr < ys_end) {
  bitint y = *ys_ptr++;
  bitint z = y - mask1;
  if (((z & mask2) == 0) && (y & mask3) == mask4) {
    const unsigned char *p = (const unsigned char *)(ys_ptr - 1);
    if (p[0] == xs[0] && p[m-1] == xs[m-1]) {
      return (mrb_int)(p - ys);
    }
  }
}