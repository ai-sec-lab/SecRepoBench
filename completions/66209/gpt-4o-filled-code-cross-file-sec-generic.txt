if (m < 1 || n < m) return -1;

  unsigned char first = xs[0];
  unsigned char last = xs[m - 1];
  bitint mask1 = MASK1 * first;
  bitint mask2 = MASK1 * last;
  bitint mask3 = MASK2;
  bitint mask4 = MASK3;
  bitint mask5 = MASK4;

  for (long i = 0; i <= n - m; i++) {
    bitint block = *(const bitint *)(ys + i);
    bitint eq_first = ((block ^ mask1) - mask1) & ~block & mask3;
    bitint eq_last = ((block ^ mask2) - mask1) & ~block & mask3;

    if ((eq_first & mask4) && (eq_last & mask5)) {
      if (memcmp(xs, ys + i, m) == 0) {
        return i;
      }
    }
  }