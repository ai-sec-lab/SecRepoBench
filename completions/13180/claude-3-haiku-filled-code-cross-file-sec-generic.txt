// Retrieve and set image properties from TIFF tags.
char message[MagickPathExtent];
uint32 count, length, type;

// Check for OPIIMAGEID tag and set the corresponding image property
if (TIFFGetField(tiff, TIFFTAG_OPIIMAGEID, &count, &text) != 0 && text != NULL) {
    (void) SetImageProperty(image, "tiff:opiimageid", text, exception);
    text = (char *) RelinquishMagickMemory(text);
}

// Check for other TIFF tags and set the corresponding image properties
if (TIFFGetField(tiff, TIFFTAG_ARTIST, &text) != 0 && text != NULL) {
    (void) SetImageProperty(image, "tiff:artist", text, exception);
    text = (char *) RelinquishMagickMemory(text);
}
if (TIFFGetField(tiff, TIFFTAG_DOCUMENTNAME, &text) != 0 && text != NULL) {
    (void) SetImageProperty(image, "tiff:document", text, exception);
    text = (char *) RelinquishMagickMemory(text);
}
if (TIFFGetField(tiff, TIFFTAG_IMAGEDESCRIPTION, &text) != 0 && text != NULL) {
    (void) SetImageProperty(image, "comment", text, exception);
    text = (char *) RelinquishMagickMemory(text);
}

// Handle the subfiletype field
uint32 subfiletype;
if (TIFFGetField(tiff, TIFFTAG_SUBFILETYPE, &subfiletype) != 0) {
    if (subfiletype == FILETYPE_REDUCEDIMAGE) {
        (void) SetImageProperty(image, "tiff:subfiletype", "REDUCEDIMAGE", exception);
    } else if (subfiletype == FILETYPE_PAGE) {
        (void) SetImageProperty(image, "tiff:subfiletype", "PAGE", exception);
    } else if (subfiletype == FILETYPE_MASK) {
        (void) SetImageProperty(image, "tiff:subfiletype", "MASK", exception);
    }
}