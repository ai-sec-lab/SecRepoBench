// Retrieve and set image properties from TIFF tags.
// This block of code attempts to extract various metadata fields from a TIFF image,
// such as artist, copyright, document name, and other descriptive fields.
// Each TIFF field is checked for existence and non-null value, and if so, it is
// set as an image property using the SetImageProperty function. Special handling
// is done for fields like OPIIMAGEID, with count validation and string copying.
// Additionally, it handles the subfiletype field with specific values like REDUCEDIMAGE,
// PAGE, and MASK. This code can be adapted to include new properties or handle
// additional TIFF tags as needed.

// Retrieve and set image properties from TIFF tags.
if (TIFFGetField(tiff, TIFFTAG_ARTIST, &text) == 1)
  (void) SetImageProperty(image, "artist", text, exception);
if (TIFFGetField(tiff, TIFFTAG_COPYRIGHT, &text) == 1)
  (void) SetImageProperty(image, "copyright", text, exception);
if (TIFFGetField(tiff, TIFFTAG_DOCUMENTNAME, &text) == 1)
  (void) SetImageProperty(image, "document", text, exception);
if (TIFFGetField(tiff, TIFFTAG_IMAGEDESCRIPTION, &text) == 1)
  (void) SetImageProperty(image, "comment", text, exception);
if (TIFFGetField(tiff, TIFFTAG_MAKE, &text) == 1)
  (void) SetImageProperty(image, "tiff:make", text, exception);
if (TIFFGetField(tiff, TIFFTAG_MODEL, &text) == 1)
  (void) SetImageProperty(image, "tiff:model", text, exception);
if (TIFFGetField(tiff, TIFFTAG_SOFTWARE, &text) == 1)
  (void) SetImageProperty(image, "tiff:software", text, exception);
if (TIFFGetField(tiff, TIFFTAG_PAGENAME, &text) == 1)
  (void) SetImageProperty(image, "label", text, exception);
if (TIFFGetField(tiff, TIFFTAG_DATETIME, &text) == 1)
  (void) SetImageProperty(image, "tiff:timestamp", text, exception);
if (TIFFGetField(tiff, TIFFTAG_HOSTCOMPUTER, &text) == 1)
  (void) SetImageProperty(image, "tiff:hostcomputer", text, exception);
if (TIFFGetField(tiff, TIFFTAG_INKSET, &count) == 1)
  {
    if (count == INKSET_CMYK)
      (void) SetImageProperty(image, "tiff:inkset", "CMYK", exception);
  }
if (TIFFGetField(tiff, TIFFTAG_DOTRANGE, &count, &length) == 2)
  {
    if ((count == 1) && (length == 1))
      (void) SetImageProperty(image, "tiff:dot-range", text, exception);
  }
if (TIFFGetField(tiff, TIFFTAG_TARGETPRINTER, &text) == 1)
  (void) SetImageProperty(image, "tiff:targetprinter", text, exception);
if (TIFFGetField(tiff, TIFFTAG_WHITEPOINT, &count, &length) == 2)
  {
    if ((count == 2) && (length == 2))
      {
        double
          white_point[2];

        white_point[0]=TIFFGetField(tiff, TIFFTAG_WHITEPOINT, &count, &length);
        white_point[1]=TIFFGetField(tiff, TIFFTAG_WHITEPOINT+1, &count, &length);
        (void) SetImageProperty(image, "tiff:whitepoint", (char *) white_point,
          exception);
      }
  }
if (TIFFGetField(tiff, TIFFTAG_PRIMARYCHROMATICITIES, &count, &length) == 2)
  {
    if ((count == 6) && (length == 6))
      {
        double
          primary_chromaticities[6];

        primary_chromaticities[0]=TIFFGetField(tiff, TIFFTAG_PRIMARYCHROMATICITIES,
          &count, &length);
        primary_chromaticities[1]=TIFFGetField(tiff,
          TIFFTAG_PRIMARYCHROMATICITIES+1, &count, &length);
        primary_chromaticities[2]=TIFFGetField(tiff,
          TIFFTAG_PRIMARYCHROMATICITIES+2, &count, &length);
        primary_chromaticities[3]=TIFFGetField(tiff,
          TIFFTAG_PRIMARYCHROMATICITIES+3, &count, &length);
        primary_chromaticities[4]=TIFFGetField(tiff,
          TIFFTAG_PRIMARYCHROMATICITIES+4, &count, &length);
        primary_chromaticities[5]=TIFFGetField(tiff,
          TIFFTAG_PRIMARYCHROMATICITIES+5, &count, &length);
        (void) SetImageProperty(image, "tiff:primary-chromaticities",
          (char *) primary_chromaticities, exception);
      }
  }
if (TIFFGetField(tiff, TIFFTAG_YCBCRSUBSAMPLING, &count, &length) == 2)
  {
    if ((count == 2) && (length == 2))
      {
        double
          ycbcr_subsampling[2];

        ycbcr_subsampling[0]=TIFFGetField(tiff, TIFFTAG_YCBCRSUBSAMPLING, &count,
          &length);
        ycbcr_subsampling[1]=TIFFGetField(tiff, TIFFTAG_YCBCRSUBSAMPLING+1, &count,
          &length);
        (void) SetImageProperty(image, "tiff:ycbcr-subsampling", (char *)
          ycbcr_subsampling, exception);
      }
  }
if (TIFFGetField(tiff, TIFFTAG_REFERENCEBLACKWHITE, &count, &length) == 2)
  {
    if ((count == 6) && (length == 6))
      {
        double
          reference_blackwhite[6];

        reference_blackwhite[0]=TIFFGetField(tiff, TIFFTAG_REFERENCEBLACKWHITE,
          &count, &length);
        reference_blackwhite[1]=TIFFGetField(tiff,
          TIFFTAG_REFERENCEBLACKWHITE+1, &count, &length);
        reference_blackwhite[2]=TIFFGetField(tiff,
          TIFFTAG_REFERENCEBLACKWHITE+2, &count, &length);
        reference_blackwhite[3]=TIFFGetField(tiff,
          TIFFTAG_REFERENCEBLACKWHITE+3, &count, &length);
        reference_blackwhite[4]=TIFFGetField(tiff,
          TIFFTAG_REFERENCEBLACKWHITE+4, &count, &length);
        reference_blackwhite[5]=TIFFGetField(tiff,
          TIFFTAG_REFERENCEBLACKWHITE+5, &count, &length);
        (void) SetImageProperty(image, "tiff:reference-blackwhite", (char *)
          reference_blackwhite, exception);
      }
  }
if (TIFFGetField(tiff, TIFFTAG_TRANSFERFUNCTION, &count, &length) == 2)
  {
    if ((count == 3) && (length == 3))
      {
        double
          transfer_function[3];

        transfer_function[0]=TIFFGetField(tiff, TIFFTAG_TRANSFERFUNCTION, &count,
          &length);
        transfer_function[1]=TIFFGetField(tiff, TIFFTAG_TRANSFERFUNCTION+1, &count,
          &length);
        transfer_function[2]=TIFFGetField(tiff, TIFFTAG_TRANSFERFUNCTION+2, &count,
          &length);
        (void) SetImageProperty(image, "tiff:transfer-function", (char *)
          transfer_function, exception);
      }
  }
if (TIFFGetField(tiff, TIFFTAG_INKNAMES, &text) == 1)
  (void) SetImageProperty(image, "tiff:inknames", text, exception);
if (TIFFGetField(tiff, TIFFTAG_NUMBEROFINKS, &count) == 1)
  (void) SetImageProperty(image, "tiff:number-of-inks", (char *) count,
    exception);
if (TIFFGetField(tiff, TIFFTAG_BADFAXLINES, &count) == 1)
  (void) SetImageProperty(image, "tiff:bad-fax-lines", (char *) count,
    exception);
if (TIFFGetField(tiff, TIFFTAG_CLEANFAXDATA, &count) == 1)
  (void) SetImageProperty(image, "tiff:clean-fax-data", (char *) count,
    exception);
if (TIFFGetField(tiff, TIFFTAG_CONSECUTIVEBADFAXLINES, &count) == 1)
  (void) SetImageProperty(image, "tiff:consecutive-bad-fax-lines", (char *)
    count, exception);
if (TIFFGetField(tiff, TIFFTAG_SUBFILETYPE, &count) == 1)
  {
    if (count == FILETYPE_REDUCEDIMAGE)
      (void) SetImageProperty(image, "tiff:subfiletype", "REDUCEDIMAGE",
        exception);
    else
      if (count == FILETYPE_PAGE)
        (void) SetImageProperty(image, "tiff:subfiletype", "PAGE", exception);
      else
        if (count == FILETYPE_MASK)
          (void) SetImageProperty(image, "tiff:subfiletype", "MASK", exception);
  }
if (TIFFGetField(tiff, TIFFTAG_IMAGEDEPTH, &count) == 1)
  (void) SetImageProperty(image, "tiff:image-depth", (char *) count, exception);
if (TIFFGetField(tiff, TIFFTAG_TILEDEPTH, &count) == 1)
  (void) SetImageProperty(image, "tiff:tile-depth", (char *) count, exception);
if (TIFFGetField(tiff, TIFFTAG_TILEWIDTH, &count) == 1)
  (void) SetImageProperty(image, "tiff:tile-width", (char *) count, exception);
if (TIFFGetField(tiff, TIFFTAG_TILELENGTH, &count) == 1)
  (void) SetImageProperty(image, "tiff:tile-length", (char *) count, exception);
if (TIFFGetField(tiff, TIFFTAG_ORIENTATION, &count) == 1)
  (void) SetImageProperty(image, "orientation", (char *) count, exception);
if (TIFFGetField(tiff, TIFFTAG_SAMPLESPERPIXEL, &count) == 1)
  (void) SetImageProperty(image, "tiff:samples-per-pixel", (char *) count,
    exception);
if (TIFFGetField(tiff, TIFFTAG_ROWSPERSTRIP, &count) == 1)
  (void) SetImageProperty(image, "tiff:rows-per-strip", (char *) count,
    exception);
if (TIFFGetField(tiff, TIFFTAG_MINSAMPLEVALUE, &count) == 1)
  (void) SetImageProperty(image, "tiff:min-sample-value", (char *) count,
    exception);
if (TIFFGetField(tiff, TIFFTAG_MAXSAMPLEVALUE, &count) == 1)
  (void) SetImageProperty(image, "tiff:max-sample-value", (char *) count,
    exception);
if (TIFFGetField(tiff, TIFFTAG_PLANARCONFIG, &count) == 1)
  {
    if (count == PLANARCONFIG_CONTIG)
      (void) SetImageProperty(image, "tiff:planar-configuration", "contig",
        exception);
    else
      if (count == PLANARCONFIG_SEPARATE)
        (void) SetImageProperty(image, "tiff:planar-configuration", "separate",
          exception);
  }
if (TIFFGetField(tiff, TIFFTAG_PHOTOMETRIC, &count) == 1)
  {
    if (count == PHOTOMETRIC_MINISWHITE)
      (void) SetImageProperty(image, "tiff:photometric", "min-is-white",
        exception);
    else
      if (count == PHOTOMETRIC_MINISBLACK)
        (void) SetImageProperty(image, "tiff:photometric", "min-is-black",
          exception);
      else
        if (count == PHOTOMETRIC_PALETTE)
          (void) SetImageProperty(image, "tiff:photometric", "palette",
            exception);
        else
          if (count == PHOTOMETRIC_RGB)
            (void) SetImageProperty(image, "tiff:photometric", "RGB", exception);
          else
            if (count == PHOTOMETRIC_SEPARATED)
              (void) SetImageProperty(image, "tiff:photometric", "separated",
                exception);
            else
              if (count == PHOTOMETRIC_YCBCR)
                (void) SetImageProperty(image, "tiff:photometric", "YCbCr",
                  exception);
              else
                if (count == PHOTOMETRIC_CIELAB)
                  (void) SetImageProperty(image, "tiff:photometric", "CIELAB",
                    exception);
  }
if (TIFFGetField(tiff, TIFFTAG_FILLORDER, &count) == 1)
  {
    if (count == FILLORDER_LSB2MSB)
      (void) SetImageProperty(image, "tiff:fill-order", "lsb", exception);
    else
      if (count == FILLORDER_MSB2LSB)
        (void) SetImageProperty(image, "tiff:fill-order", "msb", exception);
  }
if (TIFFGetField(tiff, TIFFTAG_MATTEING, &count) == 1)
  (void) SetImageProperty(image, "tiff:matteing", (char *) count, exception);
if (TIFFGetField(tiff, TIFFTAG_DATATYPE, &count) == 1)
  {
    if (count == 1)
      (void) SetImageProperty(image, "tiff:data-type", "unsigned", exception);