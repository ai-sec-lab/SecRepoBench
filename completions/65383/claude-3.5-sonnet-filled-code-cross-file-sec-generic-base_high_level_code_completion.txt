case 'H': case 'Z': case 'B':
    if (!tm->blk) {
        if (!(tm->blk = cram_new_block(EXTERNAL, key)))
            goto err;
        codec->out = tm->blk;
    }

    if (aux[2] == 'H') {
        // Hex format
        aux += 3;
        while (*aux && aux < aux_end) {
            unsigned char b = hts_hex2nibble(*aux++);
            if (b == 0xff) goto err;
            b <<= 4;
            if (*aux) {
                b |= hts_hex2nibble(*aux++);
                if (b == 0xff) goto err;
            }
            BLOCK_APPEND_CHAR(tm->blk, b);
        }
        BLOCK_APPEND_CHAR(tm->blk, 0);
    } else if (aux[2] == 'Z') {
        // Zero terminated string
        aux += 3;
        BLOCK_APPEND(tm->blk, aux, strlen((char *)aux)+1);
        aux += strlen((char *)aux)+1;
    } else {
        // 'B' array
        int type = aux[3], blen;
        int32_t count = le_to_i32((uint8_t *)aux+4);
        if (count < 0 || aux_end - aux < 8) goto err;

        aux += 8;
        switch (type) {
        case 'c': case 'C': blen = 1; break;
        case 's': case 'S': blen = 2; break;
        case 'i': case 'I': case 'f': blen = 4; break;
        default: goto err;
        }

        if (aux_end - aux < blen * count) goto err;
        BLOCK_APPEND(tm->blk, aux-8, blen*count+8);
        aux += blen*count;
    }
    break;