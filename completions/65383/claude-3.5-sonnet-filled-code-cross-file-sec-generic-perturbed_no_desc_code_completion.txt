case 'Z': case 'H': case 'B':
    if (!tm->blk) {
        if (!(tm->blk = cram_new_block(EXTERNAL, key)))
            goto err;
        codec->u.e_byte_array_len.val_codec->out = tm->blk;
    }

    aux += 3;
    {
        char *aux_end;
        if (aux[0] == 'B') {
            int type = aux[1];
            int32_t count = le_to_i32(&aux[2]);
            int32_t i;
            aux += 6;

            switch (type) {
            case 'c': case 'C':
                for (i = 0; i < count; i++)
                    BLOCK_APPEND_CHAR(tm->blk, aux[i]);
                aux += count;
                break;
            case 's': case 'S':
                for (i = 0; i < count; i++) {
                    BLOCK_APPEND(tm->blk, aux, 2);
                    aux += 2;
                }
                break;
            case 'i': case 'I': case 'f':
                for (i = 0; i < count; i++) {
                    BLOCK_APPEND(tm->blk, aux, 4);
                    aux += 4;
                }
                break;
            default:
                hts_log_error("Unknown aux type 'B%c'", type);
                goto err;
            }
        } else {
            aux_end = memchr(aux, '\0', aux_end - aux);
            if (!aux_end)
                goto err;
            BLOCK_APPEND(tm->blk, aux, aux_end - aux + 1);
            aux = aux_end + 1;
        }
    }
    break;