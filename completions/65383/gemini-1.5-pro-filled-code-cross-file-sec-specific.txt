case 'H':
    if (aux_end - aux < 4)
        goto err;

    if (!tm->blk) {
        if (!(tm->blk = cram_new_block(EXTERNAL, key)))
            goto err;
        codec->u.e_byte_array_len.val_codec->out = tm->blk;
    }

    aux+=3;
    size_t len = strlen(aux);
    if (aux_end - aux - 1 < len)
        goto err;
    if (len & 1)
        goto err;
    len /= 2;

    if (cram_codec_decode_hex(aux, len, BLOCK_END(tm->blk),
                              BLOCK_GROW(tm->blk, len)) < 0)
        goto err;
    BLOCK_SIZE(tm->blk) += len;
    aux += len*2;
    break;

case 'B': {
    if (aux_end - aux < 5)
        goto err;

    if (!tm->blk) {
        if (!(tm->blk = cram_new_block(EXTERNAL, key)))
            goto err;
        codec->u.e_byte_array_len.val_codec->out = tm->blk;
    }

    aux+=3;
    char sub_type = *aux++;
    int32_t count;
    memcpy(&count, aux, 4);
    count = le_to_be32(count);
    aux+=4;

    size_t len = 0;
    switch (sub_type) {
    case 'c': case 'C': len = count; break;
    case 's': case 'S': len = count * 2; break;
    case 'i': case 'I': case 'f': len = count * 4; break;
    default:
        hts_log_error("Unhandled sub-type '%c' in type B tag", sub_type);
        goto err;
    }

    if (aux_end - aux < len)
        goto err;

    BLOCK_APPEND(tm->blk, aux, len);
    aux += len;
    break;
}