hb_buffer_t *buf = hb_serialize_context_get_buffer (c);
VarRegionList *dest = hb_buffer_alloc (buf, sizeof (VarRegionList), &regionmapping);
if (unlikely (!dest)) return false;

dest->axis_count = src->axis_count;
dest->region_count = regionmapping.size;

size_t size = sizeof (VarRegionList) + (dest->axis_count * sizeof (VarAxis)) + (dest->region_count * sizeof (VarRegion));
if (unlikely (!hb_buffer_ensure (buf, size))) return false;

dest->axes = hb_buffer_alloc (buf, dest->axis_count * sizeof (VarAxis), &regionmapping);
dest->regions = hb_buffer_alloc (buf, dest->region_count * sizeof (VarRegion), &regionmapping);

for (unsigned int i = 0; i < regionmapping.size; i++) {
  const hb_pair_t &p = regionmapping.get_pair (i);
  dest->regions[i] = src->regions[p.second];
  dest->regions[i].axis = dest->axes + p.first;
}

return true;