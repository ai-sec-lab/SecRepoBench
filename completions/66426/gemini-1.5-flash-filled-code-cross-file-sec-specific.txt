bitint *s0 = (bitint *)xs;
  bitint *s1 = (bitint *)ys;
  long i = 0;
  long nn = n - m + 1;
  bitint a, b, c;

  if (m == 0) return 0;
  if (n < m) return -1;

  for (; i+m <= n; i += sizeof(bitint)) {
    a = *s1;
    b = *s0;
    c = a ^ b;
    c |= c >> 1;
    c |= c >> 2;
    c |= c >> 4;
#ifdef MRB_64BIT
    c |= c >> 8;
    c |= c >> 16;
    c |= c >> 32;
#endif
    if (~c & MASK1) {
      break;
    }
    s1++;
  }
  if (i+m > n) return -1;

  if (m == 1) return i;

  if (((*s1) & MASK4) != ((*s0) & MASK4)) {
    i += sizeof(bitint);
    s1++;
  }

  for (; i < nn; i++) {
    if (ys[i] == xs[0] && memcmp(ys + i + 1, xs + 1, m - 1) == 0) {
      return i;
    }
  }