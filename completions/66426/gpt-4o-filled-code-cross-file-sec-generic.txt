if (m < 1 || n < m) return -1;

  const char *s0 = ys;
  const char *s1 = xs;
  bitint v0, v1, v2, v3, v4;
  long i;

  v0 = (bitint)(unsigned char)s1[0] * MASK1;
  v1 = (bitint)(unsigned char)s1[m-1] * MASK1;

  for (i = 0; i <= n - m; i++) {
    v2 = *(const bitint *)(s0 + i) ^ v0;
    v3 = *(const bitint *)(s0 + i + m - 1) ^ v1;
    v4 = (v2 - MASK1) & ~v2 & MASK2 & (v3 - MASK1) & ~v3 & MASK2;
    if (v4) {
      if (memcmp(s0 + i + 1, s1 + 1, m - 2) == 0) {
        return i;
      }
    }
  }