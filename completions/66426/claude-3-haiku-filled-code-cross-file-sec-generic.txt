bitint a, b, c, d;
  const bitint *ap = (const bitint*)p;
  const bitint *ae = (const bitint*)(ys + n - sizeof(bitint) + 1);
  const bitint *xs_bits = (const bitint*)xs;

  for (; ap < ae; ap++) {
    a = *ap;
    b = a ^ (*xs_bits);
    c = (b - MASK1) & ~b & MASK2;
    d = (c >> (CHAR_BIT * (sizeof(bitint) - 1))) & MASK4;
    if (d) {
      return (mrb_int)((const char*)ap - ys);
    }
  }