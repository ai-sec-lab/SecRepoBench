const bitint *pattern = (const bitint *)xs;
  const bitint *text = (const bitint *)ys;
  long i = 0;

  // Ensure that the pattern and text are not NULL and lengths are valid
  if (xs == NULL || ys == NULL || m <= 0 || n <= 0 || m > n) {
    return -1;
  }

  // Align the text pointer to the nearest bitint boundary
  while (i <= n - m) {
    bitint text_chunk = *(text + (i / sizeof(bitint)));
    bitint pattern_chunk = *pattern;

    // Create masks for the pattern
    bitint mask = (text_chunk ^ pattern_chunk) & MASK2;

    // Check if there is a match
    if ((mask - MASK1) & ~mask) {
      // Check for the exact match
      if (memcmp(ys + i, xs, m) == 0) {
        return (mrb_int)i; // Return the index of the match
      }
    }
    i += sizeof(bitint);
  }

  // Handle remaining bytes
  for (; i <= n - m; i++) {
    if (memcmp(ys + i, xs, m) == 0) {
      return (mrb_int)i; // Return the index of the match
    }
  }

  return -1; // Pattern not found