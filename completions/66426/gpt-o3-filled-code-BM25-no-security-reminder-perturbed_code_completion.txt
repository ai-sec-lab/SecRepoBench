mrb_int i;
  const char *s0;

  /* trivial cases */
  if (m == 0) return 0;       /* empty needle */
  if (n < m)  return -1;      /* needle longer than haystack */

  /* simple, portable byte-wise search */
  for (i = 0; i <= n - m; i++) {
    if (ys[i] == needle[0]) {
      if (m == 1 || memcmp(ys + i + 1, needle + 1, m - 1) == 0) {
        return i;             /* match found */
      }
    }
  }

  /* not found â€“ make the fallback block a no-op */
  i  = n;
  s0 = ys + n;