if (m <= 0 || n <= 0 || m > n) return -1;

  const char *s0 = ys;
  const char *s1 = xs;
  bitint v0, v1, v2, v3, v4;
  long i;

  v1 = (bitint)(unsigned char)s1[0] * MASK1;
  v2 = (bitint)(unsigned char)s1[m-1] * MASK1;
  v3 = (bitint)(unsigned char)s1[m/2] * MASK1;

  for (i = 0; i <= n - m; i++) {
    v0 = *(const bitint*)(s0 + i);
    v4 = v0 ^ v1;
    v4 = (v4 - MASK1) & ~v4 & MASK2;
    if (v4) {
      v0 = *(const bitint*)(s0 + i + m - sizeof(bitint));
      v4 = v0 ^ v2;
      v4 = (v4 - MASK1) & ~v4 & MASK2;
      if (v4) {
        v0 = *(const bitint*)(s0 + i + m/2 - sizeof(bitint));
        v4 = v0 ^ v3;
        v4 = (v4 - MASK1) & ~v4 & MASK2;
        if (v4) {
          if (memcmp(s0 + i, s1, m) == 0) {
            return i;
          }
        }
      }
    }
  }