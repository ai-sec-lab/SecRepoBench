const char *s0 = xs;
  const char *ys0 = ys;
  bitint x = *s0++ | MASK3;
  bitint y = 0;
  long i = 0;

  if (m > n) return -1;

  for (; i < n; i++, ys++) {
    y = (*ys | MASK3);
    if ((y^x) & MASK4) {
      continue;
    }
    if (m == 1) {
      return (mrb_int)i;
    }
    bitint z = 0;
#ifdef MRB_ENDIAN_BIG
    for (long j=1; j<m; j++) {
      z |= (bitint)(ys[j]^xs[j]);
    }
#else
    y |= y<<8; y |= y<<16;
#ifdef MRB_64BIT
    y |= y<<32;
#endif
    bitint a = *(bitint*)(ys+1) | MASK3 * MASK1;
    bitint b = *(bitint*)(xs+1) | MASK3 * MASK1;
    z = a^b;
    if (m > sizeof(bitint) && (m-sizeof(bitint)) > 0) {
      a = *(bitint*)(ys+sizeof(bitint)) | MASK3 * MASK1;
      b = *(bitint*)(xs+sizeof(bitint)) | MASK3 * MASK1;
      z |= a^b;
    }
#endif
    if (z == 0) {
      return (mrb_int)i;
    }
  }