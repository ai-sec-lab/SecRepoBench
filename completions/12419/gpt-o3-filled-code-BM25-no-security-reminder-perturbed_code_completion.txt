if (idtable == NULL)
        return(-1);

    /* Build the value of the attribute (the actual ID) */
    ID = xmlNodeListGetString(doc, attr->children, 1);
    if (ID == NULL)
        return(-1);

    /* Lookup the corresponding entry in the ID table */
    id = xmlHashLookup(idtable, ID);

    /* The buffer returned by xmlNodeListGetString() is no longer needed */
    xmlFree(ID);

    /* No matching ID, or it does not correspond to the given attribute */
    if ((id == NULL) || (id->attr != attr))
        return(-1);

    /* Keep the entry in the table, but detach the attribute node that
     * is about to disappear while remembering its name for error reports
     */
    id->name = attr->name;
    id->attr = NULL;

    return(0);