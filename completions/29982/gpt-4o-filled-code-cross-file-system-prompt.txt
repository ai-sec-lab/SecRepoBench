std::unique_ptr<Expression> replacement = std::make_unique<Constructor>(
    expr->fOffset, &c.type(), std::move(flattened));

// Remove references within 'expr', add references within 'replacement'.
optimizationContext->fUsage->replace(expr, replacement.get());

// Attempt to replace the current expression node with the optimized expression.
if (!try_replace_expression(&b, iter, &replacement)) {
    optimizationContext->fNeedsRescan = true;
    return;
}

optimizationContext->fUpdated = true;
SkASSERT((*iter)->isExpression());