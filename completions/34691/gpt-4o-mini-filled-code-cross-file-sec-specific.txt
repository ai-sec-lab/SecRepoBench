mrb_get_args(mrb, "|i", &n);
  if (n < 0) {
    n = 1; // Default to shifting one element if a negative number is provided
  } else if (n > len) {
    n = len; // Adjust n to not exceed the length of the array
  }

  if (len == 0) {
    return mrb_nil_value(); // Return nil if the array is empty
  }

  val = ARY_PTR(a)[0]; // Get the first element to return
  if (n == 1) {
    // Shift one element
    mrb_value *ptr = ARY_PTR(a);
    for (mrb_int i = 0; i < len - 1; i++) {
      ptr[i] = ptr[i + 1];
    }
    ARY_SET_LEN(a, len - 1);
  } else {
    // Shift multiple elements
    if (n >= len) {
      ARY_SET_LEN(a, 0); // Clear the array if n is greater than or equal to len
    } else {
      mrb_value *ptr = ARY_PTR(a);
      for (mrb_int i = 0; i < len - n; i++) {
        ptr[i] = ptr[i + n];
      }
      ARY_SET_LEN(a, len - n);
    }
  }