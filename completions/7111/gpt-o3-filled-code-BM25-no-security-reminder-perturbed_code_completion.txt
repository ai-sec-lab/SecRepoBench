{
      /*
        Allocate sufficient memory for a scanline / strip buffer.
      */
      size_t
        length;

      switch (method)
      {
        case ReadStripMethod:
        {
          /* TIFFReadRGBAStrip() returns rows_per_strip RGBA pixels */
          length=(size_t) image->columns*rows_per_strip*sizeof(uint32);
          break;
        }
        default:
        {
          /* Fallback to the size of one TIFF scanline */
          length=(size_t) TIFFScanlineSize(tiff);
          if (length == 0)
            length=(size_t) image->columns*items_in_pix*
              (((size_t) bits_per_sample+7) >> 3);
          break;
        }
      }

      if (HeapOverflowSanityCheck(length,sizeof(*tiff_pixels)) != MagickFalse)
        ThrowTIFFException(ResourceLimitError,"MemoryAllocationFailed");

      tiff_pixels=(unsigned char *) AcquireQuantumMemory(length,
        sizeof(*tiff_pixels));
      if (tiff_pixels == (unsigned char *) NULL)
        ThrowTIFFException(ResourceLimitError,"MemoryAllocationFailed");
    }