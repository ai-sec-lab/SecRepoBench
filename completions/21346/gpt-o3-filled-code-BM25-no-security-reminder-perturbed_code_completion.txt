{
		/* Check which DCC command follows */
		if((packet->line[i].len - j) > 4 &&
		   (memcmp(&packet->line[i].ptr[j],  "SEND ",   5) == 0 ||
		    memcmp(&packet->line[i].ptr[j],  "TSEND ",  6) == 0 ||
		    memcmp(&packet->line[i].ptr[j],  "CHAT ",   5) == 0 ||
		    memcmp(&packet->line[i].ptr[j],  "chat ",   5) == 0 ||
		    memcmp(&packet->line[i].ptr[j],  "sslchat ",8) == 0)) {

		  /* Skip command word itself (up to first space) */
		  while(j < packet->line[i].len && packet->line[i].ptr[j] != ' ')
		    j++;
		  
		  /* We now expect: <filename> <ip> <port> ...  */
		  space = 0;
		  k = j;
		  while(k < packet->line[i].len && space < 3) {
		    if(packet->line[i].ptr[k] == ' ')
		      space++;
		    k++;
		  }

		  /* k now points to the beginning of the port number */
		  port = 0;
		  while(k < packet->line[i].len &&
			packet->line[i].ptr[k] >= '0' &&
			packet->line[i].ptr[k] <= '9') {
		    port = (u_int16_t)(port * 10 + (packet->line[i].ptr[k] - '0'));
		    k++;
		  }

		  if(port > 0) {
		    struct ndpi_id_struct *ids[2] = { src_id, dst };
		    for(counter = 0; counter < 2; counter++) {
		      struct ndpi_id_struct *id = ids[counter];
		      if(id == NULL) continue;

		      /* Check if port already present */
		      for(h = 0; h < id->irc_number_of_port; h++) {
			if(id->irc_port[h] == port) {
			  id->last_time_port_used[h] = packet->tick_timestamp;
			  break;
			}
		      }

		      if(h == id->irc_number_of_port) { /* new port */
			u_int16_t max_ports = (u_int16_t)(sizeof(id->irc_port)/sizeof(id->irc_port[0]));

			if(id->irc_number_of_port < max_ports) {
			  id->irc_port[id->irc_number_of_port] = port;
			  id->last_time_port_used[id->irc_number_of_port] = packet->tick_timestamp;
			  id->irc_number_of_port++;
			} else {
			  /* Replace the oldest entry */
			  u_int16_t oldest = 0;
			  for(c = 1; c < id->irc_number_of_port; c++) {
			    if(id->last_time_port_used[c] < id->last_time_port_used[oldest])
			      oldest = c;
			  }
			  id->irc_port[oldest] = port;
			  id->last_time_port_used[oldest] = packet->tick_timestamp;
			}
		      }
		    }

		    NDPI_LOG_INFO(ndpi_struct, "IRC DCC port %u stored", port);
		  }
		}
	      }