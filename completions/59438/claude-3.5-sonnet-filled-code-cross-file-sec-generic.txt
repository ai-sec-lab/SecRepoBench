const unsigned char *p = uc;
int records = 0, tapemarks = 0;
uint32_t len, clen;

while (p < ue) {
    if (ue - p < 4)
        return 0;

    len = getlen(p);
    p += 4;

    if (len == 0xFFFFFFFF) // End of Medium marker
        break;

    if (len == 0) {
        tapemarks++;
        if (tapemarks >= SIMH_TAPEMARKS)
            break;
        continue;
    }

    if (ue - p < (ptrdiff_t)(len + 4))
        return 0;

    p += len;
    clen = getlen(p);
    p += 4;

    if (len != ~clen)
        return 0;

    records++;
}

return (records > 0 || tapemarks > 0);