int
simh_parse(const unsigned char *uc, const unsigned char *ue)
{
    int tapemarks = 0;
    int records = 0;
    int valid = 1;

    while (uc < ue) {
        int len = getlen(uc, ue);
        if (len == 0xFFFFFFFF) {
            // End of Medium (EOM) marker found, stop parsing
            break;
        }
        if (len != ~getlen(uc + len, ue)) {
            // Data record length does not match its complement, invalid data
            valid = 0;
            break;
        }
        if (len == 0) {
            // Tapemark found
            tapemarks++;
            if (tapemarks >= SIMH_TAPEMARKS) {
                // Reached the maximum number of tapemarks, stop processing
                break;
            }
        } else {
            // Data record found
            records++;
        }
        uc += len + sizeof(int);
    }

    return valid && records > 0;
}