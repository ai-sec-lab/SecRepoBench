const unsigned char *p = uc;
	uint32_t len, len2;
	int records = 0, tapemarks = 0;

	while (p < ue) {
		len = getlen(p, ue);
		if (len == 0)
			return 0;	// Invalid length
		p += 4;

		if (len == 0xFFFFFFFFU) {
			// End of Medium marker
			return 1;
		}

		p += len;
		if (p >= ue)
			return 0;

		len2 = getlen(p, ue);
		if (len2 == 0)
			return 0;	// Invalid length
		p += 4;

		if (len != len2)
			return 0;	// Length mismatch

		if (len == 0) {
			tapemarks++;
			if (tapemarks > SIMH_TAPEMARKS)
				return 1;	// Reached tapemark limit
		} else {
			records++;
		}
	}

	return (records > 0) ? 1 : 0;