size_t records = 0, tapemarks = 0;
    const unsigned char *p = uc;
    while (p + 4 <= ue) {
        uint32_t len = getlen(p);
        p += 4;
        if (len == 0xFFFFFFFF) { // End of Medium marker
            return 1;
        }
        if (p + len + 4 > ue) {
            return 0; // Invalid length, goes beyond buffer
        }
        if (getlen(p + len) != len) {
            return 0; // Length mismatch
        }
        if (len == 0) {
            tapemarks++;
            if (tapemarks >= SIMH_TAPEMARKS) {
                return 1; // Reached tapemark limit
            }
        } else {
            records++;
        }
        p += len + 4;
    }
    return 0; // Did not find valid SIMH data