const unsigned char *p = uc;
int records = 0, tapemarks = 0;
uint32_t len, clen;

while (p < ue) {
    if (ue - p < 4) {
        return 0;  // Not enough data for a complete record
    }

    len = getlen(p);
    p += 4;

    if (len == 0xFFFFFFFF) {
        // End of Medium marker
        return 1;
    }

    if (len == 0) {
        // Tapemark
        tapemarks++;
        if (tapemarks >= SIMH_TAPEMARKS) {
            return 1;
        }
        continue;
    }

    // Data record
    records++;

    if (ue - p < (ptrdiff_t)(len + 4)) {
        return 0;  // Not enough data for the record and its complement
    }

    p += len;
    clen = getlen(p);
    p += 4;

    if (len != (~clen & 0xFFFFFFFF)) {
        return 0;  // Length mismatch
    }
}

return (records > 0 || tapemarks > 0);