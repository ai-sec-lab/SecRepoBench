int getlen(const unsigned char *uc, const unsigned char *ue) {
    // Function to extract the length from the SIMH tape file data.
    // It checks the length and its complement to ensure validity.
    int len, clen;

    if (uc + 4 >= ue)
        return 0;

    len = (uc[0] << 24) | (uc[1] << 16) | (uc[2] << 8) | uc[3];
    clen = ~len;

    if ((clen & 0xFFFF) != (len >> 16))
        return 0;

    return len;
}

static int
simh_parse(const unsigned char *uc, const unsigned char *ue)
{
    int tapemarks = 0;
    int records = 0;

    while (uc < ue) {
        int len = getlen(uc, ue);
        if (len == 0xFFFFFFFF) {
            // End of Medium (EOM) marker found, stop parsing
            return 1;
        } else if (len <= 0) {
            // Invalid length, return 0 to indicate invalid data
            return 0;
        }

        uc += 4;
        if (len == 0) {
            // Tapemark found, increment the tapemark counter
            tapemarks++;
            if (tapemarks >= SIMH_TAPEMARKS) {
                // Maximum number of tapemarks reached, stop processing
                return 1;
            }
        } else {
            // Data record found, increment the record counter
            records++;
            uc += len;
        }
    }

    // Reached the end of the data without finding the EOM marker
    return 0;
}