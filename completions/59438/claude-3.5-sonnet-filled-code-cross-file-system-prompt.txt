const unsigned char *p = uc;
unsigned int len, records = 0, tapemarks = 0;

while (p < ue) {
    len = getlen(p, ue);
    if (len == 0xFFFFFFFF) // End of Medium marker
        break;
    
    p += 4;
    if (p + len > ue)
        return 0;
    
    if (len == 0) {
        tapemarks++;
        if (tapemarks == SIMH_TAPEMARKS)
            break;
    } else {
        records++;
        p += len;
    }
    
    if (p + 4 > ue)
        return 0;
    
    if (len != ~getlen(p, ue))
        return 0;
    
    p += 4;
}

return (records > 0 || tapemarks > 0);