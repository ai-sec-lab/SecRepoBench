char *ep, *p;
float factor;
int op;

if (me->mp->factor_op != FILE_FACTOR_OP_NONE) {
    file_magwarn(ms, "Duplicate factor in strength type `%c'", me->mp->factor_op);
    return -1;
}

if (me->mp->type == FILE_NAME) {
    file_magwarn(ms, "Strength setting is not supported for FILE_NAME type");
    return -1;
}

p = strchr(line, '*');
if (p == NULL) {
    file_magwarn(ms, "Missing '*' in strength setting");
    return -1;
}

op = *(p - 1);
if (op != '+' && op != '-' && op != '*' && op != '/') {
    file_magwarn(ms, "Invalid operator '%c' in strength setting", op);
    return -1;
}

factor = strtof(p + 1, &ep);
if (*ep != '\0' || ep == p + 1) {
    file_magwarn(ms, "Invalid factor value in strength setting");
    return -1;
}

if (factor <= 0.0 || factor > 1.0) {
    file_magwarn(ms, "Factor value must be between 0 and 1");
    return -1;
}

if (op == '/' && factor == 0.0) {
    file_magwarn(ms, "Division by zero in strength setting");
    return -1;
}

me->mp->factor_op = op;
me->mp->factor = factor;

return 0;