private int
parse_strength(struct magic_set *ms, struct magic_entry *me, const char *line,
    size_t len)
{
    struct magic *m = &me->mp[me->cont_count == 0 ? 0 : me->cont_count - 1];
    char *p;
    int op;
    int64_t val;

    EATAB;
    if (*line == '+') {
        m->factor_op = FILE_FACTOR_OP_PLUS;
        line++;
    } else if (*line == '-') {
        m->factor_op = FILE_FACTOR_OP_MINUS;
        line++;
    } else if (*line == '*') {
        m->factor_op = FILE_FACTOR_OP_TIMES;
        line++;
    } else if (*line == '/') {
        m->factor_op = FILE_FACTOR_OP_DIV;
        line++;
    } else {
        file_magwarn(ms, "Strength must be prefixed with +, -, *, or /");
        return -1;
    }

    EATAB;
    val = strtoll(line, &p, 0);
    if (p == line) {
        file_magwarn(ms, "Strength must be a number");
        return -1;
    }
    if (val < 0) {
        file_magwarn(ms, "Strength must be a positive number");
        return -1;
    }
    if (m->factor_op == FILE_FACTOR_OP_DIV && val == 0) {
        file_magwarn(ms, "Strength division by zero");
        return -1;
    }
    m->factor = CAST(int32_t, val);

    return 0;
}