const char *p;
	char *ep;
	int op;
	uint64_t val;

	if (me->mp == NULL) {
		file_magerror(ms, "No current entry for strength");
		return -1;
	}
	if (me->cont_count == 0) {
		file_magerror(ms, "Strength present with 0 count");
		return -1;
	}
	if (me->mp[me->cont_count - 1].type == FILE_NAME) {
		file_magwarn(ms, "strength settings are not supported for "
		    "FILE_NAME entries");
		return 0;
	}

	EATAB;
	if ((op = get_op(*line)) == -1) {
		file_magwarn(ms, "strength operation `%c' invalid", *line);
		return 0;
	}
	line++;
	errno = 0;
	val = CAST(uint64_t, strtoull(line, &ep, 0));
	if (errno != 0) {
		file_magwarn(ms, "strength value `%s' invalid", line);
		return 0;
	}
	line = ep;
	if (val > 1000000) {
		file_magwarn(ms, "strength value `%" PRIu64 "' too large", val);
		return 0;
	}
	if (op == FILE_OPDIVIDE && val == 0) {
		file_magwarn(ms, "strength value `%" PRIu64 "' cannot be "
		    "combined with division", val);
		return 0;
	}
	me->mp[me->cont_count - 1].factor_op = op;
	me->mp[me->cont_count - 1].factor = CAST(uint32_t, val);
	return 0;