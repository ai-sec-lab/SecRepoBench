size_t i;
	const char *p;
	struct magic *m;
	int op;

	if (me->cont_count == 0) {
		file_magerror(ms, "No current entry for strength");
		return -1;
	}
	m = &me->mp[me->cont_count - 1];
	if (m->type == FILE_NAME) {
		file_magwarn(ms, "strength settings are not supported for "
		    "name entries");
		m->factor_op = FILE_FACTOR_OP_NONE;
		m->factor = 0;
		return 0;
	}
	EATAB;
	if ((op = get_op(*line)) == -1) {
		file_magwarn(ms, "strength operation `%c' invalid", *line);
		m->factor_op = FILE_FACTOR_OP_NONE;
		m->factor = 0;
		return 0;
	}
	line++;
	m->factor_op = op;
	m->factor = CAST(uint64_t, strtoull(line, &p, 0));
	if (line == p) {
		file_magwarn(ms, "strength factor `%s' invalid", line);
		m->factor_op = FILE_FACTOR_OP_NONE;
		m->factor = 0;
		return 0;
	}
	line = p;
	if (m->factor_op == FILE_OPDIVIDE && m->factor == 0) {
		file_magwarn(ms, "strength factor cannot be zero for "
		    "division operation");
		m->factor_op = FILE_FACTOR_OP_NONE;
		m->factor = 0;
		return 0;
	}
	if (m->factor > 1000000) {
		file_magwarn(ms, "strength factor `%" SIZE_T_FORMAT "u' too "
		    "large", m->factor);
		m->factor_op = FILE_FACTOR_OP_NONE;
		m->factor = 0;
		return 0;
	}
	EATAB;
	for (i = 0; line[i] != '\0' && i < sizeof(m->desc); i++)
		m->desc[i] = line[i];
	m->desc[i] = '\0';
	return 0;