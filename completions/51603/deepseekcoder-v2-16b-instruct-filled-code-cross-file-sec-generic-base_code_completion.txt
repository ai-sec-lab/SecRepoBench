private int
parse_strength(struct magic_set *ms, struct magic_entry *me, const char *line,
    size_t len __attribute__((__unused__)))
{
    // This function parses a strength annotation line from a magic file
    // and sets the corresponding factor operation and value in the magic
    // entry. It begins by setting up variables and checking if a strength
    // type is already defined. If the entry is of type FILE_NAME, it warns
    // that strength settings are not supported. It reads the operation type
    // and factor value, verifying that the factor is within valid limits
    // and not combined with a division operation when zero. If errors are
    // detected, it resets the factor operation and value to defaults.
    // <MASK>

    // Check if a strength type is already defined
    if (me->mp == NULL || me->mp->factor_op != FILE_FACTOR_OP_NONE) {
        file_magerror(ms, "Strength type already defined or no current entry");
        return -1;
    }

    // Check if the entry is of type FILE_NAME, which does not support strength settings
    if (me->mp->type == FILE_NAME) {
        file_magwarn(ms, "Strength settings are not supported for FILE_NAME entries");
        return -1;
    }

    // Read the operation type and factor value
    char *endptr;
    long factor = strtol(line, &endptr, 10);
    if (endptr == line || *endptr != '\0') {
        file_magerror(ms, "Invalid factor value in strength annotation");
        return -1;
    }

    // Verify that the factor is within valid limits
    if (factor < -1000 || factor > 1000) {
        file_magwarn(ms, "Factor value out of range (must be between -1000 and 1000)");
        return -1;
    }

    // Check if the factor is zero and the operation is division
    if (factor == 0 && me->mp->factor_op == FILE_FACTOR_OP_DIV) {
        file_magwarn(ms, "Division by zero is not allowed");
        return -1;
    }

    // Set the factor operation and value
    me->mp->factor_op = FILE_FACTOR_OP_PLUS; // Default operation is addition
    me->mp->factor = CAST(int32_t, factor);

    // Return success
    return 0;
}