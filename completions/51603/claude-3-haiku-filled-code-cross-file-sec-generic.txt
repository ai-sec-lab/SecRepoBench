private int
parse_strength(struct magic_set *ms, struct magic_entry *me, const char *line,
    size_t len)
{
    struct magic *m = &me->mp[me->cont_count == 0 ? 0 : me->cont_count - 1];
    char *p, *q;
    int op;
    int factor;

    // Check if a strength type is already defined
    if (m->factor_op != FILE_FACTOR_OP_NONE) {
        file_magwarn(ms, "Strength already defined for this entry");
        return -1;
    }

    // If the entry is of type FILE_NAME, warn that strength settings are not supported
    if (m->type == FILE_NAME) {
        file_magwarn(ms, "Strength settings not supported for NAME entries");
        return -1;
    }

    // Read the operation type and factor value
    p = CCAST(char *, line);
    EATAB;
    if ((op = get_op(*p)) == -1) {
        file_magwarn(ms, "Invalid strength operation: `%c'", *p);
        return -1;
    }
    p++;
    EATAB;
    factor = CAST(int, strtol(p, &q, 0));
    if (p == q) {
        file_magwarn(ms, "Invalid strength factor: `%s'", p);
        return -1;
    }

    // Verify that the factor is within valid limits and not combined with a division operation when zero
    if (factor < -100 || factor > 100) {
        file_magwarn(ms, "Strength factor %d out of range (-100 to 100)", factor);
        return -1;
    }
    if (factor == 0 && op == FILE_OPDIVIDE) {
        file_magwarn(ms, "Strength factor 0 cannot be used with division");
        return -1;
    }

    // Set the factor operation and value
    m->factor_op = op;
    m->factor = factor;
    return 0;
}