private int
parse_strength(struct magic_set *ms, struct magic_entry *me, const char *line,
    size_t len __attribute__((__unused__)))
{
    struct magic *m;
    char *p;
    int factor_op;
    float factor;

    if (me->cont_count == 0) {
        file_error(ms, 0, "No current entry for strength");
        return -1;
    }

    m = &me->mp[me->cont_count - 1];

    if (m->factor_op != FILE_FACTOR_OP_NONE) {
        file_error(ms, 0, "Strength already defined");
        return -1;
    }

    if (m->type == FILE_NAME) {
        file_error(ms, 0, "Strength not supported for FILE_NAME");
        return -1;
    }

    p = strchr(line, '*');
    if (p == NULL) {
        p = strchr(line, '/');
        if (p == NULL) {
            file_error(ms, 0, "Bad strength operator");
            return -1;
        }
        factor_op = FILE_FACTOR_OP_DIV;
    } else {
        factor_op = FILE_FACTOR_OP_TIMES;
    }

    factor = strtof(p + 1, NULL);
    if (factor == 0.0 && factor_op == FILE_FACTOR_OP_DIV) {
        file_error(ms, 0, "Cannot divide by zero");
        return -1;
    }

    if (factor > 1000.0 || factor < 0.001) {
        file_error(ms, 0, "Strength factor out of range (0.001 to 1000.0)");
        return -1;
    }

    m->factor_op = factor_op;
    m->factor = factor;

    return 0;
}