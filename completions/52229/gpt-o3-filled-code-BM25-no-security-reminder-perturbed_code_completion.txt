{
        /* Make a defensive copy of the whole server string in order
           to be able to reference it later inside the risk message. */
        char full_srv[128];
        u_int cpy_len = (server_len < (sizeof(full_srv) - 1)) ? server_len : (sizeof(full_srv) - 1);
        strncpy(full_srv, http_server_name, cpy_len);
        full_srv[cpy_len] = '\0';

        /* Pointer to the version substring right after "Apache/" or "nginx/". */
        const char *ver_str = http_server_name + off;
        int major = 0, minor = 0, patch = 0;

        /* Accept both X.Y and X.Y.Z formats. We require at least X.Y. */
        if(sscanf(ver_str, "%d.%d.%d", &major, &minor, &patch) >= 2) {
          int outdated = 0;

          if(strncasecmp(http_server_name, "Apache/", 7) == 0) {
            /* Minimum supported Apache version: 2.4 */
            if(major < 2 || (major == 2 && minor < 4))
              outdated = 1;
          } else if(strncasecmp(http_server_name, "nginx/", 6) == 0) {
            /* Minimum supported nginx version: 1.14 */
            if(major < 1 || (major == 1 && minor < 14))
              outdated = 1;
          }

          if(outdated) {
            char msg[160];
            snprintf(msg, sizeof(msg), "Outdated HTTP server detected (%s)", full_srv);
            ndpi_set_risk(ndpi_struct, flow, NDPI_HTTP_OBSOLETE_SERVER, msg);
          }
        }
      }