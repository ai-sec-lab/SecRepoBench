if (LocaleCompare(name,"XMP") == 0)
  {
    const char *end_marker = "<?xpacket end=\"w\"?>";
    ssize_t position = strstr(profile->datum,end_marker) - profile->datum;
    if (position >= 0)
      profile->length = position + strlen(end_marker);
  }
  else if (LocaleCompare(name,"EXIF") == 0)
  {
    if (profile->length > 4 && memcmp(profile->datum, "Exif", 4) != 0)
    {
      StringInfo *new_profile = AcquireStringInfo();
      AppendStringInfo(new_profile, "Exif\0", 5);
      AppendStringInfo(new_profile, profile->datum, profile->length);
      DestroyStringInfo(profile);
      profile = new_profile;
    }
  }