const char
    *value;

  size_t
    length;

  if (LocaleCompare(name,"XMP") == 0)
    {
      char
        *p;

      length=GetStringInfoLength(profile);
      value=GetStringInfoDatum(profile);
      p=strstr(value,"<?xpacket end=\"w\"?>");
      if (p != (char *) NULL)
        SetStringInfoLength(profile,(size_t) (p-value+18));
      return;
    }
  if (LocaleCompare(name,"EXIF") == 0)
    {
      length=GetStringInfoLength(profile);
      value=GetStringInfoDatum(profile);
      if ((length > 4) && (LocaleNCompare((char *) value,"\255\216\255\225",4) == 0))
        {
          char
            exif[6] = { 'E', 'x', 'i', 'f', '\0', '\0' };

          size_t new_length = length + 6;
          unsigned char *new_profile = (unsigned char *) AcquireQuantumMemory(new_length, sizeof(unsigned char));
          if (new_profile == NULL) {
            // Handle memory allocation failure
            ThrowMagickFatalException(ResourceLimitFatalError, MemoryAllocationFailed, (char *) NULL);
            return;
          }

          (void) memcpy(new_profile, exif, 6);
          (void) memcpy(new_profile + 6, value, length);
          SetStringInfoDatum(profile, (unsigned char *) new_profile);
          SetStringInfoLength(profile, new_length);
        }
      return;
    }