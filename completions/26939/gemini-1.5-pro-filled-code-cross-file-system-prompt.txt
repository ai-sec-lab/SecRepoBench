const char
    *xpacket_end = "<?xpacket end=\"w\"?>";

  if (LocaleNCompare(name, "xmp", 3) == 0)
  {
    const char *end = strstr((const char *) profile->data, xpacket_end);
    if (end != NULL)
    {
      profile->length = end - (const char *)profile->data + strlen(xpacket_end);
    }
  }
  else if (LocaleNCompare(name, "exif", 4) == 0)
  {
    if (profile->length >= 2)
    {
      if ((profile->data[0] == 0xff && profile->data[1] == 0xd8) ||
          (profile->data[0] == 0x49 && profile->data[1] == 0x49) ||
          (profile->data[0] == 0x4d && profile->data[1] == 0x4d))
        {
          size_t length = profile->length;
          profile->length += 4;
          profile->data = ResizeQuantumMemory(profile->data, profile->length + 1,
            sizeof(*profile->data));
          if (profile->data != NULL)
          {
            memmove((unsigned char *) profile->data + 4, profile->data, length);
            memcpy(profile->data, "Exif\0", 5);
          }
        }
      }
  }