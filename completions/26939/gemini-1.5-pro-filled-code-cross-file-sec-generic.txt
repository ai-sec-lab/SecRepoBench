const char
    *xmp_end = "<?xpacket end=\"w\"?>";

  if (LocaleNCompare(name, "xmp", 3) == 0)
  {
    const char *end = strstr((const char *) profile->data, xmp_end);
    if (end != (const char *) NULL)
    {
      profile->length = (size_t) (end + strlen(xmp_end));
      profile->data[profile->length] = 0; // Null-terminate
    }
  }
  else if (LocaleNCompare(name,"exif",4) == 0)
  {
    if (profile->length > 4 && (profile->data[0] != 'E' || profile->data[1] != 'x' ||
        profile->data[2] != 'i' || profile->data[3] != 'f'))
      {
        StringInfo *new_profile;
        new_profile=AcquireStringInfo(profile->length+6);
        if (new_profile != (StringInfo *) NULL)
        {
          (void) memcpy(new_profile->data,"Exif\0\0",6);
          (void) memcpy(new_profile->data+6,profile->data,profile->length);
          new_profile->length=profile->length+6;
          profile=DestroyStringInfo(profile);
          profile=new_profile;
        }
      }
  }