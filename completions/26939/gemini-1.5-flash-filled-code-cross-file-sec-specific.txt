size_t length;
  const char *p;
  if (LocaleCompare(name,"xmp") == 0) {
    p=strstr((const char *) profile->datum,"<?xpacket end=\"w\">");
    if (p != (const char *) NULL) {
      length=(size_t) (p-profile->datum)+21;
      profile->length=length;
      profile->datum=ResizeQuantumMemory(profile->datum,length+1,sizeof(*profile->datum));
      if (profile->datum == (unsigned char *) NULL)
        return;
      profile->datum[length]='\0';
    }
  }
  else
    if (LocaleCompare(name,"exif") == 0) {
      if (profile->length >= 6) {
        if (((unsigned char *) profile->datum)[0] == 0xFF) {
          if (((unsigned char *) profile->datum)[1] == 0xD8) {
            unsigned char *new_profile;
            new_profile=(unsigned char *) AcquireQuantumMemory(profile->length+6,sizeof(*new_profile));
            if (new_profile == (unsigned char *) NULL)
              return;
            memcpy(new_profile+6,profile->datum,profile->length);
            memcpy(new_profile,"Exif\0\0\0",6);
            profile->length+=6;
            profile->datum=new_profile;
          }
        }
      }
    }