if (LocaleCompare(name, "xmp") == 0)
  {
    // Find the xpacket end marker
    const char *xpacket_end = "<?xpacket end=\"w\"?>";
    size_t marker_length = strlen(xpacket_end);
    unsigned char *data = GetStringInfoDatum(profile);
    size_t length = GetStringInfoLength(profile);

    for (size_t i = 0; i <= length - marker_length; i++)
    {
      if (memcmp(data + i, xpacket_end, marker_length) == 0)
      {
        // Truncate the profile at the end marker
        SetStringInfoLength(profile, i + marker_length);
        break;
      }
    }
  }
  else if (LocaleCompare(name, "exif") == 0)
  {
    // Check for byte order marker
    const unsigned char exif_header[] = { 'E', 'x', 'i', 'f', '\0', '\0' };
    unsigned char *data = GetStringInfoDatum(profile);
    size_t length = GetStringInfoLength(profile);

    if (length >= 2 && (data[0] == 0x49 || data[0] == 0x4D) && data[1] == data[0])
    {
      // Prepend the "Exif" header
      StringInfo *new_profile = AcquireStringInfo(length + sizeof(exif_header));
      unsigned char *new_data = GetStringInfoDatum(new_profile);

      memcpy(new_data, exif_header, sizeof(exif_header));
      memcpy(new_data + sizeof(exif_header), data, length);

      // Replace the old profile with the new one
      DestroyStringInfo(profile);
      profile = new_profile;
    }
  }