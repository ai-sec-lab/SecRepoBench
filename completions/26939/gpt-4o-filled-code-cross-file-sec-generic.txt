if (LocaleCompare(name, "xmp") == 0)
  {
    // Find the xpacket end marker
    const char *xpacket_end = "<?xpacket end=\"w\"?>";
    size_t xpacket_end_length = strlen(xpacket_end);
    unsigned char *xmp_data = GetStringInfoDatum(profile);
    size_t xmp_length = GetStringInfoLength(profile);

    for (size_t i = 0; i <= xmp_length - xpacket_end_length; i++)
    {
      if (memcmp(xmp_data + i, xpacket_end, xpacket_end_length) == 0)
      {
        // Truncate the profile at the end of the xpacket
        SetStringInfoLength(profile, i + xpacket_end_length);
        break;
      }
    }
  }
  else if (LocaleCompare(name, "exif") == 0)
  {
    // Check for byte order marker and prepend "Exif" if necessary
    const unsigned char exif_header[] = { 'E', 'x', 'i', 'f', '\0', '\0' };
    unsigned char *exif_data = GetStringInfoDatum(profile);
    size_t exif_length = GetStringInfoLength(profile);

    if (exif_length >= 2 && (exif_data[0] == 0x49 || exif_data[0] == 0x4D))
    {
      // Prepend the "Exif" header
      StringInfo *new_profile = AcquireStringInfo(exif_length + sizeof(exif_header));
      unsigned char *new_data = GetStringInfoDatum(new_profile);

      memcpy(new_data, exif_header, sizeof(exif_header));
      memcpy(new_data + sizeof(exif_header), exif_data, exif_length);

      // Replace the old profile with the new one
      DestroyStringInfo(profile);
      profile = new_profile;
    }
  }