{
  /*
    Use the most capable routine that is available at compile time.
    If wideâ€“character support is present prefer towlower(), otherwise
    fall back to the ANSI C tolower().  Always cast through unsigned
    char before calling the narrow-character version to avoid undefined
    behaviour with negative input values.
  */
  if (charcode == EOF)
    return(EOF);

#if defined(MAGICKCORE_HAVE_TOWLOWER)
  return((int) towlower((wint_t) charcode));
#else
  return((int) tolower((int) ((unsigned char) charcode)));
#endif
}