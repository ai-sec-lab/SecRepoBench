bitint mask;
  const unsigned char *x = xs, *y = ys;
  long n = lengthy - m + 1;
  int i, j;

  if (m > lengthy) return -1;
  if (m < 1) return 0;

  mask = 0;
  for (i = 0; i < m; i++)
    mask |= (bitint)x[i] << (i * 8);

  for (i = 0; i < n; i++) {
    bitint value = 0;
    for (j = 0; j < m; j++)
      value |= (bitint)y[i + j] << (j * 8);

    if (mask == value) return i;

    if (((((value ^ mask) + MASK1) & ~(value ^ mask) & MASK3) >> 7) == 0) {
      i += sizeof(bitint) - 1;
    }
  }