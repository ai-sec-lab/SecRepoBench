for (i = 0; i < srclen; i++) {
  if (i >= srclen - 1) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "BER unpacking: invalid data");
  }
  
  unsigned char c = src[i];
  if (c & 0x80) {
    unsigned int value = c & 0x7f;
    do {
      i++;
      if (i >= srclen) {
        mrb_raise(mrb, E_ARGUMENT_ERROR, "BER unpacking: incomplete data");
      }
      c = src[i];
      if (value > (UINT_MAX >> 7)) {
        mrb_raise(mrb, E_RANGE_ERROR, "BER unpacking: integer overflow");
      }
      value = (value << 7) | (c & 0x7f);
    } while (c & 0x80);
    n = (mrb_int)value;
  } else {
    n = c;
    break;
  }
}