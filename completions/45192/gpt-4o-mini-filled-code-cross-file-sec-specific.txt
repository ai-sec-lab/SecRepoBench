if (srclen <= 0) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "source length must be positive");
    return 0;
  }

  for (i = 0; i < srclen; i++) {
    if (i >= srclen) {
      mrb_raise(mrb, E_INDEX_ERROR, "index out of bounds");
      return 0;
    }
    n = (n << 7) | (src[i] & 0x7F);
    if (!(src[i] & 0x80)) {
      break;
    }
  }

  if (i == srclen) {
    mrb_raise(mrb, E_RANGE_ERROR, "BER integer overflow");
    return 0;
  }