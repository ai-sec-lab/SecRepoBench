for (i = 0; i < srclen; i++) {
  if (i >= MRB_INT_MAX) {
    mrb_raise(mrb, E_RANGE_ERROR, "pack length too big");
  }
  if (src[i] & 0x80) {
    mrb_int j, m = 1;
    for (j = i + 1; j < srclen && (src[j] & 0xc0) == 0x80; j++) {
      m = (m << 6) | (src[j] & 0x3f);
    }
    m |= (src[i] & (0x7f >> (j - i - 1))) << ((j - i - 1) * 6);
    if (m > MRB_INT_MAX) {
      mrb_raise(mrb, E_RANGE_ERROR, "pack value too big");
    }
    n = m;
    i = j - 1;
  } else {
    n = src[i];
  }