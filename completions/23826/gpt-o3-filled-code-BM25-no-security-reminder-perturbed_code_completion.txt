if (envvar != NULL) {
    /* BLOSC_NOLOCK is set -> work with an ad-hoc context (no global lock). */
    dctx = blosc2_create_dctx(dparams);
    result = blosc2_decompress_ctx(dctx, src, (int32_t)srcsize,
                                   outputbuffer, destsize);
    blosc2_free_ctx(dctx);
    return result;
  }
  else {
    /* BLOSC_NOLOCK not set -> use a (lazy) global context protected by a mutex. */
    static blosc2_context *global_dctx = NULL;
#ifndef _WIN32
    /* Use a local static mutex to guard the global context. */
    static pthread_mutex_t d_mutex = PTHREAD_MUTEX_INITIALIZER;
    pthread_mutex_lock(&d_mutex);
#endif

    if (global_dctx == NULL) {
      global_dctx = blosc2_create_dctx(dparams);
    }
    result = blosc2_decompress_ctx(global_dctx, src, (int32_t)srcsize,
                                   outputbuffer, destsize);

#ifndef _WIN32
    pthread_mutex_unlock(&d_mutex);
#endif
    return result;
  }