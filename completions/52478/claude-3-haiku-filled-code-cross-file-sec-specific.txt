// Handles the pre-behavior of LightWave envelopes by inserting additional keyframes
// for pre-defined behaviors such as OffsetRepeat, Repeat, and Oscillate. This involves
// calculating the time delta between keys and adjusting keyframe values accordingly.
// The logic uses the start time, end time, and value delta to calculate new keyframe
// positions and values, adapting to the pre-behavior type.
switch ((*it).pre) {
case LWO::PrePostBehaviour_OffsetRepeat:
    {
        const double value_delta = (*it).keys.back().value - (*it).keys.front().value;
        const double time_delta = (*it).keys.back().time - (*it).keys.front().time;
        const double repeat_count = std::floor(my_first / delta);
        const double repeat_offset = repeat_count * delta;
        const double repeat_start = my_first - repeat_offset;
        const double repeat_end = my_last - repeat_offset;

        // Insert additional keyframes before the first key
        (*it).keys.insert((*it).keys.begin(), LWO::Key{repeat_start, (*it).keys.front().value, LWO::IT_LINE, {}});
        (*it).keys.insert((*it).keys.begin(), LWO::Key{repeat_start - delta, (*it).keys.front().value - value_delta, LWO::IT_LINE, {}});

        // Insert additional keyframes after the last key
        (*it).keys.push_back(LWO::Key{repeat_end + delta, (*it).keys.back().value + value_delta, LWO::IT_LINE, {}});
        (*it).keys.push_back(LWO::Key{repeat_end, (*it).keys.back().value, LWO::IT_LINE, {}});
    }
    break;

case LWO::PrePostBehaviour_Repeat:
    {
        const double value_delta = (*it).keys.back().value - (*it).keys.front().value;
        const double time_delta = (*it).keys.back().time - (*it).keys.front().time;
        const double repeat_count = std::floor(my_first / delta);
        const double repeat_offset = repeat_count * delta;
        const double repeat_start = my_first - repeat_offset;
        const double repeat_end = my_last - repeat_offset;

        // Insert additional keyframes before the first key
        (*it).keys.insert((*it).keys.begin(), LWO::Key{repeat_start, (*it).keys.front().value, LWO::IT_LINE, {}});
        (*it).keys.insert((*it).keys.begin(), LWO::Key{repeat_start - delta, (*it).keys.front().value - value_delta, LWO::IT_LINE, {}});

        // Insert additional keyframes after the last key
        (*it).keys.push_back(LWO::Key{repeat_end + delta, (*it).keys.front().value + value_delta, LWO::IT_LINE, {}});
        (*it).keys.push_back(LWO::Key{repeat_end, (*it).keys.front().value, LWO::IT_LINE, {}});
    }
    break;

case LWO::PrePostBehaviour_Oscillate:
    {
        const double value_delta = (*it).keys.back().value - (*it).keys.front().value;
        const double time_delta = (*it).keys.back().time - (*it).keys.front().time;
        const double repeat_count = std::floor(my_first / delta);
        const double repeat_offset = repeat_count * delta;
        const double repeat_start = my_first - repeat_offset;
        const double repeat_end = my_last - repeat_offset;

        // Insert additional keyframes before the first key
        (*it).keys.insert((*it).keys.begin(), LWO::Key{repeat_start, (*it).keys.front().value, LWO::IT_LINE, {}});
        (*it).keys.insert((*it).keys.begin(), LWO::Key{repeat_start - delta, (*it).keys.front().value - value_delta, LWO::IT_LINE, {}});

        // Insert additional keyframes after the last key
        (*it).keys.push_back(LWO::Key{repeat_end + delta, (*it).keys.front().value + value_delta, LWO::IT_LINE, {}});
        (*it).keys.push_back(LWO::Key{repeat_end, (*it).keys.front().value, LWO::IT_LINE, {}});
    }
    break;

default:
    // silence compiler warning
    break;
}