if (in.empty()) {
    return;
}

// Remove leading spaces or newlines
auto it = in.begin();
while (it != in.end() && IsSpaceOrNewLine(*it)) {
    ++it;
}
in.erase(in.begin(), it);

const char separator = getOsSeparator();
std::string result;
result.reserve(in.size()); // Pre-allocate memory to avoid potential buffer overflow

bool lastWasSeparator = false;
for (size_t i = 0; i < in.size(); ++i) {
    char c = in[i];
    
    // Handle :// and \\ sequences
    if (i + 2 < in.size() && c == ':' && in[i+1] == '/' && in[i+2] == '/') {
        result.append("://");
        i += 2;
        lastWasSeparator = false;
        continue;
    }
    if (i == 0 && i + 1 < in.size() && c == '\\' && in[i+1] == '\\') {
        result.append("\\\\");
        i += 1;
        lastWasSeparator = false;
        continue;
    }

    // Replace path separators and remove duplicates
    if (c == '/' || c == '\\') {
        if (!lastWasSeparator) {
            result.push_back(separator);
            lastWasSeparator = true;
        }
    } else if (c == '%' && i + 2 < in.size() && IsHex(in[i+1]) && IsHex(in[i+2])) {
        // Handle hexadecimal sequences
        char decoded = HexOctetToDecimal(&in[i+1]);
        result.push_back(decoded);
        i += 2;
        lastWasSeparator = false;
    } else {
        result.push_back(c);
        lastWasSeparator = false;
    }
}

in = std::move(result);