if (in.empty()) {
    return;
}

// Remove leading spaces or new lines
while (!in.empty() && IsSpaceOrNewLine(in.front())) {
    in.erase(in.begin());
}

const char separator = getOsSeparator();
char last = 0;

for (auto it = in.begin(); it != in.end(); ++it) {
    size_t remaining = std::distance(it, in.end());

    // Skip :// and \\ sequences
    if (remaining >= 3 && strncmp(&*it, "://", 3) == 0) {
        it += 2;
        continue;
    }
    if (it == in.begin() && remaining >= 2 && strncmp(&*it, "\\\\", 2) == 0) {
        it += 1;
        continue;
    }

    // Normalize path delimiters
    if (*it == '/' || *it == '\\') {
        *it = separator;

        // Remove double delimiters
        if (last == *it) {
            it = in.erase(it);
            --it;
        }
    } else if (*it == '%' && remaining > 2) {
        // Convert hexadecimal sequences in URIs
        if (IsHex(*(it + 1)) && IsHex(*(it + 2))) {
            *it = HexOctetToDecimal(&*it);
            it = in.erase(it + 1, it + 3);
            --it;
        }
    }

    last = *it;
}