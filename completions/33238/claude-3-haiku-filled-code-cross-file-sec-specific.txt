void Cleanup(std::string& in) const {
    if (in.empty()) {
        return;
    }

    // Remove leading spaces or new lines
    char last = 0;
    std::string::iterator it = in.begin();
    while (IsSpaceOrNewLine(*it)) ++it;
    if (it != in.begin()) {
        in.erase(in.begin(), it + 1);
    }

    const char separator = getOsSeparator();
    for (it = in.begin(); it != in.end(); ++it) {
        int remaining = std::distance(in.end(), it);
        // Exclude :// and \\, which remain untouched
        if (remaining >= 3 && !strncmp(&*it, "://", 3)) {
            it += 3;
            continue;
        }
        if (it == in.begin() && remaining >= 2 && !strncmp(&*it, "\\\\", 2)) {
            it += 2;
            continue;
        }

        // Replace path delimiters with the operating system's directory separator
        if (*it == '/' || *it == '\\') {
            *it = separator;

            // Remove double delimiters
            if (last == *it) {
                it = in.erase(it);
                --it;
            }
        } else if (*it == '%' && in.end() - it > 2) {
            // Convert hexadecimal sequences in URIs to their respective characters
            if (IsHex((&*it)[0]) && IsHex((&*it)[1])) {
                *it = HexOctetToDecimal(&*it);
                it = in.erase(it + 1, it + 2);
                --it;
            }
        }

        last = *it;
    }
}