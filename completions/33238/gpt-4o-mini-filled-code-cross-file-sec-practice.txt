// Remove trailing spaces or new lines from the path.
        if (!in.empty()) {
            auto it = in.end();
            do {
                --it;
            } while (it != in.begin() && IsSpaceOrNewLine(*it));
            if (it != in.end()) {
                in.erase(it + 1, in.end());
            }
        }

        // Replace forward slashes and backslashes with the OS-specific separator.
        const char separator = getOsSeparator();
        for (auto& ch : in) {
            if (ch == '/' || ch == '\\') {
                ch = separator;
            }
        }

        // Remove duplicate separators.
        auto new_end = std::unique(in.begin(), in.end(), [](char a, char b) {
            return a == b && (a == '/' || a == '\\');
        });
        in.erase(new_end, in.end());

        // Handle special cases for "://" and "\\\\".
        if (in.size() >= 3 && in.substr(0, 3) == "://") {
            // Do not modify "://"
            in = "://" + in.substr(3);
        } else if (in.size() >= 2 && in.substr(0, 2) == "\\\\") {
            // Do not modify "\\"
            in = "\\\\" + in.substr(2);
        }

        // Decode hexadecimal sequences (e.g., %20).
        std::string decoded;
        for (size_t i = 0; i < in.length(); ++i) {
            if (in[i] == '%' && i + 2 < in.length() && IsHex(in[i + 1]) && IsHex(in[i + 2])) {
                decoded += static_cast<char>(HexOctetToDecimal(&in[i + 1]));
                i += 2; // Skip the next two hex digits
            } else {
                decoded += in[i];
            }
        }
        in = decoded;