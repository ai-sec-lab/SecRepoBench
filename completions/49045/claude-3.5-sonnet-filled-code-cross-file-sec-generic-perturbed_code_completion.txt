mrb_int base = 10;
mrb_value num, b;
char *buf;
mrb_int len;

mrb_get_args(state, "o|i", &num, &base);

if (base < 2 || base > 36) {
  mrb_raisef(state, E_ARGUMENT_ERROR, "invalid radix %S", mrb_fixnum_value(base));
}

if (!mrb_fixnum_p(num)) {
  mrb_raisef(state, E_TYPE_ERROR, "can't convert %S into Integer", mrb_obj_class(state, num));
}

buf = mrb_malloc(state, 64);
len = mrb_int_to_str(state, mrb_fixnum(num), base, 0, buf);

b = mrb_str_new(state, buf, len);
mrb_free(state, buf);

return b;