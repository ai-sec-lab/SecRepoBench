mrb_int base = 10;
  mrb_int n;
  char buf[32];
  char *p;
  mrb_value v;

  mrb_get_args(mrb, "|i", &base);
  if (base < 2 || base > 36) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "base must be between 2 and 36");
  }
  n = mrb_fixnum(self);
  p = buf + sizeof(buf);
  *--p = '\0';
  if (n == 0) {
    *--p = '0';
  } else if (n < 0) {
    *--p = '-';
    n = -n;
  }
  while (n > 0) {
    mrb_int digit = n % base;
    char c;
    if (digit < 10) {
      c = '0' + digit;
    } else {
      c = 'a' + digit - 10;
    }
    *--p = c;
    n /= base;
  }
  v = mrb_str_new_cstr(mrb, p);
  return v;