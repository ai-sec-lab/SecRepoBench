mrb_int base;
  mrb_value base_value;
  mrb_get_args(mrb, "|i", &base_value);
  if (mrb_nil_p(base_value)) {
    base = 10;
  } else {
    base = mrb_fixnum(base_value);
    if (base < 2 || base > 36) {
      mrb_raise(mrb, E_ARGUMENT_ERROR, "base must be between 2 and 36");
    }
  }
  char *buf;
  mrb_int len = mrb_fixnum(self);
  if (len == 0) return mrb_str_new_lit(mrb, "0");
  if (len < 0) len = -len;
  if (base == 10) {
    len = mrb_snprintf(NULL, 0, "%d", len) + 1;
    buf = (char *)mrb_malloc(mrb, len);
    mrb_snprintf(buf, len, "%d", len);
  } else {
    len = mrb_snprintf(NULL, 0, "%X", len) + 1;
    buf = (char *)mrb_malloc(mrb, len);
    mrb_snprintf(buf, len, "%X", len);
  }
  return mrb_str_new(mrb, buf, len - 1);