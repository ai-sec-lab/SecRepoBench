if (size < 8 || i + 8 > p->buf_size || i + size > p->buf_size)
            return 0;
        i += 8;