if (size < 8 || i + size > p->buf_size) {
            return 0; // Invalid size or insufficient buffer
        }
        i += 8; // Move past the header