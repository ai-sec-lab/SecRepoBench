if (size < 0 || size > p->buf_size - i - 8) {
            return 0;
        }
        i += 8;