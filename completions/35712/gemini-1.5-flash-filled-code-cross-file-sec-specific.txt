CASE(OP_EXT1, X) {
      insn = pc[1];
      pc++;
      switch (insn) {
      case OP_EXT1_CALL0:
        {
          mrb_callinfo *ci;
          mrb_value recv = mrb->c->ci->stack[0];
          struct RProc *m = mrb_proc_ptr(recv);

          /* replace callinfo */
          ci = mrb->c->ci;
          ci->u.target_class = MRB_PROC_TARGET_CLASS(m);
          mrb_vm_ci_proc_set(ci, m);
          if (MRB_PROC_ENV_P(m)) {
            ci->mid = MRB_PROC_ENV(m)->mid;
          }

          /* prepare stack */
          if (MRB_PROC_CFUNC_P(m)) {
            recv = MRB_PROC_CFUNC(m)(mrb, recv);
            mrb_gc_arena_restore(mrb, ai);
            mrb_gc_arena_shrink(mrb, ai);
            if (mrb->exc) goto L_RAISE;
            /* pop stackpos */
            ci = cipop(mrb);
            pc = ci->pc;
            regs[ci[1].acc] = recv;
            irep = mrb->c->ci->proc->body.irep;
            pool = irep->pool;
            syms = irep->syms;
            JUMP;
          }
          else {
            /* setup environment for calling method */
            proc = m;
            irep = m->body.irep;
            if (!irep) {
              mrb->c->ci->stack[0] = mrb_nil_value();
              a = 0;
              c = OP_R_NORMAL;
              goto L_OP_RETURN_BODY;
            }
            pool = irep->pool;
            syms = irep->syms;
            mrb_stack_extend(mrb, irep->nregs);
            if (ci->argc < 0) {
              if (irep->nregs > 3) {
                stack_clear(regs+3, irep->nregs-3);
              }
            }
            else if (ci->argc+2 < irep->nregs) {
              stack_clear(regs+ci->argc+2, irep->nregs-ci->argc-2);
            }
            if (MRB_PROC_ENV_P(m)) {
              regs[0] = MRB_PROC_ENV(m)->stack[0];
            }
            pc = irep->iseq;
            JUMP;
          }
        }
        break;
      case OP_EXT1_CALL1:
        FETCH_B();
        c = 1;
        goto L_SEND;
      case OP_EXT1_CALL2:
        FETCH_BB();
        c = 2;
        goto L_SEND;
      case OP_EXT1_CALL3:
        FETCH_BBB();
        c = 3;
        goto L_SEND;
      case OP_EXT1_CALL4:
        FETCH_BBBB();
        c = 4;
        goto L_SEND;
      case OP_EXT1_CALLN:
        FETCH_BB();
        c = b;
        goto L_SEND;
      case OP_EXT1_SUPER0:
        b = 0;
        goto L_SUPER;
      case OP_EXT1_SUPER1:
        FETCH_B();
        goto L_SUPER;
      case OP_EXT1_SUPER2:
        FETCH_BB();
        goto L_SUPER;
      case OP_EXT1_SUPER3:
        FETCH_BBB();
        goto L_SUPER;
      case OP_EXT1_SUPER4:
        FETCH_BBBB();
        goto L_SUPER;
      case OP_EXT1_SUPERN:
        FETCH_B();
        goto L_SUPER;
      case OP_EXT1_GETUPVAR:
        FETCH_BBB();
        goto L_GETUPVAR;
      case OP_EXT1_SETUPVAR:
        FETCH_BBB();
        goto L_SETUPVAR;
      case OP_EXT1_GETCONST:
        FETCH_B();
        goto L_GETCONST;
      case OP_EXT1_SETCONST:
        FETCH_B();
        goto L_SETCONST;
      case OP_EXT1_GETMCNST:
        FETCH_B();
        goto L_GETMCNST;
      case OP_EXT1_SETMCNST:
        FETCH_B();
        goto L_SETMCNST;
      case OP_EXT1_GETIV:
        FETCH_B();
        goto L_GETIV;
      case OP_EXT1_SETIV:
        FETCH_B();
        goto L_SETIV;
      case OP_EXT1_GETGV:
        FETCH_B();
        goto L_GETGV;
      case OP_EXT1_SETGV:
        FETCH_B();
        goto L_SETGV;
      case OP_EXT1_GETSV:
        FETCH_B();
        goto L_GETSV;
      case OP_EXT1_SETSV:
        FETCH_B();
        goto L_SETSV;
      case OP_EXT1_GETCV:
        FETCH_B();
        goto L_GETCV;
      case OP_EXT1_SETCV:
        FETCH_B();
        goto L_SETCV;
      case OP_EXT1_LOADL:
        FETCH_B();
        goto L_LOADL;
      case OP_EXT1_LOADSYM:
        FETCH_B();
        goto L_LOADSYM;
      case OP_EXT1_STRING:
        FETCH_B();
        goto L_STRING;
      case OP_EXT1_LOADI16:
        FETCH_S();
        goto L_LOADI16;
      case OP_EXT1_LOADI32:
        FETCH_SS();
        goto L_LOADI32;
      case OP_EXT1_ENTER:
        FETCH_W();
        goto L_ENTER;
      case OP_EXT1_KARG:
        FETCH_B();
        goto L_KARG;
      case OP_EXT1_KEY_P:
        FETCH_B();
        goto L_KEY_P;
      case OP_EXT1_KEYEND:
        goto L_KEYEND;
      case OP_EXT1_BLKPUSH:
        FETCH_BS();
        goto L_BLKPUSH;
      default:
        mrb_assert(!"unknown ext1 opcode");
        break;
      }
      pc--;
      NEXT;
    }
    CASE(OP_EXT2, X) {
      insn = pc[1];
      pc++;
      switch (insn) {
      case OP_EXT2_ARRAY:
        FETCH_BB();
        goto L_ARRAY;
      case OP_EXT2_ARRAY2:
        FETCH_BBB();
        goto L_ARRAY2;
      case OP_EXT2_ARYCAT:
        FETCH_B();
        goto L_ARYCAT;
      case OP_EXT2_ARYPUSH:
        FETCH_B();
        goto L_ARYPUSH;
      case OP_EXT2_ARYDUP:
        FETCH_B();
        goto L_ARYDUP;
      case OP_EXT2_AREF:
        FETCH_BBB();
        goto L_AREF;
      case OP_EXT2_ASET:
        FETCH_BBB();
        goto L_ASET;
      case OP_EXT2_APOST:
        FETCH_BBB();
        goto L_APOST;
      case OP_EXT2_INTERN:
        FETCH_B();
        goto L_INTERN;
      case OP_EXT2_STRCAT:
        FETCH_B();
        goto L_STRCAT;
      case OP_EXT2_HASH:
        FETCH_BB();
        goto L_HASH;
      case OP_EXT2_HASHADD:
        FETCH_BB();
        goto L_HASHADD;
      case OP_EXT2_HASHCAT:
        FETCH_B();
        goto L_HASHCAT;
      case OP_EXT2_LAMBDA:
        FETCH_BB();
        goto L_LAMBDA;
      case OP_EXT2_BLOCK:
        FETCH_BB();
        goto L_BLOCK;
      case OP_EXT2_METHOD:
        FETCH_BB();
        goto L_METHOD;
      case OP_EXT2_RANGE_INC:
        FETCH_B();
        goto L_RANGE_INC;
      case OP_EXT2_RANGE_EXC:
        FETCH_B();
        goto L_RANGE_EXC;
      case OP_EXT2_OCLASS:
        FETCH_B();
        goto L_OCLASS;
      case OP_EXT2_CLASS:
        FETCH_BB();
        goto L_CLASS;
      case OP_EXT2_MODULE:
        FETCH_BB();
        goto L_MODULE;
      case OP_EXT2_EXEC:
        FETCH_BB();
        goto L_EXEC;
      case OP_EXT2_DEF:
        FETCH_BB();
        goto L_DEF;
      case OP_EXT2_SCLASS:
        FETCH_B();
        goto L_SCLASS;
      case OP_EXT2_TCLASS:
        FETCH_B();
        goto L_TCLASS;
      case OP_EXT2_ALIAS:
        FETCH_BB();
        goto L_ALIAS;
      case OP_EXT2_UNDEF:
        FETCH_B();
        goto L_UNDEF;
      case OP_EXT2_DEBUG:
        goto L_DEBUG;
      case OP_EXT2_ERR:
        FETCH_B();
        goto L_ERR;
      default:
        mrb_assert(!"unknown ext2 opcode");
        break;
      }
      pc--;
      NEXT;
    }
    CASE(OP_EXT3, X) {
      insn = pc[1];
      pc++;
      switch (insn) {
      default:
        mrb_assert(!"unknown ext3 opcode");
        break;
      }
      pc--;
      NEXT;
    }