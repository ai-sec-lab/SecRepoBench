/* Parse: "1 <num> <num> <num> <num> <name>\n"                         */
	{
	  u_int16_t start   = i;
	  int        ok     = 1;

	  /* We expect 4 numeric fields each terminated by a space            */
	  while(numbers_left && i < payload_len && ok) {
	    u_int16_t digit_cnt = 0;

	    /* at least one digit                                              */
	    while(i < payload_len && packet_payload[i] >= '0' && packet_payload[i] <= '9') {
	      i++; digit_cnt++;
	    }

	    if(digit_cnt == 0) { ok = 0; break; }

	    numbers_left--;

	    /* after the number we need a space (except maybe after the last) */
	    if(numbers_left) {
	      if(i >= payload_len || packet_payload[i] != ' ') { ok = 0; break; }
	      i++; /* skip the space                                           */
	    }
	  }

	  /* one space separating the 4th number and the name                 */
	  if(ok) {
	    if(i >= payload_len || packet_payload[i] != ' ') ok = 0;
	    else i++; /* skip space                                            */
	  }

	  /* <name> : alpha-numeric string terminated by '\n'                 */
	  if(ok) {
	    while(i < payload_len && packet_payload[i] != '\n') {
	      u_int8_t c = packet_payload[i];
	      if(!((c >= '0' && c <= '9') || (c >= 'a' && c <= 'z') ||
		   (c >= 'A' && c <= 'Z') || c == '_' || c == '-')) {
		ok = 0;
		break;
	      }
	      i++;
	    }
	  }

	  /* final \n must be present and must be the last byte               */
	  if(ok && (i+1 == payload_len) && packet_payload[i] == '\n') {
	    connection_flow->tinc_state++;

	    /* After both sides exchanged the two expected messages           */
	    if(connection_flow->tinc_state > 3) {
	      /* allocate cache if needed                                     */
	      if(ndpi_struct->tinc_cache == NULL)
		ndpi_struct->tinc_cache = cache_new();

	      if(ndpi_struct->tinc_cache != NULL) {
		struct tinc_cache_entry cache_entry = connection_flow->tinc_cache_entry;
		cache_insert(ndpi_struct->tinc_cache,
			     &cache_entry, sizeof(cache_entry));
	      }

	      NDPI_LOG_INFO(ndpi_struct, "found tinc tcp connection\n");
	      ndpi_set_detected_protocol(ndpi_struct, connection_flow,
					 NDPI_PROTOCOL_TINC, NDPI_PROTOCOL_UNKNOWN,
					 NDPI_CONFIDENCE_DPI);
	    }
	    return;
	  }
	}