for (unsigned int i = 0; i < effectiveaxiscount; ++i) {
  coords[i] = map->apply(coords[i]);
  map++;
}

if (version >= 2) {
  std::vector<int> output(coords_length);
  VariationStoreCache variationStoreCache(this);
  for (unsigned int i = 0; i < effectiveaxiscount; ++i) {
    int variationIndex = variationIndexMap->get(i);
    int delta = variationStoreCache.get(variationIndex);
    int transformed = coords[i] + round(delta);
    transformed = std::max(minValue, std::min(maxValue, transformed));
    output[i] = transformed;
  }
  coords_length = output.size();
  std::swap(coords, output);
  variationStoreCache.deallocate();
}