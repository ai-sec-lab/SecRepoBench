{
          /* value is expected to be a pointer to the *pointer* that holds the
             string (char **).  */
          char **dst  = (char **)old;          /* pointer inside the object   */
          char *src   = *(char **)value;       /* incoming string pointer      */

          /* When the caller passes a NULL source pointer, just store NULL and
             be done.  */
          if (!src)
            {
              if (*dst)
                {
                  free (*dst);
                  *dst = NULL;
                }
              return;
            }

          /* Free the previously allocated memory, if any.  Avoid freeing when
             the very same pointer is re-used.  */
          if (*dst && *dst != src)
            free (*dst);

          /* Handle fixed-length (TFv) strings separately.  */
          if (strEQc (f->type, "TFv"))
            {
              /* allocate size + 1 so that we can always NUL-terminate */
              size_t len = strlen (src);
              if (len > f->size)
                len = f->size; /* truncate to fixed length */

              char *tmp = (char *)calloc (f->size + 1, 1);
              memcpy (tmp, src, len);
              tmp[len] = '\0';

              *dst = tmp;
            }
          else
            {
              /* Variable length string: copy as-is.                       */
              size_t len = strlen (src);
              char *tmp  = (char *)malloc (len + 1);
              memcpy (tmp, src, len + 1); /* includes '\0' */

              *dst = tmp;
            }
        }