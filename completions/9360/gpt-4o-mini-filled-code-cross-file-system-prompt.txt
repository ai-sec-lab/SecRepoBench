end=q;
            n=0; // Initialize nesting level
            while (n >= 0)
            {
              GetNextToken(q,&q,extent,token);
              if (LocaleCompare("push",token) == 0)
                n++;
              else if (LocaleCompare("pop",token) == 0)
                n--;
            }
            // Extract the macro definition and add it to the splay tree
            if (n < 0)
            {
              char *macro_definition = AcquireString(end - start + 1);
              strncpy(macro_definition, start, end - start);
              macro_definition[end - start] = '\0';
              AddValueToSplayTree(macros, ConstantString(token), macro_definition);
            }