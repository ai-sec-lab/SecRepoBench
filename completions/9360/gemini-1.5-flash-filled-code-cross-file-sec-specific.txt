end=strchr(start,'"');
            if (end == (const char *) NULL)
              break;
            n=1;
            for (p=start; p < end; p++)
            {
              if (*p == '"')
                {
                  if (*(p+1) == '"')
                    p++;
                  else
                    n--;
                }
              if (*p == '#')
                {
                  while ((*q != '\n') && (*q != '\0'))
                    q++;
                  continue;
                }
              if (*p == '(')
                n++;
              if (n <= 0)
                {
                  end=p;
                  break;
                }
            }
            if (n > 0)
              {
                /*
                  Nested macro.
                */
                while ((*q != '\0') && (n > 0))
                {
                  GetNextToken(q,&q,extent,token);
                  if (*token == '(')
                    n++;
                  if (*token == ')')
                    n--;
                }
                continue;
              }
            (void) CopyMagickString(name,start,MagickPathExtent);
            name[end-start]= '\0';
            AddValueToSplayTree(macros,ConstantString(name),
              ConstantString(name));
            q=end+1;
      }