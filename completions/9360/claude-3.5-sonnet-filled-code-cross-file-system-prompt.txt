for (n=1; n > 0; )
{
  GetNextToken(q,&q,extent,token);
  if (*token == '\0')
    break;
  if (LocaleCompare(token,"pop") == 0)
    n--;
  else
    if (LocaleCompare(token,"push") == 0)
      n++;
  if (n > 0)
    end=q;
}
if (n != 0)
{
  ThrowReaderException(DrawError,"UnbalancedPushPop");
}
*q='\0';
(void) CopyMagickString(name,start,(size_t) (end-start+1));
for (p=name; *p != '\0'; p++)
  if (*p == '\n')
    *p=' ';
(void) StripString(name);
if (AddValueToSplayTree(macros,ConstantString(name),
  ConstantString(name)) == MagickFalse)
  ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");