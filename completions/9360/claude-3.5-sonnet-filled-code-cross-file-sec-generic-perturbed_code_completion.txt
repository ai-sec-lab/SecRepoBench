for (n=1; n > 0; )
{
  GetNextToken(q,&q,length,token);
  if (*token == '\0')
    break;
  if (LocaleCompare("push",token) == 0)
    n++;
  else if (LocaleCompare("pop",token) == 0)
    n--;
}
end=q-1;
*name='\0';
p=start;
for (p=start; p < (end-1); p++)
{
  if (*p == '\n')
    (void) CopyMagickString(name,p+1,MagickPathExtent);
  if (*p == '"')
    break;
}
if (*name == '\0')
  (void) CopyMagickString(name,start,MagickPathExtent);
(void) CopyMagickString(token,start,(size_t) (end-start+2));
(void) AddValueToSplayTree(macros,ConstantString(name),
  ConstantString(token));