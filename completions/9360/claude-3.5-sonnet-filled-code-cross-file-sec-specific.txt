for (n=1; n > 0; )
{
  end=q;
  while ((*end != '\n') && (*end != '\0'))
    end++;
  if (*end == '\0')
    break;
  if ((*q == 'p') && (*(q+1) == 'u') && (*(q+2) == 's') && (*(q+3) == 'h'))
    n++;
  else
    if ((*q == 'p') && (*(q+1) == 'o') && (*(q+2) == 'p'))
      n--;
  q=end+1;
}
end=q-1;
*name='\0';
p=end;
while (isspace((int) ((unsigned char) *p)) != 0)
  p--;
while ((p > start) && (isspace((int) ((unsigned char) *(p-1))) == 0))
  p--;
(void) CopyMagickString(name,p,(size_t) (end-p+2));
(void) StripString(name);
for (p=name; *p != '\0'; p++)
  if (*p == '\n')
    *p=' ';
(void) AddValueToSplayTree(macros,ConstantString(name),
  ConstantString(start));