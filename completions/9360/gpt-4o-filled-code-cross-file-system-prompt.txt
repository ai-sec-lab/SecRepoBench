GetNextToken(q,&q,extent,token);
            (void) CopyMagickString(name,token,MagickPathExtent);
            n=0;
            for (p=q; *p != '\0'; )
            {
              GetNextToken(p,&p,extent,token);
              if (LocaleCompare("pop",token) == 0)
                {
                  GetNextToken(p,&p,extent,token);
                  if (LocaleCompare("graphic-context",token) == 0)
                    n--;
                  if (n < 0)
                    break;
                }
              if (LocaleCompare("push",token) == 0)
                {
                  GetNextToken(p,&p,extent,token);
                  if (LocaleCompare("graphic-context",token) == 0)
                    n++;
                }
            }
            end=p;
            if (n < 0)
              {
                char
                  *macro;

                ssize_t
                  length;

                length=(ssize_t) (end-start);
                macro=(char *) AcquireQuantumMemory(length+1,sizeof(*macro));
                if (macro == (char *) NULL)
                  ThrowMagickFatalException(ResourceLimitFatalError,
                    "MemoryAllocationFailed",primitive);
                (void) CopyMagickString(macro,start,length+1);
                (void) AddValueToSplayTree(macros,ConstantString(name),macro);
              }