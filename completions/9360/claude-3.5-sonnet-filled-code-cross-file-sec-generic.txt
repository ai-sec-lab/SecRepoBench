for (n=0; *q != '\0'; n++)
{
  if (*q == '"')
    q++;
  p=q;
  while ((*q != '\n') && (*q != '\0') && (*q != '"'))
    q++;
  end=q-1;
  *name='\0';
  (void) CopyMagickString(name,p,(size_t) (end-p+2));
  if (*q == '"')
    q++;
  while ((*q != '\n') && (*q != '\0'))
  {
    if ((*q == 'p') && (*(q+1) == 'u') && (*(q+2) == 's') &&
        (*(q+3) == 'h'))
      n++;
    else
      if ((*q == 'p') && (*(q+1) == 'o') && (*(q+2) == 'p'))
        {
          n--;
          if (n <= 0)
            {
              q++;
              break;
            }
        }
    q++;
  }
  if (n <= 0)
    {
      (void) AddValueToSplayTree(macros,ConstantString(name),
        ConstantString(start));
      break;
    }
}