// Initialize variables to track axis indices and whether any axis is not pinned.
  bool axis_not_pinned = false;
  unsigned axis_index = 0;

  // Iterate over each axis in the 'axes' array.
  for (const auto& axis : axes)
  {
    // For each axis, get its tag and update the map from old index to tag.
    hb_tag_t axis_tag = axis.axisTag;
    plan->old_index_to_tag.set (axis_index, axis_tag);

    // Check if the axis is present in the user's axis location settings.
    if (plan->user_axes_location.has (axis_tag))
    {
      // If the axis is set by the user, normalize its value using user settings.
      float user_value = plan->user_axes_location.get (axis_tag);
      plan->normalized_coords[axis_index] = user_value;

      // If 'avar' data is available, remap the normalized value using the segment maps.
      if (has_avar)
      {
        seg_maps = fontface->table.avar->get_segment_maps (axis_index);
        plan->normalized_coords[axis_index] = seg_maps->remap (plan->normalized_coords[axis_index]);
      }

      // Set the normalized value in the plan's axes location and coordinates.
      plan->axes_location.set (axis_tag, plan->normalized_coords[axis_index]);
      plan->coordinates.set (axis_index, plan->normalized_coords[axis_index]);
    }
    else
    {
      // If the axis is not set by the user, mark it as not pinned and update the index map.
      axis_not_pinned = true;
      plan->index_map.set (axis_index, axis_index);
    }

    // If the normalized value is not zero, mark the plan as not pinned at default.
    if (plan->normalized_coords[axis_index] != 0.0f)
      plan->not_pinned_at_default = true;

    // Update segment maps for 'avar' for the next axis, if applicable.
    if (has_avar)
      seg_maps = seg_maps->next ();

    axis_index++;
  }