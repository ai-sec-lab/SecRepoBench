// Retrieve matrix data from two matrix stages within the LUT pipeline.
// Ensure input offset of the first matrix is zero before proceeding.
// Multiply the two matrices to compute the resultant matrix.
// Check if the resultant matrix, combined with the second matrix's offset, is an identity matrix.
// If so, mark the matrix as an identity to optimize or remove redundant computations.

_cmsStageMatrixData* Data1 = (_cmsStageMatrixData*)cmsStageData(Matrix1);
_cmsStageMatrixData* Data2 = (_cmsStageMatrixData*)cmsStageData(Matrix2);

// Ensure input offset of the first matrix is zero
if (Data1->Offset != NULL) return FALSE;

// Multiply the two matrices to get the result
_cmsMAT3per(&res, (cmsMAT3*)Data2->Double, (cmsMAT3*)Data1->Double);

// Check if the resultant matrix, combined with the second matrix's offset, is an identity matrix
IdentityMat = FALSE;
if (_cmsMAT3isIdentity(&res) && Data2->Offset == NULL) {
    // We can get rid of full matrix
    IdentityMat = TRUE;
}