if (s->num_primitive_matrices > maxallowedmatrices) {
    av_log(m->avctx, AV_LOG_ERROR, "Too many primitive matrices: %d\n", s->num_primitive_matrices);
    return AVERROR_INVALIDDATA;
}

s->max_matrix_channel = get_bits(gbp, 4);
if (s->max_matrix_channel >= MAX_CHANNELS) {
    av_log(m->avctx, AV_LOG_ERROR, "Invalid max matrix channel: %d\n", s->max_matrix_channel);
    return AVERROR_INVALIDDATA;
}

s->noise_shift = get_bits(gbp, 4);
s->noise_type = get_bits(gbp, 1);

if (s->noise_type) {
    s->noisegen_seed = get_bits(gbp, 23);
} else {
    s->noisegen_seed = 0;
}

s->data_check_present = get_bits1(gbp);
if (s->data_check_present) {
    s->data_check_type = get_bits(gbp, 8);
}