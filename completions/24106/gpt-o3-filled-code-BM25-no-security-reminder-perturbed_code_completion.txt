/*
              If the class name matches the current graphic-context id we are
              already operating within this class-- just ignore it.
            */
            if ((graphic_context[graphiccontextindex]->id != (char *) NULL) &&
                (LocaleCompare(token,graphic_context[graphiccontextindex]->id) == 0))
              break;
            /*
              Lookup the class definition in the macro list.  When found,
              splice the class body into the input stream so that the elements
              are interpreted in-line immediately after this directive.
            */
            {
              const char
                *elements;

              elements=(const char *) GetValueFromSplayTree(macros,token);
              if (elements != (const char *) NULL)
                {
                  size_t
                    length;

                  char
                    *stream;

                  /*
                    Allocate enough room for the expanded stream: the class
                    itself plus whatever remains to be interpreted (q points
                    to the remainder of the original stream).
                  */
                  length=strlen(elements)+strlen(q)+MagickPathExtent;
                  stream=(char *) AcquireQuantumMemory(length,sizeof(*stream));
                  if (stream == (char *) NULL)
                    {
                      (void) ThrowMagickException(exception,GetMagickModule(),
                        ResourceLimitError,"MemoryAllocationFailed","`%s'",
                        image->filename);
                      status=MagickFalse;
                      break;
                    }
                  *stream='\0';
                  (void) CopyMagickString(stream,elements,length);
                  (void) ConcatenateMagickString(stream,q,length);
                  /*
                    Replace the current primitive stream with the expanded one
                    and reset the parser pointer.
                  */
                  primitive=DestroyString(primitive);
                  primitive=stream;
                  primitive_extent=(double) strlen(primitive);
                  q=primitive;          /* restart parser at beginning       */
                  p=q;                  /* keep debug pointer in-sync        */
                }
            }
            /* nothing more to do for 'class' directive */