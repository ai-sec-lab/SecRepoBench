if (LocaleCompare(token,graphic_context[n]->id) != 0)
{
  const char *class_elements;
  class_elements=(const char *) GetValueFromSplayTree(macros,token);
  if (class_elements != (const char *) NULL)
  {
    char *new_primitive;
    size_t class_length,primitive_length;

    class_length=strlen(class_elements);
    primitive_length=strlen(primitive);
    new_primitive=(char *) AcquireQuantumMemory(primitive_length+class_length+1,
      sizeof(*new_primitive));
    if (new_primitive == (char *) NULL)
      ThrowFatalException(ResourceLimitFatalError,"MemoryAllocationFailed");
    (void) CopyMagickString(new_primitive,primitive,q-primitive+1);
    (void) ConcatenateMagickString(new_primitive,class_elements,
      primitive_length+class_length+1);
    (void) ConcatenateMagickString(new_primitive,q,primitive_length+
      class_length+1);
    primitive=DestroyString(primitive);
    primitive=new_primitive;
    q=primitive+(q-p);
  }
}