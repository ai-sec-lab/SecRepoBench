mvg_class=GetValueFromSplayTree(macros,token);
            if (mvg_class != (const char *) NULL)
              {
                char *new_elements;
                size_t new_length;

                new_length = strlen(mvg_class) + strlen(q) + 1; // +1 for null terminator
                new_elements = (char *) AcquireQuantumMemory(new_length, sizeof(char));
                if (new_elements == (char *) NULL)
                  {
                    status = MagickFalse;
                    break;
                  }
                snprintf(new_elements, new_length, "%s%s", mvg_class, q);
                DestroyString(primitive);
                primitive = new_elements;
                q = primitive; // Update the stream pointer to the new position
              }