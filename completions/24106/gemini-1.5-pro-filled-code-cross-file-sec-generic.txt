mvg_class = graphic_context[n]->id;
if (mvg_class != (char *) NULL) {
    const char *class_def = (const char *) GetValueFromSplayTree(macros, mvg_class);
    if (class_def != (const char *) NULL) {
        char *elements = AcquireString(class_def);
        size_t len = strlen(elements);
        if (len > 0) {
            char *new_primitive = AcquireString(elements);
            ConcatenateString(&new_primitive, q);
            primitive=DestroyString(primitive);
            primitive = new_primitive;
            q = primitive + len + 1; // Move q to the correct position after the class definition.
        }
        elements=DestroyString(elements);
    }
}