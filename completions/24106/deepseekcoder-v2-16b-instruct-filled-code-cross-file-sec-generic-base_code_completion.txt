if (LocaleCompare("class", token) == 0) {
  // Check if the current token matches the graphic context ID, break if true.
  if (*token == *graphic_context[n]->id) {
    break;
  }
  // Retrieve the MVG class definition from the macros using the token.
  const char *class_definition = GetValueFromSplayTree(macros, token);
  if (class_definition != NULL) {
    // Concatenate the MVG class to the elements string, followed by the remaining content.
    char *new_elements = (char *)malloc(strlen(elements) + strlen(class_definition) + strlen(q) + 1);
    if (new_elements == NULL) {
      ThrowBinaryException(ResourceLimitError, "MemoryAllocationFailed", image->filename);
      return MagickFalse;
    }
    strcpy(new_elements, elements);
    strcat(new_elements, class_definition);
    strcat(new_elements, q);
    // Free the previous primitive string and update it with the new elements.
    free(elements);
    elements = new_elements;
    // Adjust the stream pointer to the new position in the modified primitive.
    q = elements + strlen(elements);
  }
}