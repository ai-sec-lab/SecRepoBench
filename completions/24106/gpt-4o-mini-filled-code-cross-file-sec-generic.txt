mvg_class=GetValueFromSplayTree(macros,token);
            if (mvg_class != (const char *) NULL)
              {
                char *elements;
                size_t elements_length;

                // Retrieve the class definition and calculate its length
                elements=AcquireString(mvg_class);
                elements_length=strlen(elements);

                // Concatenate the class elements to the existing primitive
                size_t new_length = primitive_extent + elements_length + 1; // +1 for null terminator
                char *new_primitive = (char *) AcquireMemory(new_length);
                if (new_primitive == (char *) NULL)
                {
                  status = MagickFalse;
                  break;
                }

                // Copy the existing primitive and append the class elements
                memcpy(new_primitive, primitive, primitive_extent);
                memcpy(new_primitive + primitive_extent, elements, elements_length);
                new_primitive[new_length - 1] = '\0'; // Null-terminate the new string

                // Free the old primitive and update it with the new one
                primitive = DestroyString(primitive);
                primitive = new_primitive;

                // Update the stream pointer to the new position in the modified primitive
                q = new_primitive + primitive_extent;
              }