if (LocaleCompare("class",token) == 0)
{
  if (strcmp(token, graphic_context[n]->id) == 0)
    break;
  mvg_class = (const char *) GetValueFromSplayTree(macros, token);
  if (mvg_class != (const char *) NULL)
  {
    size_t class_length = strlen(mvg_class);
    size_t remaining_length = strlen(q);
    size_t new_length = primitive_extent + class_length + remaining_length + 1;
    char *new_primitive = (char *) AcquireQuantumMemory(new_length, sizeof(char));
    if (new_primitive == (char *) NULL)
    {
      ThrowFatalException(ResourceLimitFatalError, "MemoryAllocationFailed");
    }
    (void) CopyMagickString(new_primitive, primitive, primitive_extent);
    (void) ConcatenateString(new_primitive, mvg_class);
    (void) ConcatenateString(new_primitive, q);
    primitive = DestroyString(primitive);
    primitive = new_primitive;
    primitive_extent = new_length;
    q = primitive + (primitive_extent - remaining_length - 1);
  }
}