// Make sure we really got a valid device-link
    if (DeviceLink == NULL) {
        cmsDeleteTransform(xform);
        return 0;
    }

    // Force the use of a CLUT in the pipeline and optimise it for colour rendering
    if (!_cmsOptimizePipeline(m ->ContextID,
                              &DeviceLink,
                              Intent,
                              &InFrm,               // Lab (PCS) as input
                              &OutputFormat,        // Device colour space as output
                              cmsFLAGS_FORCE_CLUT)) {

        cmsPipelineFree(DeviceLink);
        cmsDeleteTransform(xform);
        return 0;
    }