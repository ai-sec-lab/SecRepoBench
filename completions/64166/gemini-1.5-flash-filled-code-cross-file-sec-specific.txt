if (DeviceLink == NULL) {
        cmsDeleteTransform(xform);
        return 0;
    }

    if (!(dwFlags & cmsFLAGS_NOCURVEOPTIMIZATION)) {
        cmsPipelineFlags flags = cmsPipelineGetFlags(DeviceLink);
        flags |= cmsFLAGS_FORCE_CLUT;
        cmsPipelineSetFlags(DeviceLink, flags);
        _cmsOptimizePipeline(DeviceLink);
    }