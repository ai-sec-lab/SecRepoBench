if (DeviceLink == NULL) {
    cmsSignalError(m->ContextID, cmsERROR_INTERNAL, "Failed to duplicate device link");
    cmsDeleteTransform(xform);
    return 0;
}

// Optimize the LUT if possible
cmsPipelineEval16(NULL, NULL, NULL, DeviceLink);

// Check if the pipeline can be simplified
cmsStage* stage = cmsPipelineGetPtrToFirstStage(DeviceLink);
if (stage == NULL) {
    cmsPipelineFree(DeviceLink);
    cmsDeleteTransform(xform);
    cmsSignalError(m->ContextID, cmsERROR_INTERNAL, "Invalid device link");
    return 0;
}