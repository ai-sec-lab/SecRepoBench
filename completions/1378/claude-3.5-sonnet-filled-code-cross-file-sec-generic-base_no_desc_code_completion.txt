if (c->video_size < aligned_width * avctx->height * c->bpp / 8)
    return AVERROR_INVALIDDATA;

if (c->palette_size && avctx->pix_fmt != AV_PIX_FMT_PAL8) {
    avctx->pix_fmt = AV_PIX_FMT_PAL8;
    if ((ret = ff_set_dimensions(avctx, w, h)) < 0)
        return ret;
}