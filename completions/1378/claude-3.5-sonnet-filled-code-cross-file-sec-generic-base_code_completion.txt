int padded_bits = aligned_width - avctx->width;
if (c->video_size < (aligned_width * avctx->height * c->bpp) >> 3)
    return AVERROR_INVALIDDATA;

if (c->palette_size) {
    avctx->pix_fmt = AV_PIX_FMT_PAL8;
} else {
    if (c->bpp == 24) {
        avctx->pix_fmt = AV_PIX_FMT_BGR24;
    } else if (c->bpp == 32) {
        avctx->pix_fmt = AV_PIX_FMT_RGB32;
    } else {
        avpriv_request_sample(avctx, "Unsupported bit depth %d", c->bpp);
        return AVERROR_PATCHWELCOME;
    }
}

if (c->format != CHUNKY && c->bpp != 8) {
    avpriv_request_sample(avctx, "Non-chunky %d-bit", c->bpp);
    return AVERROR_PATCHWELCOME;
}