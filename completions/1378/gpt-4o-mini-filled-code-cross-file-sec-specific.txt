if (c->video_size < aligned_width * h) {
        avpriv_request_sample(avctx, "Insufficient video size for dimensions %dx%d", w, h);
        return AVERROR_INVALIDDATA;
    }

    if (c->bpp == 8 && c->palette_size != 256) {
        avpriv_request_sample(avctx, "Invalid palette size for 8bpp: %d", c->palette_size);
        return AVERROR_INVALIDDATA;
    } else if (c->bpp == 6 && c->palette_size != 64) {
        avpriv_request_sample(avctx, "Invalid palette size for 6bpp: %d", c->palette_size);
        return AVERROR_INVALIDDATA;
    }

    // Ensure that the video buffer is allocated with the correct size
    if (c->video_size > avctx->extradata_size) {
        avpriv_request_sample(avctx, "Video size %d exceeds allocated buffer size %d", c->video_size, avctx->extradata_size);
        return AVERROR_INVALIDDATA;
    }