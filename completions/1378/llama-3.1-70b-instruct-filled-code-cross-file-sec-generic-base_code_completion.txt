int padded_bits = (aligned_width - avctx->width) * h * c->bpp / 8;
if (c->video_size < padded_bits + avctx->width * h * c->bpp / 8)
    return AVERROR_INVALIDDATA;

switch (c->format) {
    case BIT_PLANAR:
        if (c->bpp == 1)
            avctx->pix_fmt = AV_PIX_FMT_MONOBLACK;
        else if (c->bpp == 8)
            avctx->pix_fmt = AV_PIX_FMT_PAL8;
        else
            avpriv_request_sample(avctx, "Unsupported planar format");
        break;
    case BIT_LINE:
        if (c->bpp == 8)
            avctx->pix_fmt = AV_PIX_FMT_PAL8;
        else if (c->bpp == 24)
            avctx->pix_fmt = AV_PIX_FMT_BGR24;
        else
            avpriv_request_sample(avctx, "Unsupported line format");
        break;
    case CHUNKY:
        if (c->bpp == 8)
            avctx->pix_fmt = AV_PIX_FMT_PAL8;
        else if (c->bpp == 24)
            avctx->pix_fmt = AV_PIX_FMT_BGR24;
        else
            avpriv_request_sample(avctx, "Unsupported chunky format");
        break;
    default:
        avpriv_request_sample(avctx, "Unsupported format");
        return AVERROR_PATCHWELCOME;
}