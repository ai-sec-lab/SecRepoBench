int padded_bits = aligned_width - avctx->width;
    if (c->video_size < (aligned_width * h * c->bpp + 7) / 8 + padded_bits * h)
        return AVERROR_INVALIDDATA;

    if (encoding == 0 && c->palette_size) {
        avctx->pix_fmt = AV_PIX_FMT_PAL8;
    } else if (c->bpp == 8) {
        avctx->pix_fmt = AV_PIX_FMT_GRAY8;
    } else if (c->bpp == 24 && c->format == CHUNKY) {
        avctx->pix_fmt = AV_PIX_FMT_BGR24;
    } else if (c->bpp == 24) {
        avctx->pix_fmt = AV_PIX_FMT_RGB24;
    } else if (c->bpp == 16) {
        avctx->pix_fmt = AV_PIX_FMT_RGB555LE;
    } else {
        avpriv_request_sample(avctx, "Unknown format: bpp %d, format %d",
                              c->bpp, c->format);
        return AVERROR_PATCHWELCOME;
    }