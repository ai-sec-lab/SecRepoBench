/* The bitstream stores signed values using the standard
         * (value << 1) ^ (value >> 31) mapping, i.e. the LSB is the sign
         * (0 = positive, 1 = negative) and the remaining bits give the
         * magnitude minus one.  Reconstruct the signed coefficient, then
         * apply a very simple de-quantisation step based on the supplied
         * qscale. */
        {
            int level = (magnitude + 1) >> 1;   /* absolute value      */
            if (magnitude & 1)                  /* restore the sign    */
                level = -level;

            /* De-quantise – in the original codec this would also be
             * multiplied by a position–dependent weighting factor; for
             * our purposes scaling with the user-specified quality factor
             * is sufficient.                                                         */
            coeff = av_clip_int16(level * qscale);
        }