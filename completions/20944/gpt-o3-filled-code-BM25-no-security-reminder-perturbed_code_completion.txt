/* --------------------------------------------------------------------
   * Start with a clean / known state.
   * ------------------------------------------------------------------ */
  face          = faceptr;
  glyf_blob     = nullptr;
  loca_blob     = nullptr;
  glyf_table    = nullptr;
  loca_table    = nullptr;
  glyf_len      = 0;
  num_glyphs    = 0;
  short_offset  = false;
  initialized   = false;

  if (unlikely (!faceptr))
    return;

  /* --------------------------------------------------------------------
   * Load / validate ‘head’ table – we need indexToLocFormat.
   * ------------------------------------------------------------------ */
  hb_blob_t *head_blob =
      OT::Sanitizer<OT::head>::sanitize (faceptr->reference_table (HB_TAG ('h','e','a','d')));

  unsigned int head_len = 0;
  const OT::head *head_table =
      (const OT::head *) hb_blob_get_data (head_blob, &head_len);

  if (unlikely (!head_table)                                        ||
      (head_table->indexToLocFormat != 0 &&
       head_table->indexToLocFormat != 1)                           ||
      head_table->glyphDataFormat != 0)
  {
    hb_blob_destroy (head_blob);
    return;                     /* Unknown / unsupported format. */
  }

  short_offset = (head_table->indexToLocFormat == 0);
  hb_blob_destroy (head_blob);

  /* --------------------------------------------------------------------
   * Load ‘loca’ and ‘glyf’ tables.
   * ------------------------------------------------------------------ */
  loca_blob = OT::Sanitizer<OT::loca>::sanitize
                (faceptr->reference_table (HB_TAG ('l','o','c','a')));
  glyf_blob = OT::Sanitizer<OT::glyf>::sanitize
                (faceptr->reference_table (HB_TAG ('g','l','y','f')));

  unsigned int loca_len = 0;
  loca_table  = (const char *) hb_blob_get_data (loca_blob, &loca_len);

  glyf_table  = (const OT::glyf *) hb_blob_get_data (glyf_blob, &glyf_len);

  if (unlikely (!loca_table || !glyf_table))
    return;

  /* --------------------------------------------------------------------
   * Derive number-of-glyphs from ‘loca’ length.
   * (loca has numGlyphs+1 entries.)
   * ------------------------------------------------------------------ */
  num_glyphs = short_offset ? (loca_len / 2) - 1
                            : (loca_len / 4) - 1;

  initialized = true;