// Calculate num_glyphs using the length of the loca_table, adjusting for offset format.
    hb_blob_t *loca_blob = hb_face_reference_table(faceptr, HB_TAG('l', 'o', 'c', 'a'));
    if (HB_UNLIKELY(!loca_blob)) {
        return; // Handle the error appropriately
    }

    unsigned int num_glyphs = 0;
    if (hb_blob_get_length(loca_blob) > 0) {
        hb_blob_t *glyf_blob = hb_face_reference_table(faceptr, HB_TAG('g', 'l', 'y', 'f'));
        if (HB_UNLIKELY(!glyf_blob)) {
            hb_blob_destroy(loca_blob);
            return; // Handle the error appropriately
        }

        unsigned int loca_length = hb_blob_get_length(loca_blob);
        unsigned int num_entries = loca_length / (hb_face_get_table(faceptr, HB_TAG('h', 'e', 'a', 'd'))->length / 2);
        num_glyphs = num_entries - 1; // Subtract 1 because the last entry is the end of the font

        hb_blob_destroy(glyf_blob);
    }
    hb_blob_destroy(loca_blob);

    // Assign the calculated values to the respective members
    short_offset = determine_short_offset(faceptr);
    num_glyphs = num_glyphs;
    loca_table = loca_blob;
    glyf_table = glyf_blob;