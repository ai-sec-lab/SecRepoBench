face = faceptr;
if (hb_face_reference_table(face, HB_OT_TAG_head, &head_table)!= HB_OK)
  return;

hb_head_t *head = hb_sanitize_context_t(head_table);
if (head->indexToLocFormat!= 0 && head->indexToLocFormat!= 1) {
  hb_face_destroy(face);
  return;
}

short_offset = (head->indexToLocFormat == 0)? 2 : 4;

if (hb_face_reference_table(face, HB_OT_TAG_loca, &loca_table)!= HB_OK) {
  hb_face_destroy(face);
  return;
}

if (hb_face_reference_table(face, HB_OT_TAG_glyf, &glyf_table)!= HB_OK) {
  hb_face_destroy(face);
  return;
}

num_glyphs = hb_sanitize_context_t(loca_table)->length / short_offset;