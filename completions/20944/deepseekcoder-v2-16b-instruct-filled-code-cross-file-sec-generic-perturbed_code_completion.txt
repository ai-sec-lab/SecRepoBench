// Calculate num_glyphs using the length of the loca_table, adjusting for offset format.
      hb_face_t *hb_face = faceptr;
      hb_blob_t *loca_blob = hb_face_reference_table(hb_face, HB_TAG('l', 'o', 'c', 'a'));
      const char *loca_data = hb_blob_get_data(loca_blob, NULL);
      uint32_t loca_length = hb_blob_get_length(loca_blob);
      hb_blob_destroy(loca_blob);

      uint32_t num_glyphs = 0;
      if (hb_face_get_index_to_loc_format(hb_face) == 0) {
          num_glyphs = loca_length / 2;
      } else {
          num_glyphs = loca_length / 4;
      }