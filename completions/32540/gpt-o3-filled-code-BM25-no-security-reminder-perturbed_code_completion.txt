hb_set_t *covered_glyph_set = nullptr;

    /* Make sure we have room for this lookup index. */
    if (indexlookup >= done_lookups_glyph_count->length)
    {
      if (unlikely (!done_lookups_glyph_count->resize (indexlookup + 1) ||
                    !done_lookups_glyph_set  ->resize (indexlookup + 1)))
        return true; /* Bail out on OOM. */
    }

    /* Current active-glyph population. */
    unsigned int active_glyph_count = hb_set_get_population (parent_active_glyphs ());

    /* Obtain / initialise the glyph-set slot for this lookup. */
    hb_set_t *&slot_set = (*done_lookups_glyph_set)[indexlookup];
    if (!slot_set)
    {
      slot_set = hb_set_create ();
      if (unlikely (!slot_set))
        return true;
    }

    /* If population changed, reset the stored set. */
    if ((*done_lookups_glyph_count)[indexlookup] != active_glyph_count)
    {
      (*done_lookups_glyph_count)[indexlookup] = active_glyph_count;
      hb_set_clear (slot_set);
    }

    covered_glyph_set = slot_set;

    /* If we've already covered all current glyphs, lookup is done. */
    if (hb_set_is_subset (parent_active_glyphs (), covered_glyph_set))
      return true;