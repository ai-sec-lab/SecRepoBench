/* Sanity-check the maximum matrix channel.                                        */
    if (max_matrix_channel > std_max_matrix_channel) {
        /* The stream advertises more matrix channels than the specification allows
         * for this codec variant.  Treat this as unimplemented for the moment.      */
        avpriv_request_sample(m->avctx,
                              "max_matrix_channel %d > allowed %d",
                              max_matrix_channel, std_max_matrix_channel);
        return AVERROR_PATCHWELCOME;
    }

    /* It must also fit within the hard MAX_CHANNELS limit (noise channels included
     * if they are going to be generated later on).                                   */
    if (max_matrix_channel >= MAX_CHANNELS ||
        (noise_type && max_matrix_channel + 2 >= MAX_CHANNELS)) {
        av_log(m->avctx, AV_LOG_ERROR,
               "max_matrix_channel (%d) plus noise channels exceeds %d.\n",
               max_matrix_channel, MAX_CHANNELS - 1);
        return AVERROR_INVALIDDATA;
    }