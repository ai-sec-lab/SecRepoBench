if (aux[0] == 'R' && aux[1] == 'G' && aux[2] == 'Z') {
    char *rg = (char *)aux + 3;
    khint_t k;
    int new;
    
    // Ensure RG is null-terminated
    char *end = memchr(rg, '\0', aux_end - rg);
    if (!end) goto err;
    
    k = kh_put(m_s2i, c->comp_hdr->RG_hash, rg, &new);
    if (new < 0) goto err;
    if (new) {
        kh_val(c->comp_hdr->RG_hash, k) = c->comp_hdr->nRG;
        c->comp_hdr->nRG++;
    }
    cr->rg = kh_val(c->comp_hdr->RG_hash, k);
    brg = sam_hrecs_find_rg(fd->header->hrecs, rg);
}

aux += 3;
while (*aux && aux < aux_end) {
    int r;
    int32_t i32;
    cram_map *m = map_find(c->comp_hdr->tag_encoding_map,
                           aux, aux[0]<<16|aux[1]<<8|aux[2]);
    if (!m) goto err;

    r = cram_decode_aux(fd, c, s, aux, aux_end, m, &tm);
    if (r == 0) goto err;

    aux += r;
    BLOCK_APPEND(tm->blk, (char *)aux-r, r);