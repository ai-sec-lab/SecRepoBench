// Extract the tag name and type
        char tag[3];
        tag[0] = aux[0];
        tag[1] = aux[1];
        tag[2] = aux[2];
        aux += 3;

        // Handle RG:Z (Read Group) tag
        if (tag[0] == 'R' && tag[1] == 'G' && tag[2] == 'Z') {
            char *rg = aux;
            while (aux < aux_end && *aux)
                aux++;
            aux++; // Skip the null terminator

            // Find or add RG to the header
            if (!(brg = sam_hdr_find_rg(fd->header, rg))) {
                hts_log_warning("RG tag refers to unknown read group '%s'", rg);
            }
        }

        // Handle MD:Z (Mismatch Description) tag
        if (tag[0] == 'M' && tag[1] == 'D' && tag[2] == 'Z') {
            if (!verbatim_MD) {
                // Store MD tag for later
                if (MD) {
                    kputsn(aux, strlen(aux), MD);
                }
            }
            while (aux < aux_end && *aux)
                aux++;
            aux++; // Skip the null terminator
            continue;
        }

        // Handle NM:i (Number of Mismatches) tag
        if (tag[0] == 'N' && tag[1] == 'M' && tag[2] == 'i') {
            if (!verbatim_NM) {
                // Store NM value for later
                NM = bam_aux2i(aux - 3);
            }
            aux += 4; // Skip the integer value
            continue;
        }

        // Add the tag to the tag dictionary
        r = cram_add_tag(fd, c, s, cr, tag, aux, aux_end - aux);
        if (r < 0)
            goto err;

        // Move to the next tag
        aux += r;