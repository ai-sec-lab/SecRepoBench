if (aux[0] == 'R' && aux[1] == 'G') {
            const char *rg = sam_hdr_line_name(fd->header, "RG", cr->rg);
            if (!rg) {
                hts_log_warning("Missing Read Group for RG tag");
                goto err;
            }
            size_t rg_len = strlen(rg);
            BLOCK_APPEND(s->aux_blk, aux, 3); // Append the RG tag
            BLOCK_APPEND(s->aux_blk, rg, rg_len); // Append the RG value
            BLOCK_APPEND_CHAR(s->aux_blk, '\0'); // Null-terminate the string
            cr->aux_size += 3 + rg_len + 1; // Update the auxiliary size
            aux += 3; // Move to the next tag
            continue;
        }

        // Handle other auxiliary tags (e.g., MD, NM)
        if (aux[0] == 'M' && aux[1] == 'D') {
            // Process MD tag
            // Assuming MD is stored verbatim, we can directly append it
            BLOCK_APPEND(s->aux_blk, aux, 3); // Append the MD tag
            // Here we would need to decode the MD value and append it
            // For simplicity, let's assume we have a function to get the MD value
            const char *md_value = get_md_value(cr); // Hypothetical function
            size_t md_len = strlen(md_value);
            BLOCK_APPEND(s->aux_blk, md_value, md_len); // Append the MD value
            BLOCK_APPEND_CHAR(s->aux_blk, '\0'); // Null-terminate the string
            cr->aux_size += 3 + md_len + 1; // Update the auxiliary size
            aux += 3; // Move to the next tag
            continue;
        }

        if (aux[0] == 'N' && aux[1] == 'M') {
            // Process NM tag
            BLOCK_APPEND(s->aux_blk, aux, 3); // Append the NM tag
            // Assuming NM is an integer, we would need to convert and append it
            int nm_value = get_nm_value(cr); // Hypothetical function
            BLOCK_APPEND(s->aux_blk, (char *)&nm_value, sizeof(nm_value)); // Append the NM value
            cr->aux_size += 3 + sizeof(nm_value); // Update the auxiliary size
            aux += 3; // Move to th