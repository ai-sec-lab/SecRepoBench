if (aux[0] == 'R' && aux[1] == 'G' && aux[2] == 'Z') {
    brg = sam_hdr_find_rg(fd->header, aux + 3);
    if (!brg) {
        hts_log_warning("RG:Z:%s read group not present in header", aux + 3);
    }
}

if (aux[0] == 'M' && aux[1] == 'D' && verbatim_MD)
    verbatim_MD = 0;

if (aux[0] == 'N' && aux[1] == 'M' && verbatim_NM)
    verbatim_NM = 0;

tm = map_find(c->comp_hdr->tag_encoding_map, aux, id);
if (!tm) {
    tm = map_find(c->comp_hdr->tag_encoding_map, "\0\0", 0);
    if (!tm) {
        hts_log_warning("Couldn't encode aux tag '%c%c'", aux[0], aux[1]);
        continue;
    }
}

if (tm->codec == E_HUFFMAN) {
    BLOCK_APPEND(tm->blk, aux+3, auxlen-3);
} else if (tm->codec == E_BYTE_ARRAY_STOP) {
    BLOCK_APPEND(tm->blk, aux+3, auxlen-3);
    BLOCK_APPEND_CHAR(tm->blk, 0);
} else if (tm->codec == E_BYTE_ARRAY_LEN) {
    BLOCK_APPEND_CHAR(tm->blk, auxlen-3);
    BLOCK_APPEND(tm->blk, aux+3, auxlen-3);
} else {
    // int32 or real
    BLOCK_APPEND(tm->blk, aux+3, auxlen-3);
}

if (tm->blk->byte + (auxlen-3) > tm->blk->alloc)
    return NULL;