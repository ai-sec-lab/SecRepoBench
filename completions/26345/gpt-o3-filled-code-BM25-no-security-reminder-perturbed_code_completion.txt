/* Sanity: set default values */
        p->time_with_year = FLB_FALSE;
        p->time_with_tz   = FLB_FALSE;
        p->time_frac_secs = FLB_FALSE;
        p->time_offset    = 0;
        p->time_len       = 0;
        p->time_delim     = 0;
        p->time_tm_year   = 0;
        p->time_tm_upto_year = 0;
        p->time_fmt_year  = NULL;

        /* Look for a year specifier */
        if (strstr(p->time_fmt, "%Y") || strstr(p->time_fmt, "%y")) {
            p->time_with_year = FLB_TRUE;
        }

        /* Handle Epoch (%s) */
        if (strstr(p->time_fmt, "%s")) {
            is_epoch = FLB_TRUE;
            p->time_with_year = FLB_TRUE; /* we will get a full epoch value */
        }

        /*
         * No year in the format ?               -> prepend "%Y "
         * We need to allocate an extra 3 bytes: -> "%Y" + " " + '\0'
         */
        if (p->time_with_year == FLB_FALSE) {
            len = strlen(p->time_fmt) + 4;
            tmp = flb_malloc(len);
            if (!tmp) {
                flb_errno();
                flb_parser_destroy(p);
                return NULL;
            }
            snprintf(tmp, len, "%%Y %s", p->time_fmt);
            p->time_fmt_year = tmp;
        }

        /* Check for timezone information */
        if (strstr(p->time_fmt, "%Z") || strstr(p->time_fmt, "%z")) {
            p->time_with_tz = FLB_TRUE;
        }

#ifdef FLB_HAVE_GMTOFF
        /* Nothing to do, strptime() on this platform supports %z / %Z */
#else
        if (p->time_with_tz == FLB_TRUE) {
            flb_error("[parser:%s] timezone (%s) found in time_fmt but "
                      "platform does not support it",
                      name, p->time_fmt);
            flb_parser_destroy(p);
            return NULL;
        }
#endif

        /* Fractional seconds (%L) */
        timeptr = strstr(p->time_fmt, "%L");
        if (timeptr) {
            p->time_frac_secs = FLB_TRUE;
            diff = timeptr - p->time_fmt;
            size = diff + 1;          /* position up to %L  */
            tmp = flb_malloc(size);
            if (!tmp) {
                flb_errno();
                flb_parser_destroy(p);
                return NULL;
            }
            memcpy(tmp, p->time_fmt, diff);
            tmp[diff] = '\0';
            flb_free(p->time_fmt);
            p->time_fmt = tmp;
        }

        /* Optional fixed timezone offset */
        if (time_offset) {
            p->time_offset = atoi(time_offset);
        }