scale = (double)(((size_t)1UL << jp2_image->comps[i].prec) - 1) / QuantumRange;
        pixel = (double)(jp2_image->comps[i].data[y / jp2_image->comps[i].dy * image->columns / jp2_image->comps[i].dx + x / jp2_image->comps[i].dx]);

        // Adjust for signed components
        if (jp2_image->comps[i].sgnd)
        {
            pixel += (1 << (jp2_image->comps[i].prec - 1)); // Add offset for signed values
        }

        // Scale the pixel value
        pixel *= scale;