scale = (double)(((size_t)1UL << jp2_image->comps[i].prec) - 1) / QuantumRange;
        pixel = (double)(*q) * scale; // Scale the pixel value based on the component precision

        // Adjust for signedness
        if (jp2_image->comps[i].sgnd) {
            pixel -= (1 << (jp2_image->comps[i].prec - 1)); // Adjust for signed values
        }

        // Ensure pixel value is within valid range
        if (pixel < 0) {
            pixel = 0;
        } else if (pixel > QuantumRange) {
            pixel = QuantumRange;
        }