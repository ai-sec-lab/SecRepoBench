scale=(double) QuantumRange/((1UL << jp2_image->comps[i].prec)-1);
pixel=(double) jp2_image->comps[i].data[y/jp2_image->comps[i].dy*
  jp2_image->comps[i].w/jp2_image->comps[i].dx+x/jp2_image->comps[i].dx];
if (jp2_image->comps[i].sgnd != 0)
  pixel+=(double) (1L << (jp2_image->comps[i].prec-1));
pixel*=scale;