/*
     * Generate a textual representation of the content model
     */
#define APPEND_STRING(str)                                                   \
    do {                                                                     \
        len = strlen(buf);                                                   \
        if ((capacity - len) <= (int)strlen(str) + 1) {                      \
            if ((capacity - len > 4) && (buf[len - 1] != '.'))               \
                strcat(buf, " ...");                                         \
            return;                                                          \
        }                                                                    \
        strcat(buf, (str));                                                  \
    } while (0)

    switch (content->type) {
        case XML_ELEMENT_CONTENT_PCDATA:
            APPEND_STRING("#PCDATA");
            break;
        case XML_ELEMENT_CONTENT_ELEMENT:
            if (content->prefix != NULL) {
                APPEND_STRING((const char *)content->prefix);
                APPEND_STRING(":");
            }
            if (content->name != NULL)
                APPEND_STRING((const char *)content->name);
            break;
        case XML_ELEMENT_CONTENT_SEQ:
            if (content->c1 != NULL)
                xmlSnprintfElementContent(buf, capacity, content->c1,
                    (content->c1->type == XML_ELEMENT_CONTENT_OR ||
                     content->c1->type == XML_ELEMENT_CONTENT_SEQ));
            APPEND_STRING(", ");
            if (content->c2 != NULL)
                xmlSnprintfElementContent(buf, capacity, content->c2,
                    (content->c2->type == XML_ELEMENT_CONTENT_OR ||
                     content->c2->type == XML_ELEMENT_CONTENT_SEQ));
            break;
        case XML_ELEMENT_CONTENT_OR:
            if (content->c1 != NULL)
                xmlSnprintfElementContent(buf, capacity, content->c1,
                    (content->c1->type == XML_ELEMENT_CONTENT_OR ||
                     content->c1->type == XML_ELEMENT_CONTENT_SEQ));
            APPEND_STRING(" | ");
            if (content->c2 != NULL)
                xmlSnprintfElementContent(buf, capacity, content->c2,
                    (content->c2->type == XML_ELEMENT_CONTENT_OR ||
                     content->c2->type == XML_ELEMENT_CONTENT_SEQ));
            break;
        default:
            break;
    }
#undef APPEND_STRING