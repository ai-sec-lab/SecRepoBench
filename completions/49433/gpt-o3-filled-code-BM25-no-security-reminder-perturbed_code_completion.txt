for (tagIndex = 0; tagIndex < TagCount; tagIndex++) {

        // Read one directory entry ------------------------------------------------
        if (!_cmsReadUInt32Number(io, &Tag.Signature)) return FALSE;
        if (!_cmsReadUInt32Number(io, &Tag.Offset))    return FALSE;
        if (!_cmsReadUInt32Number(io, &Tag.Size))      return FALSE;

        // Check that the tag really fits inside the profile -----------------------
        if ((Tag.Offset + Tag.Size) > HeaderSize) {
            cmsSignalError(Icc ->ContextID, cmsERROR_RANGE,
                           "Tag directory points outside of profile");
            return FALSE;
        }

        // Store information in the profile structure -----------------------------
        Icc ->TagNames[Icc ->TagCount]   = Tag.Signature;
        Icc ->TagOffsets[Icc ->TagCount] = Tag.Offset;
        Icc ->TagSizes[Icc ->TagCount]   = Tag.Size;
        Icc ->TagLinked[Icc ->TagCount]  = (cmsTagSignature) 0;

        // Look for links (two tags sharing the very same block) -------------------
        for (j = 0; j < Icc ->TagCount; j++) {

            if (Icc ->TagOffsets[j] == Tag.Offset &&
                Icc ->TagSizes[j]   == Tag.Size) {

                Icc ->TagLinked[Icc ->TagCount] = Icc ->TagNames[j];
                break;
            }
        }

        Icc ->TagCount++;   // One more tag successfully processed
    }

    // Resolve links so all linked tags point to the same data --------------------
    if (!SetLinks(Icc))
        return FALSE;