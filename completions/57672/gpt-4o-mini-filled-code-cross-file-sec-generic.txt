{
    // Allocate memory for the new stack
    mrb_value *new_stack = (mrb_value*)mrb_malloc_simple(mrb, sizeof(mrb_value) * len);
    if (!new_stack) {
      // If memory allocation fails, handle the error appropriately
      if (!noraise) {
        mrb_exc_raise(mrb, mrb_obj_value(mrb->nomem_err));
      }
      return FALSE;
    }

    // Copy the existing stack contents to the new stack
    memcpy(new_stack, e->stack, sizeof(mrb_value) * len);
    
    // Assign the new stack to the environment
    e->stack = new_stack;

    // Mark the environment as closed
    MRB_ENV_CLOSE(e);
    MRB_ENV_SET_LEN(e, len);
    MRB_ENV_SET_BIDX(e, 0);
    
    return TRUE;
  }