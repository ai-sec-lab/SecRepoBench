/* Sanity check: need at least 4 bytes to hold the "xn--" marker */
  if(buffer == NULL || length < 4)
    return 0;

  /* Search the buffer for the punycode prefix "xn--" (caseâ€“insensitive) */
  for(int i = 0; i <= length - 4; i++) {
    char c0 = buffer[i];
    char c1 = buffer[i + 1];

    /* Fast-path: first two characters must be x/X and n/N */
    if((c0 == 'x' || c0 == 'X') &&
       (c1 == 'n' || c1 == 'N') &&
       buffer[i + 2] == '-' &&
       buffer[i + 3] == '-') {
      return 1;             /* Punycode prefix found */
    }
  }

  /* Prefix not found */
  return 0;