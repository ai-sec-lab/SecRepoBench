// Iterate over the candidate reference picture lists (ST_CURR_BEF, ST_CURR_AFT, LT_CURR).
// For each candidate list, append its references to a temporary reference picture list (rpl_tmp).
// Ensure the list does not exceed the maximum number of references allowed (HEVC_MAX_REFS).
// If the current picture reference is enabled by the PPS, add the current picture as a reference.
while (rpl_tmp.nb_refs < sh->nb_refs[list_idx]) {
    for (i = 0; i < s->rps[cand_lists[rpl_tmp.nb_refs / s->rps[cand_lists[rpl_tmp.nb_refs / HEVC_MAX_REFS]].nb_refs]].nb_refs; i++) {
        if (rpl_tmp.nb_refs < HEVC_MAX_REFS) {
            rpl_tmp.list[rpl_tmp.nb_refs] = s->ref->refPicList[cand_lists[rpl_tmp.nb_refs / HEVC_MAX_REFS]].list[i];
            rpl_tmp.ref[rpl_tmp.nb_refs]  = s->ref->refPicList[cand_lists[rpl_tmp.nb_refs / HEVC_MAX_REFS]].ref[i];
            rpl_tmp.isLongTerm[rpl_tmp.nb_refs] = s->ref->refPicList[cand_lists[rpl_tmp.nb_refs / HEVC_MAX_REFS]].isLongTerm[i];
            rpl_tmp.nb_refs++;
        } else {
            break;
        }
    }
}

if (s->ps.pps->pps_curr_pic_ref_enabled_flag && rpl_tmp.nb_refs < sh->nb_refs[list_idx]) {
    rpl_tmp.list[rpl_tmp.nb_refs] = s->ref->poc;
    rpl_tmp.ref[rpl_tmp.nb_refs]  = s->ref;
    rpl_tmp.isLongTerm[rpl_tmp.nb_refs] = 0;
    rpl_tmp.nb_refs++;
}