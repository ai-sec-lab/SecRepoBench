char buf[64], *p, *pend, *end;
double d;

if (len >= sizeof(buf)) {
  p = (char*)mrb_malloc(mrb, len + 1);
  pend = p + len;
  memcpy(p, s, len);
  p[len] = '\0';
  goto nocopy;
}
memcpy(buf, s, len);
pend = buf + len;