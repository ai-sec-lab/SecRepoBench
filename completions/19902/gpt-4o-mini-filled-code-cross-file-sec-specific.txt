char buf[256]; // Buffer to hold the cleaned string
  const char *p = s;
  const char *end = s + len;
  char *n = buf;

  // Trim leading whitespace
  while (p < end && ISSPACE(*p)) p++;

  // Copy valid characters to the buffer
  while (p < end && (isdigit(*p) || *p == '.' || *p == '-' || *p == '+' || *p == 'e' || *p == 'E')) {
    if (n < buf + sizeof(buf) - 1) { // Ensure we do not overflow the buffer
      *n++ = *p;
    }
    p++;
  }

  // Null-terminate the buffer
  *n = '\0';

  // Convert the cleaned string in the buffer to a double
  char *endptr;
  double d = strtod(buf, &endptr);

  // Check for errors if badcheck is true
  if (badcheck && (endptr == buf || *endptr != '\0')) {
    goto bad;
  }