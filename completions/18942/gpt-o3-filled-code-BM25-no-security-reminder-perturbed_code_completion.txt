{
        int parseresult = ERROR_SUCCESS;
        int var_frame;

        /* Each time we enter a new loop make sure that the nesting limit
           hasn’t been reached.  */
        if (compiler->loop_depth == YR_MAX_LOOP_NESTING)
          parseresult = ERROR_LOOP_NESTING_LIMIT_EXCEEDED;

        fail_if_error(parseresult);

        /*
         * Space for three internal variables is required for every “for … in”
         * loop:
         *
         *     frame + 0  ->  accumulator (number of expressions that evaluate
         *                     to true)
         *     frame + 1  ->  iterations counter
         *     frame + 2  ->  loop quantifier (any, all, 1, 2, …)
         *
         * The quantifier is on top of the stack at this point, the other two
         * variables must be initialised to zero/undefined.
         */

        var_frame = _yr_compiler_get_var_frame(compiler);

        /* Initialise accumulator and iterations counter to 0. */
        yr_parser_emit_with_arg(
            yyscanner, OP_CLEAR_M, var_frame + 0, NULL, NULL);

        yr_parser_emit_with_arg(
            yyscanner, OP_CLEAR_M, var_frame + 1, NULL, NULL);

        /* Pop the quantifier from the stack into its slot. */
        yr_parser_emit_with_arg(
            yyscanner, OP_POP_M, var_frame + 2, NULL, NULL);

        /* Setup loop context for the current depth. */
        compiler->loop[compiler->loop_depth].vars_internal_count = 3;
        compiler->loop[compiler->loop_depth].vars_count          = 0;
        compiler->loop[compiler->loop_depth].addr                = NULL;
}