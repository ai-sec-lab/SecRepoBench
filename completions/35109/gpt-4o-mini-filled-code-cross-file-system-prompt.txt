while (p < end && isdigit((unsigned char)*p)) {
    mrb_int digit = *p - '0';
    if (mrb_int_mul_overflow(next_n, 10, &next_n) || mrb_int_add_overflow(next_n, digit, &next_n)) {
        return NULL; // Overflow detected
    }
    p++;
}

if (p > end) {
    // Raise an error for malformed format string
    mrb_raise(mrb, E_ARGUMENT_ERROR, "malformed format string");
}