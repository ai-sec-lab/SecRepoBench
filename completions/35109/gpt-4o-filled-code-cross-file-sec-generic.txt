while (p < end && isdigit((unsigned char)*p)) {
    int digit = *p - '0';
    if (mrb_int_mul_overflow(next_n, 10, &next_n) || next_n > (MRB_INT_MAX - digit)) {
      return NULL; // overflow detected
    }
    next_n = next_n * 10 + digit;
    p++;
  }
  if (p >= end) {
    return NULL; // malformed format string
  }