while (p < end && ISDIGIT(*p)) {
  mrb_int tmp;
  if (mrb_int_mul_overflow(next_n, 10, &tmp)) {
    return NULL;
  }
  if (tmp > MRB_INT_MAX - (*p - '0')) {
    return NULL;
  }
  next_n = tmp + (*p - '0');
  p++;
}

if (p == end) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "malformed format string - %%*[0-9]");
}