while (p < end && ISDIGIT(*p)) {
    int c = *p++ - '0';
    if (mrb_int_mul_overflow(next_n, 10, &next_n) || next_n > (MRB_INT_MAX - c)) {
      return NULL;
    }
    next_n = next_n * 10 + c;
  }
  if (p > end) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "malformed format string - end of string reached");
  }