int64_t next_n = (int64_t)*valp;
while (p < end && isdigit((unsigned char)*p)) {
    int64_t new_n;
    if (mrb_int_mul_overflow(next_n, 10, &new_n) || new_n > MRB_INT_MAX - (int64_t)(unsigned char)*p + '0') {
        return NULL;
    }
    next_n = new_n + (int64_t)(unsigned char)*p - '0';
    p++;
}
if (p == end) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "Malformed format string");
}
*valp = (int)next_n;
return p;