const char *start = p;

  /* parse consecutive decimal digits */
  while (p < end && ISDIGIT((unsigned char)*p)) {
    int d = *p++ - '0';

#ifdef MRB_INT_MAX
    if (nextnumber > (MRB_INT_MAX - d) / 10) {           /* overflow check */
      mrb_raise(mrb, E_RANGE_ERROR, "integer too big in format string");
    }
#endif
    nextnumber = nextnumber * 10 + d;
  }

  /* no digit found => malformed format string */
  if (start == p) {
    mrb_raise(mrb, E_ARGUMENT_ERROR, "malformed format string");
  }