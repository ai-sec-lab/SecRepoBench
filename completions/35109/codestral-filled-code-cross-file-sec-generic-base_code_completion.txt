while (p < end && isdigit((unsigned char)*p)) {
  mrb_int next_n_tmp = next_n * 10 + (*p - '0');
  if (mrb_int_mul_overflow(next_n, 10) || next_n_tmp < next_n) {
    return NULL;
  }
  next_n = next_n_tmp;
  p++;
}

if (p > end) {
  mrb_raise(mrb, E_ARGUMENT_ERROR, "malformed format string");
}