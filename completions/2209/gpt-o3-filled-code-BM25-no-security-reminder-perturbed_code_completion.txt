HEVCFrame *ref;
    int i;

    /* make sure we don't overflow the reference list */
    if (list->nb_refs >= HEVC_MAX_REFS) {
        av_log(s->avctx, AV_LOG_ERROR, "reference count overflow\n");
        return AVERROR_INVALIDDATA;
    }

    /* look for an already decoded reference with the requested POC */
    ref = find_ref_idx(s, pictureordercount);

    /* if the reference is missing, abort â€“ we do not currently synthesise
     * missing reference pictures in this context */
    if (!ref) {
        av_log(s->avctx, AV_LOG_ERROR,
               "unable to find reference frame with POC %d\n",
               pictureordercount);
        return AVERROR_INVALIDDATA;
    }

    /* avoid inserting the same reference twice */
    for (i = 0; i < list->nb_refs; i++) {
        if (list->ref[i] == ref) {
            av_log(s->avctx, AV_LOG_ERROR,
                   "duplicate reference (POC %d) in list\n",
                   pictureordercount);
            return AVERROR_INVALIDDATA;
        }
    }