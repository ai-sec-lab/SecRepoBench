// Attempt to find a reference frame in the DPB with a given POC (picture order count).
HEVCFrame *ref = find_ref_idx(s, poc);
if (ref) {
    // If the found reference is the same as the current reference, return an error to prevent adding a duplicate or overflow.
    if (ref == list->ref[list->nb_refs]) {
        return AVERROR(EINVAL);
    }
} else {
    // If no reference is found, attempt to generate a missing reference frame for the given POC.
    ref = generate_missing_reference(s, poc);
    if (!ref) {
        // Return an error if the generation fails due to memory constraints.
        return AVERROR(ENOMEM);
    }
}