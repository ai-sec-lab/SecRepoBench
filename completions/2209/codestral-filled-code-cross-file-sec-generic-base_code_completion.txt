HEVCFrame *ref = find_ref_idx(s, poc);

if (!ref) {
    ref = ff_hevc_frame_alloc(s);
    if (!ref) {
        av_log(s->avctx, AV_LOG_ERROR, "Error allocating memory for missing reference frame\n");
        return AVERROR(ENOMEM);
    }
    ref->poc = poc;
    ref->sequence = s->seq_decode;
    // Initialize other necessary fields of ref
} else if (ref == s->ref->refPicList[ref_idx_curr].ref[ref_idx]) {
    av_log(s->avctx, AV_LOG_ERROR, "Attempting to add a duplicate reference frame\n");
    return AVERROR_INVALIDDATA;
}