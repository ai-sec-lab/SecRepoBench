HEVCFrame *ref;

    if (list->nb_refs >= MAX_REFS) {
        av_log(s->avctx, AV_LOG_ERROR, "Reference overflow (nb_refs >= MAX_REFS)\n");
        return AVERROR_INVALIDDATA;
    }

    ref = find_ref_idx(s, poc);

    if (ref) {
         for (int i = 0; i < list->nb_refs; i++)
            if (list->list[i] == ref->poc) {
                av_log(s->avctx, AV_LOG_WARNING, "Duplicate POC in reference list\n");
                return -1; // Or an appropriate error code
            }
    } else {
        ref = ff_hevc_generate_missing_ref(s, poc); // Generate missing reference frame
        if (!ref) {
            av_log(s->avctx, AV_LOG_ERROR, "Could not generate missing reference frame\n");
            return AVERROR(ENOMEM); // Or another appropriate error
        }
    }