HEVCFrame *ref = find_ref_idx(s, poc);
if (!ref) {
    // If no reference is found, attempt to generate a missing reference frame
    ref = generate_missing_ref(s, poc);
    if (!ref)
        return AVERROR(ENOMEM);
}

if (list->nb_refs >= MAX_REFS)
    return AVERROR(EINVAL);

// Check if the reference is already in the list
for (int i = 0; i < list->nb_refs; i++) {
    if (list->list[i] == poc)
        return AVERROR(EINVAL);
}