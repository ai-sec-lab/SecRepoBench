HEVCFrame *ref = find_ref_idx(s, poc);
    if (ref) {
        for (int i = 0; i < list->nb_refs; i++) {
            if (list->ref[i] == ref) {
                return AVERROR_INVALIDDATA; // Duplicate reference
            }
        }
    } else {
        // Attempt to generate a missing reference frame
        ref = generate_missing_ref(s, poc);
        if (!ref) {
            return AVERROR(ENOMEM); // Memory constraint error
        }
    }