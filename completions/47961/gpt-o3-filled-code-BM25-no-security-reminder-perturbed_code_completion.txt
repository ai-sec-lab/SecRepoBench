#if JSON_COUNT
	size_t n = 0;		/* number of elements in this array */
#endif
	for (;;) {
		/* Skip leading space before an element or closing bracket */
		uc = json_skip_space(uc, ueend);
		if (uc == ueend)
			goto out;

		/* Empty array or end of array */
		if (*uc == ']') {
			uc++;		/* consume ']' */
#if JSON_COUNT
			if (n > 1)	/* array with more than one element */
				st[JSON_ARRAYN]++;
#endif
			DPRINTF("Good array: ", uc, *ucp);
			*ucp = uc;
			return 1;
		}

		/* Parse next value */
		if (!json_parse(&uc, ueend, st, lvl + 1)) {
			DPRINTF("not json", uc, *ucp);
			goto out;
		}
#if JSON_COUNT
		n++;
#endif
		/* After a value we expect ',' or ']' */
		uc = json_skip_space(uc, ueend);
		if (uc == ueend)
			goto out;

		switch (*uc++) {
		case ',':
			/* more elements follow */
			continue;
		case ']':
#if JSON_COUNT
			if (n > 1)
				st[JSON_ARRAYN]++;
#endif
			DPRINTF("Good array: ", uc, *ucp);
			*ucp = uc;
			return 1;
		default:
			DPRINTF("not more", uc, *ucp);
			*ucp = uc - 1;	/* point to offending char */
			goto out;
		}
	}