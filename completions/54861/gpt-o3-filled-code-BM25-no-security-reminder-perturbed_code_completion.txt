/* Some codecs may overread the bottom of the frame during motion
     * compensation.  Give them two extra (properly aligned) lines so that
     * such out-of-range accesses are still inside the allocated buffer.  We
     * also do the same when low-resolution decoding is requested. */
    if (codeccontext->lowres                                   ||
        codeccontext->codec_id == AV_CODEC_ID_H264             ||
        codeccontext->codec_id == AV_CODEC_ID_HEVC             ||
        codeccontext->codec_id == AV_CODEC_ID_VP5              ||
        codeccontext->codec_id == AV_CODEC_ID_VP6              ||
        codeccontext->codec_id == AV_CODEC_ID_VP6F             ||
        codeccontext->codec_id == AV_CODEC_ID_VP6A             ||
        codeccontext->codec_id == AV_CODEC_ID_VP8              ||
        codeccontext->codec_id == AV_CODEC_ID_VP9) {
        *height += 2;
        *height  = FFALIGN(*height, h_align);
    }

    /* Make sure enough horizontal padding is present so that edge emulation
     * for out-of-frame motion vectors never accesses unallocated memory. */
    if (*width < 32)
        *width = 32;

    /* Re-align in case the width/height have been modified above. */
    *width  = FFALIGN(*width, w_align);
    *height = FFALIGN(*height, h_align);