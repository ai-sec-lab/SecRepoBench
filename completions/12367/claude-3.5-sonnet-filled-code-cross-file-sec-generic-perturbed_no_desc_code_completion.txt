if (buf_size > 32) {
    nb_slices = AV_RL16(avpkt->data + buf_size - 2);
    if (nb_slices > 0) {
        slices_info_offset = AV_RL32(avpkt->data + buf_size - 6);
        if (slices_info_offset > buf_size - 6 - nb_slices * 8)
            return AVERROR_INVALIDDATA;
        slice_height = height / nb_slices;
    } else {
        nb_slices = 1;
        slices_info_offset = 0;
        slice_height = height;
    }
} else {
    nb_slices = 1;
    slices_info_offset = 0;
    slice_height = height;
}

if (slice_height <= 0 || nb_slices > INT_MAX / sizeof(HYuvSlice))
    return AVERROR_INVALIDDATA;