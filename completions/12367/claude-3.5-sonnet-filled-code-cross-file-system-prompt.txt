if (avctx->codec_id == AV_CODEC_ID_HYMT) {
    if (buf_size < 16 || (buf[buf_size - 1] & 0x80) == 0)
        return AVERROR_INVALIDDATA;

    nb_slices = buf[buf_size - 1] & 0x7F;
    slice_height = ((height + nb_slices - 1) / nb_slices) & ~1;
    slices_info_offset = buf_size - 8 * nb_slices - 1;

    if (slices_info_offset < table_size ||
        8 * nb_slices + 1 > buf_size - table_size ||
        slice_height <= 0 ||
        nb_slices * slice_height > height)
        return AVERROR_INVALIDDATA;
} else {
    nb_slices = 1;
    slice_height = height;
    slices_info_offset = 0;
}