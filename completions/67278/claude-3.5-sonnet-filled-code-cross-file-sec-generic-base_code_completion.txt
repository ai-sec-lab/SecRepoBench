u32 hdr, size;
u32 pos = (u32) gf_bs_get_position(bs);
if (pos >= size) break;
hdr = gf_bs_read_u8(bs);
if (hdr & 0x80) {
    if (gf_bs_available(bs) < 2) break;
    size = gf_bs_read_u16(bs);
} else {
    if (gf_bs_available(bs) < 1) break;
    size = gf_bs_read_u8(bs);
}
if (!size || (gf_bs_available(bs) < size)) break;

memset(&acfg, 0, sizeof(GF_M4ADecSpecInfo));
gf_m4a_parse_config(bs, &acfg, 0, size);
if (acfg.base_sr_index != 15) {
    nb_frames++;
} else {
    nb_skip += size;
    gf_bs_skip_bytes(bs, size);
}