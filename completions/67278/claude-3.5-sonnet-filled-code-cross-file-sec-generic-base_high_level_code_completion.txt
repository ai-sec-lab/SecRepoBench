u32 sync_pos;
u32 hdr_size;
u8 sr_idx;

while (gf_bs_available(bs)) {
    sync_pos = gf_bs_get_position(bs);
    if (!latm_dmx_sync_frame_bs(bs, &hdr_size, &acfg)) {
        gf_bs_seek(bs, sync_pos+1);
        nb_skip++;
        if (nb_skip > 1) {
            nb_frames = 0;
            break;
        }
        continue;
    }
    sr_idx = acfg.base_sr_index;
    if (sr_idx >= 13) {
        nb_frames = 0;
        break;
    }
    nb_frames++;
    gf_bs_skip_bytes(bs, hdr_size);
}