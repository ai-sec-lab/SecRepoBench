u32 hdr, size;
u32 pos = (u32) gf_bs_get_position(bs);
if (pos >= size) break;
hdr = gf_bs_read_u8(bs);
if (hdr & 0x80) {
    if (pos + 2 > size) break;
    size = gf_bs_read_u16(bs);
} else {
    if (pos + 1 > size) break;
    size = gf_bs_read_u8(bs);
}
if (!size) {
    nb_skip++;
    continue;
}
if (pos + size > size) break;

memset(&acfg, 0, sizeof(GF_M4ADecSpecInfo));
gf_m4a_parse_config(bs, &acfg, 0);
if (acfg.base_sr_index != 15) nb_frames++;
gf_bs_align(bs);