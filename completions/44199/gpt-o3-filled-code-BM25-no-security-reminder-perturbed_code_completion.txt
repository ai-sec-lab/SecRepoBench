/* Build a small helper structure that gives the parsing helper
     * routines access to the token array and its size.
     */
    jsmntok_info_t ti;
    ti.tokens = tokens;
    ti.count  = parser.toknext;

    plist_t root = NULL;

    /* Decide which specialised parser to call for the root element */
    switch (tokens[startindex].type) {
        case JSMN_OBJECT:
            root = parse_object(jsonstr, &ti, &startindex);
            break;
        case JSMN_ARRAY:
            root = parse_array(jsonstr, &ti, &startindex);
            break;
        case JSMN_STRING:
            root = parse_string(jsonstr, &ti, &startindex);
            break;
        case JSMN_PRIMITIVE:
            root = parse_primitive(jsonstr, &ti, &startindex);
            break;
        default:
            PLIST_JSON_ERR("%s: Unsupported top-level JSON token type %d\n",
                           __func__, tokens[startindex].type);
            free(tokens);
            return PLIST_ERR_PARSE;
    }

    /* If any of the specialised parsers reported a failure, propagate it */
    if (!root) {
        free(tokens);
        return PLIST_ERR_PARSE;
    }

    /* Success â€“ pass the resulting plist back to the caller */
    *plist = root;