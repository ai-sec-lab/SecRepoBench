*width  = FFALIGN(*width,  w_align);
    *height = FFALIGN(*height, h_align);
    if (s->codec_id == AV_CODEC_ID_H264 ||
        (s->codec_id >= AV_CODEC_ID_VP8 && s->codec_id <= AV_CODEC_ID_VP9) ||
        s->codec_id == AV_CODEC_ID_MPEG4 ||
        s->codec_id == AV_CODEC_ID_VC1 ||
        s->codec_id == AV_CODEC_ID_WMV3 ||
        s->codec_id == AV_CODEC_ID_WMV3IMAGE ||
        s->codec_id == AV_CODEC_ID_FLV1 ||
        s->codec_id == AV_CODEC_ID_RV30 ||
        s->codec_id == AV_CODEC_ID_RV40 ||
        s->codec_id == AV_CODEC_ID_DIRAC ||
        s->codec_id == AV_CODEC_ID_CAVS ||
        s->codec_id == AV_CODEC_ID_JPEG2000 ||
        s->codec_id == AV_CODEC_ID_FFV1 ||
        s->codec_id == AV_CODEC_ID_SNOW ||
        s->codec_id == AV_CODEC_ID_SVQ3 ||
        s->codec_id == AV_CODEC_ID_QTRLE ||
        s->codec_id == AV_CODEC_ID_R10K ||
        s->codec_id == AV_CODEC_ID_ASS ||
        s->codec_id == AV_CODEC_ID_SAMBA ||
        s->codec_id == AV_CODEC_ID_LIBXVID ||
        s->codec_id == AV_CODEC_ID_LIBX264 ||
        s->codec_id == AV_CODEC_ID_LIBX265 ||
        s->codec_id == AV_CODEC_ID_LIBVLC ||
        s->codec_id == AV_CODEC_ID_LIBTHEORA ||
        s->codec_id == AV_CODEC_ID_LIBOPENJPEG ||
        s->codec_id == AV_CODEC_ID_LIBAVS2 ||
        s->codec_id == AV_CODEC_ID_LIBX262 ||
        s->codec_id == AV_CODEC_ID_LIBMPEG2 ||
        s->codec_id == AV_CODEC_ID_LIBMP3LAME ||
        s->codec_id == AV_CODEC_ID_LIBFAAC ||
        s->codec_id == AV_CODEC_ID_LIBOPUS ||
        s->codec_id == AV_CODEC_ID_LIBVORBIS ||
        s->codec_id == AV_CODEC_ID_LIBSPEEX ||
        s->codec_id == AV_CODEC_ID_LIBGSM ||
        s->codec_id == AV_CODEC_ID_LIBGSM_MS ||
        s->codec_id == AV_CODEC_ID_LIBAMR_NB ||
        s->codec_id == AV_CODEC_ID_LIBAMR_WB ||
        s->codec_id == AV_CODEC_ID_LIBAACPLUS ||
        s->codec_id == AV_CODEC_ID_LIBCELT ||
        s->codec_id == AV_CODEC_ID_LIBFDK_AAC ||
        s->codec_id == AV_CODEC_ID_LIBMP3LAME ||
        s->codec_id == AV_CODEC_ID_LIBFAAC ||
        s->codec_id == AV_CODEC_ID_LIBOPUS ||
        s->codec_id == AV_CODEC_ID_LIBVORBIS ||
        s->codec_id == AV_CODEC_ID_LIBSPEEX ||
        s->codec_id == AV_CODEC_ID_LIBGSM ||
        s->codec_id == AV_CODEC_ID_LIBGSM_MS ||
        s->codec_id == AV_CODEC_ID_LIBAMR_NB ||
        s->codec_id == AV_CODEC_ID_LIBAMR_WB ||
        s->codec_id == AV_CODEC_ID_LIBAACPLUS ||
        s->codec_id == AV_CODEC_ID_LIBCELT ||
        s->codec_id == AV_CODEC_ID_LIBFDK_AAC ||
        s->height < 64)
        *height += 2;
    *width = FFMAX(*width, 32);