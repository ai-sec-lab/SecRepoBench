*width  = FFALIGN(*width, w_align);
    *height = FFALIGN(*height, h_align);

    if (s->codec_id == AV_CODEC_ID_H264 ||
        s->codec_id == AV_CODEC_ID_VP5  ||
        s->codec_id == AV_CODEC_ID_VP6  ||
        s->codec_id == AV_CODEC_ID_VP6F ||
        s->codec_id == AV_CODEC_ID_VP7  ||
        s->codec_id == AV_CODEC_ID_VP8  ||
        (s->codec_id == AV_CODEC_ID_RV40 && s->lowres) ||
        (s->codec_id == AV_CODEC_ID_WMV3 && s->lowres < 2) ||
        (s->codec_id == AV_CODEC_ID_VC1  && s->lowres < 2) ||
        (s->codec_id == AV_CODEC_ID_SVQ3 && s->lowres) ||
        (s->codec_id == AV_CODEC_ID_CAVS && s->height > 288) ||
        (s->codec_id == AV_CODEC_ID_MPEG4 && s->lowres) ||
        (s->codec_id == AV_CODEC_ID_H263 && s->lowres) ||
        (s->codec_id == AV_CODEC_ID_H263P && s->lowres) ||
        (s->codec_id == AV_CODEC_ID_FLV1 && s->lowres))
        *height += 2;

    // Minimum width 32 to ensure there is enough temporary space for edge emulation.
    *width = FFMAX(*width, 32);