*width  = FFALIGN(*width,  w_align);
    *height = FFALIGN(*height, h_align);

    if (s->codec_id == AV_CODEC_ID_H264 ||
        s->codec_id == AV_CODEC_ID_VP5  ||
        s->codec_id == AV_CODEC_ID_VP6  ||
        s->codec_id == AV_CODEC_ID_VP6F ||
        s->codec_id == AV_CODEC_ID_VP7  ||
        s->codec_id == AV_CODEC_ID_VP8  ||
        s->codec_id == AV_CODEC_ID_HEVC ||
        (s->codec_id == AV_CODEC_ID_RV40 && s->lowres) ||
        (s->codec_id == AV_CODEC_ID_FLV1 && s->lowres <= 1) || //check that
        (s->codec_id == AV_CODEC_ID_SVQ1 && s->lowres == 1) ||
        (s->codec_id == AV_CODEC_ID_WMV1 && s->lowres == 1) ||
        (s->codec_id == AV_CODEC_ID_CAVS && s->lowres == 1) ||
        (s->codec_id == AV_CODEC_ID_VC1  && s->lowres == 1) ||
        (s->codec_id == AV_CODEC_ID_MPEG4 && s->lowres == 1) ||
        (s->codec_id == AV_CODEC_ID_H263 && s->lowres == 1) ||
        (s->codec_id == AV_CODEC_ID_H261 && s->lowres == 1) ||
        (s->codec_id == AV_CODEC_ID_VP3  && s->lowres == 1))
        *height += 2;

    if (s->codec->is_encoder && *width < 32)
        *width = 32; // to avoid negative mv in hpel edge case
    if (s->codec->is_encoder && *height < 32)
        *height = 32; // to avoid negative mv in hpel edge case