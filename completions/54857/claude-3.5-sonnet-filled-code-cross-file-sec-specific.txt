*width = FFALIGN(*width, w_align);
*height = FFALIGN(*height, h_align);

if (s->codec_id == AV_CODEC_ID_H264 || s->codec_id == AV_CODEC_ID_VP5 ||
    s->codec_id == AV_CODEC_ID_VP6 || s->codec_id == AV_CODEC_ID_VP6F ||
    s->codec_id == AV_CODEC_ID_VP6A || s->lowres ||
    (s->flags & (AV_CODEC_FLAG_EMU_EDGE | AV_CODEC_FLAG_TRUNCATED))) {
    *height = FFALIGN(*height, 2);
}

if (s->codec_id == AV_CODEC_ID_H264 || s->lowres)
    *width = FFMAX(*width, 32);

// Ensure that the width and height are within reasonable bounds
if (*width > 0 && *width <= INT_MAX / 2 && *height > 0 && *height <= INT_MAX / 2) {
    s->width = *width;
    s->height = *height;
} else {
    av_log(s, AV_LOG_ERROR, "Invalid dimensions: %dx%d\n", *width, *height);
    return AVERROR(EINVAL);
}