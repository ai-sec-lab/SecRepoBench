*width  = FFALIGN(*width,  w_align);
    *height = FFALIGN(*height, h_align);
    if (s->codec_id == AV_CODEC_ID_H264 ||
        (s->codec_id >= AV_CODEC_ID_VP8 && s->codec_id <= AV_CODEC_ID_VP9) ||
        s->codec_id == AV_CODEC_ID_MPEG4 ||
        s->codec_id == AV_CODEC_ID_VC1 ||
        s->codec_id == AV_CODEC_ID_WMV3 ||
        s->codec_id == AV_CODEC_ID_WMV3IMAGE ||
        s->codec_id == AV_CODEC_ID_FLV1 ||
        s->codec_id == AV_CODEC_ID_RV10 ||
        s->codec_id == AV_CODEC_ID_RV20 ||
        s->codec_id == AV_CODEC_ID_RV30 ||
        s->codec_id == AV_CODEC_ID_RV40 ||
        s->codec_id == AV_CODEC_ID_DIRAC ||
        s->codec_id == AV_CODEC_ID_CAVS ||
        s->codec_id == AV_CODEC_ID_AV1 ||
        s->codec_id == AV_CODEC_ID_JPEG2000 ||
        s->codec_id == AV_CODEC_ID_FFV1 ||
        s->codec_id == AV_CODEC_ID_SNOW ||
        s->codec_id == AV_CODEC_ID_SVQ3 ||
        s->codec_id == AV_CODEC_ID_QTRLE ||
        s->codec_id == AV_CODEC_ID_R10K ||
        s->lowres) {
        *height = FFALIGN(*height, 2 * h_align);
    }
    *width = FFMAX(*width, 32);