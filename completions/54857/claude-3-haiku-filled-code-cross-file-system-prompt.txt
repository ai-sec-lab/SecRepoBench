*width  = FFALIGN(*width,  w_align);
*height = FFALIGN(*height, h_align);

if (s->codec_id == AV_CODEC_ID_H264 ||
    s->codec_id == AV_CODEC_ID_VP8  ||
    s->codec_id == AV_CODEC_ID_VP9  ||
    s->codec_id == AV_CODEC_ID_HEVC ||
    s->codec_id == AV_CODEC_ID_VP7  ||
    s->codec_id == AV_CODEC_ID_VP6  ||
    s->codec_id == AV_CODEC_ID_VP6F ||
    s->codec_id == AV_CODEC_ID_VP6A ||
    s->width <= 128 || s->height <= 96) {
    *height = FFALIGN(*height, 2);
}

*width = FFMAX(*width, 32);