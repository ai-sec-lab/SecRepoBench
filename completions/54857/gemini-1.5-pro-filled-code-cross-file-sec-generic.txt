*width  = FFALIGN(*width, w_align);
    *height = FFALIGN(*height, h_align);

    if (s->codec_id == AV_CODEC_ID_H264 ||
        s->codec_id == AV_CODEC_ID_VP1  ||
        s->codec_id == AV_CODEC_ID_VP2  ||
        s->codec_id == AV_CODEC_ID_VP3  ||
        s->codec_id == AV_CODEC_ID_VP4  ||
        s->codec_id == AV_CODEC_ID_VP5  ||
        s->codec_id == AV_CODEC_ID_VP6  ||
        s->codec_id == AV_CODEC_ID_VP7  ||
        s->codec_id == AV_CODEC_ID_VP8  ||
        s->codec_id == AV_CODEC_ID_CAVS ||
        s->codec_id == AV_CODEC_ID_VC1  ||
        s->codec_id == AV_CODEC_ID_WMV1 ||
        s->codec_id == AV_CODEC_ID_WMV2 ||
        s->codec_id == AV_CODEC_ID_WMV3 ||
        s->codec_id == AV_CODEC_ID_VC1IMAGE        ||
        s->codec_id == AV_CODEC_ID_MSS1            ||
        s->codec_id == AV_CODEC_ID_MSS2            ||
        s->codec_id == AV_CODEC_ID_SNOW           ||
        s->codec_id == AV_CODEC_ID_H263            ||
        s->codec_id == AV_CODEC_ID_H263I           ||
        s->codec_id == AV_CODEC_ID_H263P           ||
        s->codec_id == AV_CODEC_ID_RV10            ||
        s->codec_id == AV_CODEC_ID_RV20            ||
        s->codec_id == AV_CODEC_ID_RV30            ||
        s->codec_id == AV_CODEC_ID_RV40            ||
        s->codec_id == AV_CODEC_ID_FLV1            ||
        s->codec_id == AV_CODEC_ID_SVQ1            ||
        s->codec_id == AV_CODEC_ID_SVQ3            ||
        s->codec_id == AV_CODEC_ID_WMV3IMAGE       ||
        s->codec_id == AV_CODEC_ID_LOCO            ||
        s->codec_id == AV_CODEC_ID_WNV1            ||
        s->codec_id == AV_CODEC_ID_AASC            ||
        s->codec_id == AV_CODEC_ID_INDEO2          ||
        s->codec_id == AV_CODEC_ID_INDEO3          ||
        s->codec_id == AV_CODEC_ID_INDEO4          ||
        s->codec_id == AV_CODEC_ID_INDEO5          ||
        s->codec_id == AV_CODEC_ID_VP9             ||
        s->codec_id == AV_CODEC_ID_VP7             ||
        s->lowres                               ||
        (s->codec_id == AV_CODEC_ID_MJPEG && s->strict_std_compliance > FF_COMPLIANCE_EXPERIMENTAL))
        *height += 2;

    *width = FFMAX(*width, 32);