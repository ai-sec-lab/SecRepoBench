*width = FFALIGN(*width, w_align);
*height = FFALIGN(*height, h_align);

if (s->codec_id == AV_CODEC_ID_H264 || s->codec_id == AV_CODEC_ID_VP5 ||
    s->codec_id == AV_CODEC_ID_VP6 || s->codec_id == AV_CODEC_ID_VP6F ||
    s->codec_id == AV_CODEC_ID_VP6A || s->codec_id == AV_CODEC_ID_MPEG1VIDEO ||
    s->codec_id == AV_CODEC_ID_MPEG2VIDEO || s->codec_id == AV_CODEC_ID_MPEG4 ||
    s->codec_id == AV_CODEC_ID_VC1 || s->codec_id == AV_CODEC_ID_RV30 ||
    s->codec_id == AV_CODEC_ID_RV40 || s->codec_id == AV_CODEC_ID_VP8 ||
    s->codec_id == AV_CODEC_ID_VP9 || s->codec_id == AV_CODEC_ID_HEVC ||
    s->codec_id == AV_CODEC_ID_AV1) {
    int h_chroma_shift, v_chroma_shift;
    av_pix_fmt_get_chroma_sub_sample(s->pix_fmt, &h_chroma_shift, &v_chroma_shift);
    if (*width <= 0 || *height <= 0 ||
        (s->codec_id == AV_CODEC_ID_H264 && (*width > 0 && *width < 8) && (*height > 0 && *height < 8))) {
        av_log(s, AV_LOG_WARNING, "Invalid dimensions (%dx%d). Dimensions must be positive and greater than 8x8 for H.264.\n", *width, *height);
        return;
    }
    *height = FFALIGN(*height, (16 >> v_chroma_shift) * 2);
    *width = FFMAX(*width, 32);
}