// Align width and height
    *width  = FFALIGN(*width,  w_align);
    *height = FFALIGN(*height, h_align);

    // Ensure width is at least 32
    *width = FFMAX(*width, 32);

    // Adjust height for specific codecs or low resolution
    if (s->codec_id == AV_CODEC_ID_H264 || 
        s->codec_id == AV_CODEC_ID_VP8  || 
        s->codec_id == AV_CODEC_ID_VP9  || 
        s->lowres) {
        *height = FFALIGN(*height + 2, h_align);
    }