*width = (*width + w_align - 1) & ~(w_align - 1);
    *height = (*height + h_align - 1) & ~(h_align - 1);

    if (s->codec_id == AV_CODEC_ID_H264 || s->codec_id == AV_CODEC_ID_VP8 || 
        s->codec_id == AV_CODEC_ID_VP9 || s->codec_id == AV_CODEC_ID_HEVC) {
        *height = (*height + 1) & ~1; // Adjust height for motion compensation
    }

    // Ensure minimum width
    if (*width < 32) {
        *width = 32;
    }