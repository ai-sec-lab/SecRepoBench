hb_vector_t<hb_codepoint_t> composite_glyphs;
  for (hb_set_t::iterator it = initial_gids_to_retain->begin(); it != initial_gids_to_retain->end(); ++it)
  {
    hb_codepoint_t gid = *it;
    if (glyf.is_composite (gid))
    {
      hb_vector_t<hb_codepoint_t> components;
      glyf.get_components (gid, &components);
      for (unsigned int i = 0; i < components.len; i++)
      {
        hb_codepoint_t component_gid = components[i];
        full_glyphs_to_retain->add (component_gid);
        composite_glyphs.push_back (component_gid);
      }
    }
  }
  initial_gids_to_retain->destroy();
  _create_old_gid_to_new_gid_map (composite_glyphs, glyphs);
  cmap.fini();
  glyf.fini();
  return full_glyphs_to_retain;