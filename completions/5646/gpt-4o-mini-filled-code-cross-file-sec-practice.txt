// Check if the token starts with "url(".
  if (strncmp(token, "url(", 4) == 0) {
    const char *url_start = token + 4; // Skip "url("
    while (isspace((int) ((unsigned char) *url_start)) != 0) {
      url_start++; // Skip any whitespace
    }
    
    // Check for an optional '#' character
    if (*url_start == '#') {
      url_start++; // Skip the '#'
    }

    // Find the end of the URL
    const char *url_end = url_start;
    while (*url_end != '\0' && *url_end != ')') {
      if (i < (ssize_t) (extent - 1)) {
        token[i++] = *url_end; // Copy the URL to the token
      }
      url_end++;
    }

    // Null-terminate the token string
    if (i < (ssize_t) (extent)) {
      token[i] = '\0';
    } else {
      token[extent - 1] = '\0'; // Ensure null termination
    }

    // Check if the URL is valid (basic validation)
    if (i > 0) {
      // Here you could implement more robust URL validation if needed
      // For now, we just ensure it is not empty
      if (end != (const char **) NULL) {
        *end = (const char *) url_end; // Set the end pointer
      }
      return; // Successfully extracted a URL
    }
  }

  // If we reach here, it means we did not find a valid URL
  // Null-terminate the token string if we haven't already
  if (i < (ssize_t) (extent)) {
    token[i] = '\0';
  } else {
    token[extent - 1] = '\0'; // Ensure null termination
  }