/*
    Terminate the token that we have just assembled.
  */
  next_token[i]='\0';

  /*
    If the token is of the form  url(<reference>)  reduce it to contain
    only the referenced URL (optionally stripping a leading '#').
  */
  if ((i > 4) && (LocaleNCompare(next_token,"url(",4) == 0))
    {
      char
        *q,
        *r;

      /*
        Skip over leading "url(".
      */
      q=next_token+4;
      if (*q == '#')
        q++;

      /*
        Eliminate the trailing ')' character (if present).
      */
      r=q+strlen(q);
      if (r > q)
        {
          r--;               /* last character */
          if (*r == ')')
            *r='\0';
        }

      /*
        Remove optional paired quotes surrounding the url.
      */
      if (((*q == '\'') || (*q == '"')) && (q[strlen(q)-1] == *q))
        {
          q[strlen(q)-1]='\0';   /* strip trailing quote */
          q++;                   /* skip leading quote */
        }

      /*
        Relocate the refined url to the beginning of the token buffer.
      */
      (void) memmove(next_token,q,strlen(q)+1);
      i=strlen(next_token);
    }