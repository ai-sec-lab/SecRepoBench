{
            /* Try to find a handler for the guessed encoding */
            handler = xmlFindCharEncodingHandler((const char *) encoding_guess);
            if (handler != NULL) {
                /* Don't bother switching if it's already UTF-8 */
                if (xmlStrcasecmp(BAD_CAST handler->name,
                                  BAD_CAST "UTF-8") != 0) {
                    if (xmlSwitchToEncoding(ctxt, handler) < 0) {
                        htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                                     "Failed to switch to encoding %s\n",
                                     BAD_CAST encoding_guess, NULL);
                    }
                }
            } else {
                /* No handler found -> report an error */
                htmlParseErr(ctxt, XML_ERR_UNSUPPORTED_ENCODING,
                             "Unsupported encoding %s\n",
                             BAD_CAST encoding_guess, NULL);
            }
            if (encoding_guess != NULL)
                xmlFree(encoding_guess);
        }