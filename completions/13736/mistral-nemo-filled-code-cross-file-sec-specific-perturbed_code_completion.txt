unsigned char *offsets = (unsigned char *)malloc(offsetSize * fontDicts.length);
unsigned int lastOffset = 0;
for (unsigned int i = 0; i < fontDicts.length; i++)
{
  if (fdmap.includes(i))
  {
    FontDict *dict = c->start_embed<FontDict>();
    if (unlikely(!dict->serialize(c, fontDicts[i], opszr, privateInfos[fdmap[i]])))
      return_trace(false);
    unsigned int dictSize = dict->get_serialized_size();
    offsets[i] = lastOffset;
    lastOffset += dictSize;
  }
  else
  {
    offsets[i] = 0;
  }
}
this->offsets.set(offsets, fontDicts.length * offsetSize);