#if FF_API_SUBTITLE_ENCODING
        /* subtitle character encoding handling */
        if (codeccontext->codec_type == AVMEDIA_TYPE_SUBTITLE) {
            if (codeccontext->sub_charenc && codeccontext->sub_charenc[0]) {
                int bitmap_sub =
                    codeccontext->codec_descriptor &&
                    (codeccontext->codec_descriptor->props & AV_CODEC_PROP_BITMAP_SUB);

                if (bitmap_sub) { /* bitmap-based subtitle codec */
                    if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_AUTOMATIC) {
                        codeccontext->sub_charenc_mode = FF_SUB_CHARENC_MODE_DO_NOTHING;
                        av_log(codeccontext, AV_LOG_WARNING,
                               "codec %s is bitmap-based, subtitle character "
                               "encoding will be ignored\n",
                               codeccontext->codec->name);
                    } else if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_PRE_DECODER) {
                        av_log(codeccontext, AV_LOG_WARNING,
                               "codec %s is bitmap-based, subtitle character "
                               "encoding should not be used\n",
                               codeccontext->codec->name);
                    } else {
                        av_assert0(0);
                    }
                } else {        /* text-based subtitle codec */
                    if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_AUTOMATIC)
                        codeccontext->sub_charenc_mode = FF_SUB_CHARENC_MODE_PRE_DECODER;

    #if CONFIG_ICONV
                    if (codeccontext->sub_charenc_mode == FF_SUB_CHARENC_MODE_PRE_DECODER) {
                        iconv_t cd = iconv_open("UTF-8", codeccontext->sub_charenc);
                        if (cd == (iconv_t)-1) {
                            av_log(codeccontext, AV_LOG_WARNING,
                                   "Specified subtitle character encoding '%s' is not supported.\n",
                                   codeccontext->sub_charenc);
                            codeccontext->sub_charenc_mode = FF_SUB_CHARENC_MODE_DO_NOTHING;
                        } else {
                            iconv_close(cd);
                        }
                    }
    #endif
                }
            }
        } else if (codeccontext->sub_charenc) {
            av_log(codeccontext, AV_LOG_WARNING,
                   "Using AVCodecContext.sub_charenc with non-subtitle codec is "
                   "deprecated, use libavfilter instead.\n");
        }
#endif /* FF_API_SUBTITLE_ENCODING */