if (avctx->codec->type == AVMEDIA_TYPE_SUBTITLE) {
            if (avctx->subtitle_header) {
                av_log(avctx, AV_LOG_WARNING, "Subtitle character encoding is ignored for bitmap-based codecs.\n");
            } else {
                // Set character encoding for text-based subtitle codecs
                if (avctx->character_encoding == NULL) {
                    av_log(avctx, AV_LOG_WARNING, "Character encoding not specified, using default.\n");
                } else {
                    // Validate character encoding if iconv is available
                    #ifdef HAVE_ICONV
                    if (iconv_open(avctx->character_encoding, "UTF-8") == (iconv_t)-1) {
                        av_log(avctx, AV_LOG_ERROR, "Invalid character encoding specified: %s\n", avctx->character_encoding);
                        ret = AVERROR(EINVAL);
                        goto free_and_end;
                    }
                    #endif
                }
            }
        }