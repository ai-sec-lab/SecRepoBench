if (avctx->subtitle_header) {
            // Check if the subtitle character encoding is set
            if (avctx->subtitle_header->encoding == NULL) {
                av_log(avctx, AV_LOG_WARNING, "Subtitle character encoding not set, using default.\n");
                avctx->subtitle_header->encoding = "UTF-8"; // Default encoding
            } else {
                // Validate the input encoding if iconv is available
                #ifdef HAVE_ICONV
                if (iconv_open(avctx->subtitle_header->encoding, "UTF-8") == (iconv_t)-1) {
                    av_log(avctx, AV_LOG_ERROR, "Invalid subtitle character encoding: %s\n", avctx->subtitle_header->encoding);
                    ret = AVERROR(EINVAL);
                    goto free_and_end;
                }
                #endif
            }
        } else {
            av_log(avctx, AV_LOG_WARNING, "No subtitle header available, character encoding will not be set.\n");
        }