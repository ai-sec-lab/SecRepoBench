if (avctx->subtitle_encoding == AV_CODEC_ID_NONE) {
            if (avctx->codec->capabilities & AV_CODEC_CAP_SUBTITLE_CHARACTER_ENCODING) {
                if (avctx->codec_id == AV_CODEC_ID_DVD_SUBTITLE ||
                    avctx->codec_id == AV_CODEC_ID_DVB_SUBTITLE ||
                    avctx->codec_id == AV_CODEC_ID_TEXT) {
                    avctx->subtitle_encoding = AV_CODEC_ID_UTF8;
                } else {
                    av_log(avctx, AV_LOG_WARNING, "Character encoding is ignored for bitmap-based subtitle codecs.\n");
                }
            }
        } else if (avctx->codec->capabilities & AV_CODEC_CAP_SUBTITLE_CHARACTER_ENCODING) {
            if (avctx->subtitle_encoding_mode == AV_SUBTITLE_ENCODING_MODE_AUTOMATIC) {
                avctx->subtitle_encoding_mode = AV_SUBTITLE_ENCODING_MODE_PRE_DECODER;
            }
            if (avctx->subtitle_encoding_mode == AV_SUBTITLE_ENCODING_MODE_PRE_DECODER) {
                if (avctx->subtitle_encoding != AV_CODEC_ID_UTF8) {
                    av_log(avctx, AV_LOG_WARNING, "Subtitle character encoding is not UTF-8, this may lead to issues.\n");
                }
            }
        }