/* Find the end of the current ALPN identifier (comma or NUL) */
    while((*comma_or_nul != ',') && (*comma_or_nul != '\0'))
      comma_or_nul++;

    /* Length of the current ALPN token */
    if(comma_or_nul > alpn_start) {
      size_t alpn_len = (size_t)(comma_or_nul - alpn_start);
      int     is_common = 0;
      /* List of ALPNs that we consider common/well-known */
      static const char *common_alpns[] = {
        "http/1.1", "http/1.0", "h2", "h3", "h3-29", "h3-30",
        "h3-31", "spdy/3", "spdy/2", "doq", "dot", "quic"
      };

      for(size_t i = 0; i < (sizeof(common_alpns)/sizeof(common_alpns[0])); i++) {
        const char *c = common_alpns[i];
        if(strlen(c) == alpn_len && strncmp(c, alpn_start, alpn_len) == 0) {
          is_common = 1;
          break;
        }
      }

      if(!is_common) {
        char alpn_str[64];

        /* Safely copy the ALPN token to a zero-terminated buffer */
        if(alpn_len >= sizeof(alpn_str))
          alpn_len = sizeof(alpn_str) - 1;
        memcpy(alpn_str, alpn_start, alpn_len);
        alpn_str[alpn_len] = '\0';

        NDPI_LOG_DBG2(ndpi_struct, "Uncommon ALPN detected: [%s]\n", alpn_str);

        ndpi_set_risk(ndpi_struct, connectionflow,
                      NDPI_TLS_UNCOMMON_ALPN,       /* risk id               */
                      alpn_str);                    /* optional description  */
      }
    }