if (head < 0) {
    head += arraylength;
    if (head < 0) {
      goto out_of_range;
    }
  }

  /* calculate tail index */
  tail = head + len;

  /* overflow/range check */
  if (head > ARY_MAX_SIZE || tail > ARY_MAX_SIZE) {
    goto out_of_range;
  }

  /* adjust len if it exceeds array bounds */
  if (arraylength < tail) {
    len = arraylength - head;
    tail = arraylength;
    if (len < 0) {
      goto out_of_range;
    }
  }