tail = head + len;
if (tail > alen) {
  len = alen - head;
  if (len < 0) len = 0;
  tail = alen;
}