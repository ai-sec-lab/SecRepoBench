if (head + len > alen) {
  len = alen - head;
}
tail = head + len;