tail = head + len;
if (alen < len || alen < tail) {
  len = alen - head;
  if (len < 0) len = 0;
}