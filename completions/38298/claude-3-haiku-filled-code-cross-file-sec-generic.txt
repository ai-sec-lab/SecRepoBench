tail = head + len;
if (tail > alen) {
  tail = alen;
  len = tail - head;
}