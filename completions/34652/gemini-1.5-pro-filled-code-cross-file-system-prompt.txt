if (org_fmt == 'g') {
  if (prec > e -1) {
    if ((prec + (e > 0 ? 1 : 2)) > buf_remaining) {
      prec = buf_remaining - (e > 0 ? 1 : 2) - e;
    }
    prec -= (e - 1);
  } else {
    prec = 0;
  }
}