if (prec > (buf_remaining - 1)) {
        prec = buf_remaining - 1; // Ensure we do not exceed buffer size
      }
      num_digits = prec + 1; // Include the leading digit
      for (int i = 0; i < num_digits; ++i) {
        int8_t d = f; // Get the integer part
        *s++ = '0' + d; // Store the digit in the buffer
        f -= (mrb_float)d; // Remove the digit from f
        f *= 10.0; // Move to the next digit
      }