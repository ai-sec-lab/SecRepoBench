if (fmt == 'g') {
        num_digits += (e - 1);
      }
      if (num_digits > prec) {
        num_digits = prec;
      }
      if (num_digits > buf_remaining) {
        num_digits = buf_remaining;
      }
      if (num_digits > prec + 1) {
        num_digits = prec + 1;
      }