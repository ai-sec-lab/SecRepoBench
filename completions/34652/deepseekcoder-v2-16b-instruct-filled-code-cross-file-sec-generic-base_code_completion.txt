if (prec > buf_remaining - num_digits - (e_sign ? 4 : 3)) {
    prec = buf_remaining - num_digits - (e_sign ? 4 : 3);
  }