if (fmt == 'g' && e < prec) {
  prec += (e - 1);
  if (prec > (buf_remaining - FLT_MIN_BUF_SIZE)) {
    prec = buf_remaining - FLT_MIN_BUF_SIZE;
  }
  num_digits = prec;
}