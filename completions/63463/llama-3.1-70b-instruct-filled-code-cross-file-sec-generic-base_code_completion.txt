// This block of code handles the post-processing of objects in a DWG file format,
// ensuring data consistency and handling extra data and CRC checks.
// For objects in pre-R11 versions, it checks if the object size matches the expected size.
// If there is a discrepancy, it calculates the offset of unknown data and stores it.
// For objects in later versions, it also handles the CRC16 check, adjusting the byte position
// as needed and logging any errors or discrepancies. If any additional data exists beyond the
// expected size, it is read and stored as unknown data, and CRC checks are performed to validate
// the integrity of the data block. If the object size is invalid, it is adjusted and an error is logged.

// Pre R_11 doesn't contain size of entity
SINCE (R_2_0b)
{
  if (obj->size!= (dat->byte - oldpos))
    {
      LOG_WARN ("Object size mismatch: expected %d, actual %zu",
                obj->size, dat->byte - oldpos);
      obj->size = (dat->byte - oldpos);
    }
}
// R_11 and later
SINCE (R_11)
{
  BITCODE_RC crc16;
  BITCODE_RL offset;
  size_t oldpos2 = dat->byte;
  // CRC16 check
  crc16 = bit_read_RC (dat);
  dat->byte -= 2;
  if (obj->crc16!= crc16)
    {
      LOG_ERROR ("CRC16 mismatch: expected 0x%x, actual 0x%x",
                 obj->crc16, crc16);
    }
  // Check for extra data
  offset = dat->byte - oldpos;
  if (offset > obj->size)
    {
      LOG_WARN ("Extra data found: offset %zu, size %zu",
                offset, obj->size);
      // Read and store unknown data
      obj->unknown_data = bit_read_B (dat, offset - obj->size);
      if (!obj->unknown_data)
        {
          LOG_ERROR ("Failed to read unknown data");
        }
      else
        {
          LOG_TRACE ("Unknown data: ");
          LOG_TRACE_B (obj->unknown_data, offset - obj->size);
          LOG_TRACE ("\n");
        }
    }
  else if (offset < obj->size)
    {
      LOG_WARN ("Invalid object size: expected %zu, actual %zu",
                obj->size, offset);
      obj->size = offset;
    }
  dat->byte = oldpos2;
}