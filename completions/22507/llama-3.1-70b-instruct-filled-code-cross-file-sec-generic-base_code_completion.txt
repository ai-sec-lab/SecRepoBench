mrb_value val = GETARG();
mrb_float fval = mrb_float(val);
if (!mrb_finite_p(fval)) {
  char *s;
  int sign = 1;
  if (fval > 0) {
    s = "Inf";
  }
  else if (fval < 0) {
    s = "-Inf";
    sign = -1;
  }
  else {
    s = "NaN";
    sign = 0;
  }
  if (sign == 1 && (flags & FPLUS)) {
    PUSH("+", 1);
  }
  else if (sign == 1 && (flags & FSPACE)) {
    PUSH(" ", 1);
  }
  else if (sign == -1) {
    PUSH("-", 1);
  }
  PUSH(s, strlen(s));
  goto float_exit;
}