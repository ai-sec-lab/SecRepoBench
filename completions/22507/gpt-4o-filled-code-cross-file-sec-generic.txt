mrb_value val = GETARG();
        mrb_float fval;
        char fbuf[32];
        int need;
        
        if (!mrb_float_p(val)) {
          val = mrb_Float(mrb, val);
        }
        fval = mrb_float(val);

        if (!isfinite(fval)) {
          const char *str;
          if (isnan(fval)) {
            str = "NaN";
          }
          else if (fval < 0) {
            str = "-Inf";
          }
          else if (flags & FPLUS) {
            str = "+Inf";
          }
          else if (flags & FSPACE) {
            str = " Inf";
          }
          else {
            str = "Inf";
          }
          n = strlen(str);
          if (width > n && !(flags & FMINUS)) {
            FILL(' ', width - n);
          }
          PUSH(str, n);
          if (width > n && (flags & FMINUS)) {
            FILL(' ', width - n);
          }
          break;
        }