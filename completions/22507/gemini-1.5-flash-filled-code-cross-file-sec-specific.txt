mrb_value val = GETARG();
        mrb_float fval;
        char fbuf[64];
        mrb_int need;
        int n;

        fval = mrb_to_flo(mrb, val);
        if (!isfinite(fval)) {
          const char *s;
          if (isnan(fval)) s = "NaN";
          else if (isinf(fval)) s = (fval > 0) ? "Inf" : "-Inf";
          else s = "";
          int len = strlen(s);
          if (flags & FPLUS) {
            if (fval > 0) {
              CHECK(len + 1);
              buf[blen++] = '+';
            }
          }
          else if (flags & FSPACE) {
            if (fval > 0) {
              CHECK(len + 1);
              buf[blen++] = ' ';
            }
          }
          CHECK(len);
          memcpy(&buf[blen], s, len);
          blen += len;
          continue;
        }