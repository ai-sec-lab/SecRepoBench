mrb_value val = GETARG();
        mrb_float fval;
        char fbuf[32];
        int need;

        if (!mrb_float_p(val)) {
          val = mrb_Float(mrb, val);
        }
        fval = mrb_float(val);

        if (!isfinite(fval)) {
          const char *str;
          char buf[4];
          int len = 3;

          if (isnan(fval)) {
            str = "NaN";
          }
          else {
            if (fval < 0) {
              str = "-Inf";
              len = 4;
            }
            else if (flags & FPLUS) {
              str = "+Inf";
              len = 4;
            }
            else if (flags & FSPACE) {
              str = " Inf";
              len = 4;
            }
            else {
              str = "Inf";
            }
          }
          if ((flags & FWIDTH) && width > len) {
            width -= len;
            if (!(flags & FMINUS)) {
              FILL(' ', width);
              width = 0;
            }
          }
          PUSH(str, len);
          if (width > 0) {
            FILL(' ', width);
          }
          break;
        }