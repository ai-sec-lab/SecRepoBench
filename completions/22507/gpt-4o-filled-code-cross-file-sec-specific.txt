mrb_value val = GETARG();
        double fval;
        char fbuf[32];
        int need;
        
        if (!mrb_float_p(val)) {
          val = mrb_Float(mrb, val);
        }
        fval = mrb_float(val);

        if (!isfinite(fval)) {
          const char *str;
          if (isnan(fval)) {
            str = "NaN";
          }
          else {
            str = (fval < 0) ? "-Inf" : "Inf";
            if (fval > 0 && (flags & FPLUS)) {
              str = "+Inf";
            }
            else if (fval > 0 && (flags & FSPACE)) {
              str = " Inf";
            }
          }
          n = strlen(str);
          if (flags & FWIDTH) {
            width -= n;
            if (!(flags & FMINUS) && width > 0) {
              FILL(' ', width);
            }
          }
          PUSH(str, n);
          if ((flags & FMINUS) && width > 0) {
            FILL(' ', width);
          }
          break;
        }