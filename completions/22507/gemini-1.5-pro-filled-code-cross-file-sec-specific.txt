mrb_float fval;
        char fbuf[256];
        int need;
        int n;

        fval = mrb_float(GETARG());
        if (!isfinite(fval)) {
          const char *expr = (fval > 0.0) ? "Inf" : "-Inf";
          if (isnan(fval)) {
            expr = "NaN";
          }
          if (flags & FPLUS) {
            CHECK(1);
            buf[blen++] = '+';
          }
          else if (flags & FSPACE) {
            CHECK(1);
            buf[blen++] = ' ';
          }
          need = strlen(expr);
          if (flags & FWIDTH) {
            if (flags & FMINUS) {
              PUSH(expr, need);
              FILL(' ', width - need);
            }
            else {
              FILL(' ', width - need);
              PUSH(expr, need);
            }
          }
          else {
            PUSH(expr, need);
          }
          break;
        }