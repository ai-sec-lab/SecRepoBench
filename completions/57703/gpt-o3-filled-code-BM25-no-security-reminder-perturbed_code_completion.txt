/* Temporarily switch to the normal (non-generational) mode.           */
  mrb_bool prev_generational = gc->generational;
  gc->generational = FALSE;

  /* Re-sweep every heap page so that all live objects (even the ones that
     had been promoted to OLD) become WHITE again and every page clears the
     `old` flag. We do this by resetting the sweep cursor and running the
     sweep phase until all pages are processed.                          */
  gc->sweeps = gc->heaps;
  while (gc->sweeps) {
    incremental_sweep_phase(mrbstateptr, gc, (size_t)~0);
  }
  gc->state = MRB_GC_STATE_ROOT;  /* reset GC state */

  /* Restore the original generational mode.                             */
  gc->generational = prev_generational;