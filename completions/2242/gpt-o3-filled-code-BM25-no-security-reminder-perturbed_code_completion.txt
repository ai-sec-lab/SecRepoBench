const char *buf, *b, *c, *end, *last;
			size_t linecnt, bytecnt, lines;

			/* Keep the initial offset within the available data */
			if (offset > nbytes)
				offset = CAST(uint32_t, nbytes);

			/*
			 * m->str_range can represent either a number of
			 * bytes or, if REGEX_LINE_COUNT is set, a number of
			 * lines.  Convert it into the two separate variables
			 * we need for the scan below.
			 */
			if ((m->str_flags & REGEX_LINE_COUNT) != 0) {
				/* Range is counted in lines */
				linecnt = m->str_range;
				/*
				 * Heuristic for how many bytes we may need to
				 * examine for the given amount of lines.
				 * (An average line is assumed to be ~80 bytes.)
				 */
				bytecnt = linecnt * 80;
			} else {
				/* Range is counted in bytes */
				linecnt = 0;
				bytecnt = m->str_range;
			}