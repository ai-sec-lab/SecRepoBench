if (iterator == nullptr) {
  c->set_starting_glyph_index(0);
  c->set_class_value_length(0);
  return true;
}

hb_glyph_extents_t min_extents, max_extents;
hb_glyph_extents_t *extents = iterator->get_extents(&min_extents, &max_extents);
int glyph_count = max_extents.glyph_index - min_extents.glyph_index + 1;
c->set_starting_glyph_index(min_extents.glyph_index);
c->serialize_class_value(c, glyph_count);
for (int i = 0; i < glyph_count; i++) {
  hb_glyph_index_t glyph_index = min_extents.glyph_index + i;
  c->assign_class_value(iterator->get_glyph_class(glyph_index), glyph_index);
}
return true;