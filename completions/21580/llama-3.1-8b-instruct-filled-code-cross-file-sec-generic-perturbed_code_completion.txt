if (iterator == nullptr) {
  c->set_starting_glyph_index(0);
  c->set_class_value_length(0);
  return true;
}

hb_glyph_extents_t min_extents, max_extents;
hb_glyph_extents_t *extents = iterator->get_extents(&min_extents, &max_extents);
if (unlikely (extents == nullptr)) return_trace (false);

uint32_t glyph_count = max_extents.advance - min_extents.advance + 1;
c->set_starting_glyph_index(min_extents.advance);
c->set_class_value_length(glyph_count);

hb_class_value_t class_value;
if (unlikely (!c->serialize_class_value(class_value, glyph_count))) return_trace (false);

uint32_t glyph_index = c->get_starting_glyph_index();
for (Iterator::GlyphClassPair *pair : *iterator) {
  pair->set_class_value(class_value);
  pair->set_glyph_index(glyph_index++);
}