/* No time_key field found */
    time_lookup = 0;
    tm.tm_sec  = 0;
    tm.tm_min  = 0;
    tm.tm_hour = 0;
    tm.tm_mday = 1;
    tm.tm_mon  = 0;
    tm.tm_year = 70;   /* 1970 */

    if (v && v->type == MSGPACK_OBJECT_STR && v->via.str.size > 0) {
        /*
         * Try to parse the time value according to the parser
         * configuration.  The value might be a double (for
         * fractional seconds) or a string representing the time
         * format specified in the parser configuration.
         */
        if (parser->time_type == FLB_PARSER_TIME_DOUBLE) {
            /* Expecting a double number expressed as seconds since epoch */
            char *p;
            double d;

            /* Make sure we can access the buffer safely */
            len = v->via.str.size;
            if (len >= sizeof(tmp)) {
                len = sizeof(tmp) - 1;
            }
            memcpy(tmp, v->via.str.ptr, len);
            tmp[len] = '\0';

            errno = 0;
            d = strtod(tmp, &p);
            if (errno == 0 && p != tmp) {
                time_lookup = (time_t) d;
                tmfrac      = d - (double) time_lookup;
            }
            else {
                flb_warn("[parser] invalid time format: '%s'", tmp);
            }
        }
        else {
            /* Assume the value is a formatted time string */
            len = v->via.str.size;
            if (len >= sizeof(tmp)) {
                len = sizeof(tmp) - 1;
            }
            memcpy(tmp, v->via.str.ptr, len);
            tmp[len] = '\0';

            ret = strptime(tmp, parser->time_fmt, &tm);
            if (ret != 0) {
#ifdef _WIN32
                /* timegm() is not available on Windows, use _mkgmtime() */
                time_lookup = _mkgmtime(&tm);
#else
                time_lookup = timegm(&tm);
#endif
            }
            else {
                flb_warn("[parser] time parsing failed for '%s'", tmp);
            }
        }
    }
    else {
        /* No valid time field found, use zero */
        time_lookup = 0;
    }