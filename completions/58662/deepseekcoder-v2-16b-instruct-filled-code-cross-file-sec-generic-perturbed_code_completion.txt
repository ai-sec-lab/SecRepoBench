++iterator;
    while (iterator.more()) {
        auto current = *iterator;
        hb_codepoint_t current_gid = current.first;
        unsigned current_klass = current.second;

        if (current_gid != prev_gid + 1 || current_klass != prev_klass) {
            range_rec.last = prev_gid;
            auto *range_rec_copy = c->copy(range_rec);
            if (unlikely(!range_rec_copy)) return_trace(false);
            num_ranges++;
            range_rec.first = current_gid;
            range_rec.last = current_gid;
            range_rec.value = current_klass;
        }
        prev_gid = current_gid;
        prev_klass = current_klass;
        ++iterator;
    }
    range_rec.last = prev_gid;
    auto *final_range_rec_copy = c->copy(range_rec);
    if (unlikely(!final_range_rec_copy)) return_trace(false);
    num_ranges++;

    rangeRecord.len = num_ranges;

    // Sort the range records if necessary
    // This is a placeholder for the actual sorting code
    // sort_range_records(c->get_ranges());

    return_trace(true);