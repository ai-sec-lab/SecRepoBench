++iterator;
    while (iterator.more()) {
      const auto &pair = *iterator;
      hb_codepoint_t gid = pair.first;
      unsigned klass = pair.second;

      if (gid != prev_gid + 1 || klass != prev_klass) {
        range_rec.last = prev_gid;
        auto *record = c->copy(range_rec);
        if (unlikely(!record)) return_trace(false);
        rangeRecord.len++;
        range_rec.first = gid;
        range_rec.last = gid;
        range_rec.value = klass;
      } else {
        range_rec.last = gid;
      }

      prev_gid = gid;
      prev_klass = klass;
      ++iterator;
    }

    range_rec.last = prev_gid;
    auto *record = c->copy(range_rec);
    if (unlikely(!record)) return_trace(false);
    rangeRecord.len++;

    // Sort the range records if necessary
    // This is a placeholder for the actual sorting code
    // sort_range_records(rangeRecord);

    return_trace(true);