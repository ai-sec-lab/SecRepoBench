// Iterate over the remaining elements in the iterator, processing each glyph ID and class pair.
// For each pair, check if it is a continuation of the current range.
// If it is not a continuation, finalize the current range, and create a new range record for the new pair.
// Copy the new range record into the serialization context.
// Update previous glyph ID and class values for the next iteration.
// After the loop, finalize the last range record by setting its last glyph ID.
// Update the range record length to reflect the number of ranges processed.
// Sort the range records to handle any unsorted glyph order.
// Return true to indicate successful serialization.
while (unlikely (iterator->has_next ()))
{
  hb_codepoint_t current_gid = (*iterator).first;
  unsigned current_klass = (*iterator).second;

  if (unlikely (current_gid!= prev_gid || current_klass!= prev_klass))
  {
    // Finalize the current range record by setting its last glyph ID.
    range_rec.last = prev_gid;
    // Copy the current range record into the serialization context.
    auto *record = c->copy (range_rec);
    if (unlikely (!record)) return_trace (false);
    // Update the range record length to reflect the number of ranges processed.
    rangeRecord.len++;
    // Add the current range record to the list of range records.
    rangeRecords.push_back (record);
    // Create a new range record for the new pair.
    range_rec.first = current_gid;
    range_rec.last = current_gid;
    range_rec.value = current_klass;
  }
  // Update previous glyph ID and class values for the next iteration.
  prev_gid = current_gid;
  prev_klass = current_klass;
  // Move to the next pair in the iterator.
  iterator->next ();
}

// Finalize the last range record by setting its last glyph ID.
range_rec.last = prev_gid;
// Copy the last range record into the serialization context.
auto *record = c->copy (range_rec);
if (unlikely (!record)) return_trace (false);
// Update the range record length to reflect the number of ranges processed.
rangeRecord.len++;
// Add the last range record to the list of range records.
rangeRecords.push_back (record);

// Sort the range records to handle any unsorted glyph order.
std::sort (rangeRecords.begin (), rangeRecords.end (),
           [](auto *a, auto *b) { return a->first < b->first; });

return_trace (true);