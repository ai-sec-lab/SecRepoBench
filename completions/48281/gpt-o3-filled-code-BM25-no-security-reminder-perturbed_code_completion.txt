SpeedHQContext  *s   = codec_context->priv_data;
    const uint8_t   *buf = avpkt->data;
    int              buf_size = avpkt->size;
    int              ret;
    int              second_field_offset;

    /* basic sanity checks */
    if (!buf || buf_size < 4)
        return AVERROR_INVALIDDATA;
    if (codec_context->width  <= 0 ||
        codec_context->height <= 0)
        return AVERROR_INVALIDDATA;

    /* first byte is the quality factor, prepare the qtables */
    speedhq_calculate_qtable(s, buf[0]);