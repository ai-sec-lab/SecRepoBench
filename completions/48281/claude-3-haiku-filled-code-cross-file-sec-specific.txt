uint8_t *dst = frame->data[0];
int dst_linesize = frame->linesize[0];
int width = FFALIGN(avctx->width, 16);
int height = FFALIGN(avctx->height, 16);
int x, y;

for (y = 0; y < height; y++) {
    for (x = 0; x < width; x++) {
        dst[x] = (buf[x + second_field_offset] * s->quant_matrix[x & 15]) >> 8;
    }
    dst += dst_linesize;
    buf += width;
}