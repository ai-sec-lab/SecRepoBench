// Initialize the graphics state stack
  ssize_t n = 0;
  DrawInfo **graphic_context = (DrawInfo **) AcquireQuantumMemory(1, sizeof(*graphic_context));
  if (graphic_context == (DrawInfo **) NULL)
    ThrowBinaryException(ResourceLimitError, "MemoryAllocationFailed", keyword);

  // Initialize the affine matrix
  GetAffineMatrix(&affine);
  status = MagickTrue;

  // Parse the drawing commands
  while ((next_token = GetNextToken(q, &q, MagickPathExtent, token)) != NULL)
  {
    // Handle different drawing commands
    if (LocaleCompare("push", token) == 0)
    {
      // Push the current graphics state onto the stack
      graphic_context = (DrawInfo **) ResizeQuantumMemory(graphic_context, (n + 1) * sizeof(*graphic_context));
      if (graphic_context == (DrawInfo **) NULL)
        ThrowBinaryException(ResourceLimitError, "MemoryAllocationFailed", keyword);
      graphic_context[n] = CloneDrawInfo(draw_info);
      n++;
      continue;
    }
    else if (LocaleCompare("pop", token) == 0)
    {
      // Pop the last graphics state from the stack
      if (n > 0)
      {
        n--;
        draw_info = graphic_context[n];
      }
      else
      {
        ThrowBinaryException(DrawError, "UnbalancedGraphicContextPushPop", keyword);
      }
      continue;
    }

    // Handle other drawing primitives (e.g., lines, rectangles, etc.)
    // This part would include parsing the specific commands and applying them
    // to the image using the draw_info and affine transformations.
    // For example:
    if (LocaleCompare("line", token) == 0)
    {
      // Parse line coordinates and draw the line
      // ...
    }
    else if (LocaleCompare("rectangle", token) == 0)
    {
      // Parse rectangle coordinates and draw the rectangle
      // ...
    }
    // Additional drawing commands would be handled similarly...

    // If an unrecognized command is encountered, set status to false
    if (status == MagickFalse)
      break;
  }

  // Finalize the drawing operation
  if (status == MagickFalse)
    ThrowBinaryException(DrawError, "NonconformingDrawingPrimitiveDefinition", keyword);