MagickBooleanType
    status;

  PrimitiveInfo
    *primitive_info;

  size_t
    number_points;

  ssize_t
    n;

  DrawInfo
    **graphic_context;

  StopInfo
    *stops;

  /*
    Initialize graphic context stack.
  */
  number_points=2047;
  primitive_info=(PrimitiveInfo *) AcquireQuantumMemory(number_points,
    sizeof(*primitive_info));
  if (primitive_info == (PrimitiveInfo *) NULL)
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
      image->filename);
  graphic_context=(DrawInfo **) AcquireMagickMemory(sizeof(*graphic_context));
  if (graphic_context == (DrawInfo **) NULL)
    ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
      image->filename);
  graphic_context[0]=CloneDrawInfo((ImageInfo *) NULL,draw_info);
  n=0;
  stops=(StopInfo *) NULL;
  status=MagickTrue;

  /*
    Parse the drawing commands.
  */
  primitive=AcquireString(draw_info->primitive);
  for (q=primitive; *q != '\0'; )
  {
    GetNextToken(q,&q,MagickPathExtent,keyword);
    if (*keyword == '\0')
      break;
    if (LocaleCompare("push",keyword) == 0)
    {
      GetNextToken(q,&q,MagickPathExtent,token);
      if (LocaleCompare("graphic-context",token) == 0)
      {
        n++;
        graphic_context=(DrawInfo **) ResizeQuantumMemory(graphic_context,
          (size_t) (n+1),sizeof(*graphic_context));
        if (graphic_context == (DrawInfo **) NULL)
          ThrowBinaryException(ResourceLimitError,"MemoryAllocationFailed",
            image->filename);
        graphic_context[n]=CloneDrawInfo((ImageInfo *) NULL,
          graphic_context[n-1]);
        continue;
      }
    }
    if (LocaleCompare("pop",keyword) == 0)
    {
      GetNextToken(q,&q,MagickPathExtent,token);
      if (LocaleCompare("graphic-context",token) == 0)
      {
        if (n == 0)
          ThrowBinaryException(DrawError,"UnbalancedGraphicContextPushPop",
            keyword);
        graphic_context[n]=DestroyDrawInfo(graphic_context[n]);
        n--;
        continue;
      }
    }
    // Handle other drawing commands...
  }
  primitive=DestroyString(primitive);