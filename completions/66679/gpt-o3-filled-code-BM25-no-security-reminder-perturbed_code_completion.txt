{
            /* We already have an ID entry for this value, just update it */
            if (!streaming) {
                /*
                 * If the ID was previously linked to another attribute,
                 * break that association first.
                 */
                if ((ret->attr != NULL) && (ret->attr != attribute)) {
                    ret->attr->id = NULL;
                    if (ret->attr->atype == XML_ATTRIBUTE_ID)
                        ret->attr->atype = XML_ATTRIBUTE_CDATA;
                }
                /* Associate the ID with the new/current attribute */
                ret->attr = attribute;
                ret->name = NULL;
            } else {
                /*
                 * In streaming mode the attribute node may disappear,
                 * keep only its name.
                 */
                ret->attr = NULL;
                if (doc->dict != NULL)
                    ret->name = xmlDictLookup(doc->dict, attribute->name, -1);
                else {
                    if (ret->name != NULL)
                        xmlFree((xmlChar *)ret->name);
                    ret->name = xmlStrdup(attribute->name);
                }
            }
            /* Mark the attribute as an ID attribute */
            attribute->atype = XML_ATTRIBUTE_ID;
            if (!streaming)
                attribute->id = ret;
            if (id != NULL)
                *id = ret;
            return(1);
        }