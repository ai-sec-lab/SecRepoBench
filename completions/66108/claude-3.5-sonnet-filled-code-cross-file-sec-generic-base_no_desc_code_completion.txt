if (remain < size) {
    if (!is_eos) {
        return GF_OK;
    }
    size = remain;
}

if (remain < bytes_skipped + size) {
    if (!is_eos) {
        return GF_OK;
    }
    size = remain - bytes_skipped;
}

if (size < 4) {
    GF_LOG(GF_LOG_WARNING, GF_LOG_MEDIA, ("[MP3Dmx] Invalid frame size %d\n", size));
    bytes_to_drop = 1;
    goto drop_byte;
}