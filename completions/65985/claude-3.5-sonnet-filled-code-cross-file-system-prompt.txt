if (ctx->bytes_in_header) {
    u32 hdr_bytes = (remain < ctx->bytes_in_header) ? remain : ctx->bytes_in_header;
    memcpy(ctx->hdr_store + ctx->bytes_in_header, start, hdr_bytes);
    ctx->bytes_in_header += hdr_bytes;

    if (ctx->bytes_in_header >= 4) {
        current = mpgviddmx_next_start_code(ctx->hdr_store, ctx->bytes_in_header);
        if (current >= 0) {
            forced_sc_type = ctx->hdr_store[3];
            sc_type_forced = GF_TRUE;
            hdr_offset = current;
            bytes_from_store = ctx->bytes_in_header - current;
        } else if (ctx->bytes_in_header == 4) {
            forced_sc_type = ctx->hdr_store[3];
            sc_type_forced = GF_TRUE;
            hdr_offset = 0;
            bytes_from_store = 4;
        }
    }

    if (sc_type_forced) {
        if (ctx->frame_started) {
            dst_pck = gf_filter_pck_new_alloc(ctx->opid, hdr_offset, &pck_data);
            if (!dst_pck) return GF_OUT_OF_MEM;
            if (ctx->src_pck) gf_filter_pck_merge_properties(ctx->src_pck, dst_pck);
            memcpy(pck_data, ctx->hdr_store, hdr_offset);
            gf_filter_pck_set_framing(dst_pck, GF_FALSE, GF_FALSE);
            gf_filter_pck_set_cts(dst_pck, GF_FILTER_NO_TS);
            gf_filter_pck_set_dts(dst_pck, GF_FILTER_NO_TS);
            mpgviddmx_enqueue_or_dispatch(ctx, dst_pck, GF_FALSE, GF_FALSE);
        }
        memmove(ctx->hdr_store, ctx->hdr_store + hdr_offset, bytes_from_store);
        ctx->bytes_in_header = bytes_from_store;
    } else {
        ctx->bytes_in_header = 0;
    }
}