/* https://learn.microsoft.com/en-us/typography/opentype/spec/gsub#extension-substitution-subtable
     *
     * For Extension lookups all subtables belonging to the same lookup must
     * advertise the very same “ExtensionLookupType”.  The following run-time
     * check verifies that, but only when we are still in the very first pass
     * of sanitisation (ie. no edits have happened yet) – after we start
     * editing data this restriction is no longer meaningful.
     */
    if ((get_type () == 7u /*GSUB*/ || get_type () == 9u /*GPOS*/)
        && c->edit_count == 0)
    {
      unsigned cnt = get_subtable_count ();
      if (cnt)
      {
        /* The ExtensionLookupType is the second uint16 in the subtable,
         * right after the format field.  We access it generically through
         * a byte pointer so we do not depend on the actual subtable type. */
        auto sub_ptr0     = reinterpret_cast<const char *>(&get_subtable<TSubTable> (0));
        unsigned expected = *reinterpret_cast<const HBUINT16 *> (sub_ptr0 + 2);

        for (unsigned i = 1; i < cnt; ++i)
        {
          auto sub_ptr  = reinterpret_cast<const char *>(&get_subtable<TSubTable> (i));
          unsigned type = *reinterpret_cast<const HBUINT16 *> (sub_ptr + 2);
          if (expected != type)
            return_trace (false);
        }
      }
    }