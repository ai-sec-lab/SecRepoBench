if (ptr->sampleSize == 4) {
				// Read two samples per byte for compact sizes
				for (; i < ptr->sampleCount; i += 2) {
					u8 byte = gf_bs_read_u8(bs);
					ptr->sizes[i] = byte & 0x0F; // First sample
					if (i + 1 < ptr->sampleCount) {
						ptr->sizes[i + 1] = (byte >> 4) & 0x0F; // Second sample
					}
				}
			} else if (ptr->sampleSize == 8) {
				// Read one sample per byte
				for (; i < ptr->sampleCount; i++) {
					ptr->sizes[i] = gf_bs_read_u8(bs);
				}
			} else if (ptr->sampleSize == 16) {
				// Read one sample per two bytes
				for (; i < ptr->sampleCount; i++) {
					ptr->sizes[i] = gf_bs_read_u16(bs);
				}
			} else if (ptr->sampleSize == 32) {
				// Read one sample per four bytes
				for (; i < ptr->sampleCount; i++) {
					ptr->sizes[i] = gf_bs_read_u32(bs);
				}
			} else {
				// Invalid sample size, log error and return
				GF_LOG(GF_LOG_ERROR, GF_LOG_CONTAINER, ("[iso file] Invalid sample size %d in stsz\n", ptr->sampleSize));
				return GF_ISOM_INVALID_FILE;
			}