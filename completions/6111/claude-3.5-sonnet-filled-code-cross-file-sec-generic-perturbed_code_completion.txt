image=AcquireImage(image_info,exception);
if (image == (Image *) NULL)
  return((Image *) NULL);
(void) CopyMagickString(image->filename,image_info->filename,MagickPathExtent);
(void) SetImageInfo(image_info,0,exception);
if (*image_info->magick != '\0')
  (void) CopyMagickString(image->magick,image_info->magick,MagickPathExtent);
(void) ResetImagePage(image,"0x0+0+0");

delegate_info=GetDelegateInfo(image_info->magick,"ps",exception);
if (delegate_info == (const DelegateInfo *) NULL)
  {
    image=DestroyImage(image);
    return((Image *) NULL);
  }

/*
  Open image file.
*/
if (IsBlobSeekable(image) == MagickFalse)
  {
    *input_filename='\0';
    status=ImageToFile(image,input_filename,exception);
    if (status == MagickFalse)
      {
        image=DestroyImage(image);
        return((Image *) NULL);
      }
  }
else
  {
    *input_filename='\0';
    (void) CopyMagickString(input_filename,image->filename,MagickPathExtent);
  }

/*
  Set the page density.
*/
options=GetImageOption(image_info,"ps:use-cropbox");
if (options != (const char *) NULL)
  (void) SetImageArtifact(image,"ps:use-cropbox",options);
density=GetImageOption(image_info,"density");
if (density == (char *) NULL)
  {
    options=GetImageOption(image_info,"ps:density");
    if (options == (const char *) NULL)
      (void) ParseGeometry(PSPageGeometry,&geometry_info);
    else
      (void) ParseGeometry(options,&geometry_info);
    image->resolution.x=geometry_info.rho;
    image->resolution.y=geometry_info.sigma;
    if (image->resolution.y == 0)
      image->resolution.y=image->resolution.x;
  }

/*
  Determine page geometry from the Postscript bounding box.
*/
(void) ParseAbsoluteGeometry(PSPageGeometry,&page);
if (*image_info->magick != '\0')
  (void) CopyMagickString(postscript_filename,image_info->filename,
    MagickPathExtent);
else
  if (*image->magick == '\0')
    (void) CopyMagickString(postscript_filename,input_filename,
      MagickPathExtent);
  else
    (void) CopyMagickString(postscript_filename,image->filename,
      MagickPathExtent);

/*
  Create Ghostscript control file.
*/
file=AcquireUniqueFileResource(filename);
if (file == -1)
  {
    ThrowFileException(exception,FileOpenError,"UnableToCreateTemporaryFile",
      filename);
    image=DestroyImage(image);
    return((Image *) NULL);
  }
(void) FormatLocaleString(command,MagickPathExtent,
  "%.1024s -q -dBATCH -dSAFER -dNOPAUSE -dNOPROMPT -dMaxBitmap=500000000 "
  "-dAlignToPixels=0 -dGridFitTT=2 -sDEVICE=pngalpha -dTextAlphaBits=4 "
  "-dGraphicsAlphaBits=4 \"-sOutputFile=%.1024s\" "
  "-r%.20gx%.20g %.1024s > \"%.1024s\" 2>&1",
  delegate_info->commands,output_filename,image->resolution.x,
  image->resolution.y,postscript_filename,filename);

/*
  Render Postscript with Ghostscript.
*/
status=InvokeDelegate(image_info,image,command,exception);
file=close(file)-1;
(void) RelinquishUniqueFileResource(filename);
if (status == MagickFalse)
  {
    (void) RelinquishUniqueFileResource(output_filename);
    image=DestroyImage(image);
    return((Image *) NULL);
  }

/*
  Read Ghostscript output.
*/
read_info=CloneImageInfo(image_info);
(void) CopyMagickString(read_info->filename,output_filename,MagickPathExtent);
postscript_image=ReadImage(read_info,exception);
read_info=DestroyImageInfo(read_info);
(void) RelinquishUniqueFileResource(output_filename);
if (postscript_image == (Image *) NULL)
  {
    image=DestroyImage(image);
    return((Image *) NULL);
  }