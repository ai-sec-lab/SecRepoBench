image=ReadImage(image_info,exception);
if (image == (Image *) NULL)
  return((Image *) NULL);
(void) CloseBlob(image);
/*
  Create Ghostscript control file.
*/
file=AcquireUniqueFileResource(postscript_filename);
if (file == -1)
{
  ThrowFileException(exception,FileOpenError,"UnableToCreateTemporaryFile",
    image_info->filename);
  image=DestroyImage(image);
  return((Image *) NULL);
}
/* Write Ghostscript control file */
(void) write(file,command,strlen(command));
file=close(file)-1;
/*
  Render Postscript with the Ghostscript delegate.
*/
if (image_info->monochrome != MagickFalse)
  delegate_info=GetDelegateInfo("ps:mono",(char *) NULL,exception);
else
  delegate_info=GetDelegateInfo("ps:color",(char *) NULL,exception);
if (delegate_info == (const DelegateInfo *) NULL)
{
  (void) RelinquishUniqueFileResource(postscript_filename);
  image=DestroyImage(image);
  return((Image *) NULL);
}
density=AcquireString("");
options=AcquireString("");
(void) FormatLocaleString(density,MagickPathExtent,"%gx%g",
  image->resolution.x,image->resolution.y);
if (image_info->page != (char *) NULL)
  (void) ConcatenateMagickString(options,"-g",MagickPathExtent);
read_info=CloneImageInfo(image_info);
*read_info->magick='\0';
if (read_info->number_scenes != 0)
  (void) FormatLocaleString(read_info->filename,MagickPathExtent,"%s[%lu]",
    filename,read_info->scene);
else
  (void) CopyMagickString(read_info->filename,filename,MagickPathExtent);
(void) CopyMagickString(filename,read_info->filename,MagickPathExtent);
(void) AcquireUniqueFilename(filename);
(void) FormatLocaleString(command,MagickPathExtent,
  GetDelegateCommands(delegate_info),
  read_info->antialias != MagickFalse ? 4 : 1,
  read_info->antialias != MagickFalse ? 4 : 1,density,options,filename,
  postscript_filename,input_filename);
status=InvokeDelegate(read_info,image,command,exception);
(void) RelinquishUniqueFileResource(postscript_filename);
(void) RelinquishUniqueFileResource(input_filename);
read_info=DestroyImageInfo(read_info);
density=DestroyString(density);
options=DestroyString(options);
if (status == MagickFalse)
{
  (void) RelinquishUniqueFileResource(filename);
  image=DestroyImage(image);
  return((Image *) NULL);
}
/*
  Read Ghostscript output.
*/
read_info=CloneImageInfo(image_info);
(void) CopyMagickString(read_info->filename,filename,MagickPathExtent);
postscript_image=ReadImage(read_info,exception);
(void) RelinquishUniqueFileResource(filename);
read_info=DestroyImageInfo(read_info);
if (postscript_image == (Image *) NULL)
{
  image=DestroyImage(image);
  return((Image *) NULL);
}
if (LocaleCompare(postscript_image->magick,"BMP") == 0)
{
  Image
    *cmyk_image;

  cmyk_image=ConsolidateCMYKImages(postscript_image,exception);
  if (cmyk_image != (Image *) NULL)
    {
      postscript_image=DestroyImageList(postscript_image);
      postscript_image=cmyk_image;
    }
}