// This part processes each unpacked MsgPack array, expecting two entries: a timestamp and a record.
// It extracts the timestamp and the map (record) from each array.
// If a `date_key` is provided, the timestamp is appended to the map with the specified format.
// The map is then packed into a new MsgPack buffer, considering the desired JSON format (JSON array, JSON lines, or stream).
// For JSON lines or stream formats, the converted JSON string is appended to an output buffer.
// For JSON lines, a newline character is appended after each record.
// The code handles different date formats such as double, ISO8601, and epoch.